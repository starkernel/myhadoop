Subject: [PATCH] [fixed]: 支持trino的部署
---
Index: ambari-common/src/main/python/resource_management/libraries/functions/setup_ranger_plugin_xml.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-common/src/main/python/resource_management/libraries/functions/setup_ranger_plugin_xml.py b/ambari-common/src/main/python/resource_management/libraries/functions/setup_ranger_plugin_xml.py
--- a/ambari-common/src/main/python/resource_management/libraries/functions/setup_ranger_plugin_xml.py	(revision fb82d21843dde8b371705948493a5316cf3f8893)
+++ b/ambari-common/src/main/python/resource_management/libraries/functions/setup_ranger_plugin_xml.py	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -1,4 +1,5 @@
 #!/usr/bin/env python
+# coding=utf-8
 """
 Licensed to the Apache Software Foundation (ASF) under one
 or more contributor license agreements.  See the NOTICE file
@@ -55,7 +56,9 @@
                         skip_if_rangeradmin_down=True,
                         is_security_enabled=False, is_stack_supports_ranger_kerberos=False,
                         component_user_principal=None, component_user_keytab=None, cred_lib_path_override=None,
-                        cred_setup_prefix_override=None):
+                        cred_setup_prefix_override=None,
+                        plugin_home=None,
+                        setup_plugin_keystore=True):

     bigtop_select_version = Script.get_stack_version().replace(".", "_")
     ranger_component_name = format('ranger_{bigtop_select_version}-{service_name}-plugin')
@@ -90,6 +93,12 @@
     else:
         stack_version = stack_version_override

+    # 如果未传入 plugin_home，则使用默认拼接逻辑
+    if plugin_home is None:
+        stack_root = Script.get_stack_root()
+        service_name = str(service_name).lower()
+        plugin_home = format('{stack_root}/{stack_version}/usr/lib/ranger-{service_name}-plugin/')
+
     component_conf_dir = conf_dict

     if plugin_enabled:
@@ -146,7 +155,6 @@
                  mode=0644
                  )

-        # remove plain-text password from xml configs
         plugin_audit_password_property = 'xasecure.audit.destination.db.password'
         plugin_audit_properties_copy = {}
         plugin_audit_properties_copy.update(plugin_audit_properties)
@@ -170,7 +178,6 @@
                   group=component_group,
                   mode=0744)

-        # remove plain-text password from xml configs
         plugin_password_properties = ['xasecure.policymgr.clientssl.keystore.password',
                                       'xasecure.policymgr.clientssl.truststore.password']
         plugin_policymgr_ssl_properties_copy = {}
@@ -197,10 +204,12 @@
                       group=component_group,
                       mode=0744)

-        setup_ranger_plugin_keystore(service_name, audit_db_is_enabled, stack_version, credential_file,
-                                     xa_audit_db_password, ssl_truststore_password, ssl_keystore_password,
-                                     component_user, component_group, java_home, cred_lib_path_override,
-                                     cred_setup_prefix_override)
+        # 仅当设置为 True 时才执行 keystore 初始化
+        if setup_plugin_keystore:
+            setup_ranger_plugin_keystore(service_name, audit_db_is_enabled, stack_version, credential_file,
+                                         xa_audit_db_password, ssl_truststore_password, ssl_keystore_password,
+                                         component_user, component_group, java_home, cred_lib_path_override,
+                                         cred_setup_prefix_override)

     else:
         File(format('{component_conf_dir}/ranger-security.xml'),
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/properties/stack_packages.json
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/properties/stack_packages.json b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/properties/stack_packages.json
--- a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/properties/stack_packages.json	(revision fb82d21843dde8b371705948493a5316cf3f8893)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/properties/stack_packages.json	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -878,6 +878,44 @@
             "impala-shell"
           ]
         }
+      },
+      "TRINO": {
+        "TRINO_COORDINATOR": {
+          "STACK-SELECT-PACKAGE": "trino",
+          "INSTALL": [
+            "trino"
+          ],
+          "PATCH": [
+            "trino"
+          ],
+          "STANDARD": [
+            "trino"
+          ]
+        },
+        "TRINO_WORKER": {
+          "STACK-SELECT-PACKAGE": "trino",
+          "INSTALL": [
+            "trino"
+          ],
+          "PATCH": [
+            "trino"
+          ],
+          "STANDARD": [
+            "trino"
+          ]
+        },
+        "TRINO_CLI": {
+          "STACK-SELECT-PACKAGE": "trino-cli",
+          "INSTALL": [
+            "trino-cli"
+          ],
+          "PATCH": [
+            "trino-cli"
+          ],
+          "STANDARD": [
+            "trino-cli"
+          ]
+        }
       }
     },
     "conf-select": {
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/configuration/ranger-env.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/configuration/ranger-env.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/configuration/ranger-env.xml
--- a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/configuration/ranger-env.xml	(revision fb82d21843dde8b371705948493a5316cf3f8893)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/configuration/ranger-env.xml	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -677,4 +677,27 @@
     </value-attributes>
     <on-ambari-upgrade add="false"/>
   </property>
+
+  <property>
+    <name>ranger-trino-plugin-enabled</name>
+    <value>No</value>
+    <display-name>TRINO Ranger Plugin</display-name>
+    <description>Enable TRINO Ranger plugin</description>
+    <value-attributes>
+      <overridable>false</overridable>
+      <type>value-list</type>
+      <entries>
+        <entry>
+          <value>Yes</value>
+          <label>ON</label>
+        </entry>
+        <entry>
+          <value>No</value>
+          <label>OFF</label>
+        </entry>
+      </entries>
+      <selection-cardinality>1</selection-cardinality>
+    </value-attributes>
+    <on-ambari-upgrade add="false"/>
+  </property>
 </configuration>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/alerts.json
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/alerts.json b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/alerts.json
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/alerts.json	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,60 @@
+{
+  "TRINO": {
+    "TRINO_COORDINATOR": [
+      {
+        "name": "trino_coordinator_process",
+        "label": "Trino Coordinator Process",
+        "description": "This host-level alert is triggered if the individual Trino processes cannot be established to be up and listening on the network.",
+        "interval": 1,
+        "scope": "HOST",
+        "enabled": true,
+        "source": {
+          "type": "PORT",
+          "uri": "{{config-properties/http-server.http.port}}",
+          "default_port": 8380,
+          "reporting": {
+            "ok": {
+              "text": "TCP OK - {0:.3f}s response on port {1}"
+            },
+            "warning": {
+              "text": "TCP OK - {0:.3f}s response on port {1}",
+              "value": 1.5
+            },
+            "critical": {
+              "text": "Connection failed: {0} to {1}:{2}",
+              "value": 5.0
+            }
+          }
+        }
+      }
+    ],
+	"TRINO_WORKER": [
+      {
+        "name": "trino_worker_process",
+        "label": "Trino Worker Process",
+        "description": "This host-level alert is triggered if the individual Trino processes cannot be established to be up and listening on the network.",
+        "interval": 1,
+        "scope": "HOST",
+        "enabled": true,
+        "source": {
+          "type": "PORT",
+          "uri": "{{config-properties/http-server.http.port}}",
+          "default_port": 8380,
+          "reporting": {
+            "ok": {
+              "text": "TCP OK - {0:.3f}s response on port {1}"
+            },
+            "warning": {
+              "text": "TCP OK - {0:.3f}s response on port {1}",
+              "value": 1.5
+            },
+            "critical": {
+              "text": "Connection failed: {0} to {1}:{2}",
+              "value": 5.0
+            }
+          }
+        }
+      }
+    ]
+  }
+}
\ No newline at end of file
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/access-control-properties.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/access-control-properties.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/access-control-properties.xml
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/access-control-properties.xml	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,73 @@
+<?xml version="1.0"?>
+<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
+<!--
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+<configuration>
+    <property>
+        <name>access-control.name</name>
+        <value>{{access_control_name}}</value>
+        <description>
+            access-control.name: value can be: allow-all,ranger,file
+        </description>
+		<on-ambari-upgrade add="false"/>
+    </property>
+	<property>
+        <name>access-control.config-files</name>
+        <value>/etc/trino/conf/ranger.properties</value>
+        <description>
+            access-control.config-files
+        </description>
+		<on-ambari-upgrade add="false"/>
+    </property>
+    <property>
+        <name>ranger.service.name</name>
+        <value>{{repo_name}}</value>
+        <description>
+            ranger.service.name
+        </description>
+		<on-ambari-upgrade add="false"/>
+    </property>
+
+    <property>
+        <name>apache-ranger.service.name</name>
+        <value>{{trino_ranger_service_name}}</value>
+        <description>Name of the Ranger service containing Trino policies</description>
+        <depends-on>
+            <property>
+                <type>ranger-trino-plugin-properties</type>
+                <name>ranger-trino-plugin-enabled</name>
+            </property>
+        </depends-on>
+        <on-ambari-upgrade add="false"/>
+    </property>
+
+    <property>
+        <name>apache-ranger.plugin.config.resource</name>
+        <value>{{ranger_config_resource}}</value>
+        <description>Comma-separated list of Ranger plugin configuration file paths for Trino</description>
+        <depends-on>
+            <property>
+                <type>ranger-trino-plugin-properties</type>
+                <name>ranger-trino-plugin-enabled</name>
+            </property>
+        </depends-on>
+        <on-ambari-upgrade add="false"/>
+    </property>
+</configuration>
\ No newline at end of file
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/config-properties.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/config-properties.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/config-properties.xml
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/config-properties.xml	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,256 @@
+<?xml version="1.0"?>
+<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
+<!--
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+<configuration>
+    <property>
+        <name>node-scheduler.include-coordinator</name>
+        <value>true</value>
+        <description>
+            Allow scheduling work on the coordinator. For larger clusters, processing
+            work on the coordinator can impact query performance because the machine’s
+            resources are not available for the critical task of scheduling, managing
+            and monitoring query execution.
+        </description>
+        <value-attributes>
+            <type>value-list</type>
+            <entries>
+                <entry>
+                    <value>true</value>
+                    <label>Enabled</label>
+                </entry>
+                <entry>
+                    <value>false</value>
+                    <label>Disabled</label>
+                </entry>
+            </entries>
+            <selection-cardinality>1</selection-cardinality>
+        </value-attributes>
+        <on-ambari-upgrade add="false"/>
+    </property>
+
+
+    <property>
+        <name>http-server.http.port</name>
+        <value>8380</value>
+        <description>
+            Specifies the port for the HTTP server. Trino uses HTTP for all communication, internal and external.
+        </description>
+        <on-ambari-upgrade add="false"/>
+    </property>
+
+
+    <property>
+        <name>http-server.log.path</name>
+        <value>/var/log/trino/http-request.log</value>
+        <description>
+            http-server.log.path
+        </description>
+        <on-ambari-upgrade add="false"/>
+    </property>
+
+    <property>
+        <name>discovery.uri</name>
+        <value>{{discovery_uri}}</value>
+        <description>
+            he Trino coordinator has a discovery service that is used by all the nodes to find each other.
+        </description>
+        <on-ambari-upgrade add="false"/>
+    </property>
+
+    <property>
+        <name>query.max-memory</name>
+        <value>2GB</value>
+        <description>
+            The maximum amount of distributed memory that a query may use.
+
+            If you'd like to enter a value higher than the maximum on the slider,
+            click on the pencil that appears when you hover over the setting and
+            ignore that higher values are not recommended.
+        </description>
+        <on-ambari-upgrade add="false"/>
+    </property>
+
+    <property>
+        <name>query.max-memory-per-node</name>
+        <value>1GB</value>
+        <description>
+            The maximum amount of memory that a query may use on any one machine.
+
+            If you'd like to enter a value higher than the maximum on the slider,
+            click on the pencil that appears when you hover over the setting and
+            ignore that higher values are not recommended.
+        </description>
+        <on-ambari-upgrade add="false"/>
+    </property>
+
+    <property>
+        <name>spill-enabled</name>
+        <value>false</value>
+        <description>
+
+        </description>
+        <value-attributes>
+            <type>value-list</type>
+            <entries>
+                <entry>
+                    <value>true</value>
+                    <label>true</label>
+                </entry>
+                <entry>
+                    <value>false</value>
+                    <label>false</label>
+                </entry>
+            </entries>
+            <selection-cardinality>1</selection-cardinality>
+        </value-attributes>
+        <on-ambari-upgrade add="false"/>
+    </property>
+
+
+    <property>
+        <name>spiller-spill-path</name>
+        <value>/data/trino/spill</value>
+        <description>
+        </description>
+        <on-ambari-upgrade add="false"/>
+    </property>
+
+
+    <property>
+        <name>http-server.authentication.type</name>
+        <value>PASSWORD</value>
+        <description>
+            NONE,PASSWORD or others
+        </description>
+        <value-attributes>
+            <empty-value-valid>true</empty-value-valid>
+        </value-attributes>
+        <on-ambari-upgrade add="false"/>
+    </property>
+
+    <property>
+        <name>http-server.https.enabled</name>
+        <value>false</value>
+        <display-name>http-server.https.enabled</display-name>
+        <description>http-server.https.enabled</description>
+        <value-attributes>
+            <type>boolean</type>
+        </value-attributes>
+        <on-ambari-upgrade add="false"/>
+    </property>
+
+    <property>
+        <name>http-server.https.port</name>
+        <value>8443</value>
+        <description>
+        </description>
+        <on-ambari-upgrade add="false"/>
+    </property>
+
+    <property>
+        <name>http-server.https.keystore.path</name>
+        <value>/etc/trino/conf/trino.pem</value>
+        <description>
+            please put trino.pem Manually. Now ambari can not generate automatic.
+        </description>
+        <on-ambari-upgrade add="false"/>
+    </property>
+
+    <property>
+        <name>http-server.https.keystore.key</name>
+        <value>changeit</value>
+        <description>
+            please modify Manually. Now ambari can not generate automatic.
+        </description>
+        <on-ambari-upgrade add="false"/>
+    </property>
+
+
+    <property>
+        <name>internal-communication.https.required</name>
+        <value>false</value>
+        <display-name>internal-communication.https.required</display-name>
+        <description>internal-communication.https.required</description>
+        <value-attributes>
+            <type>boolean</type>
+        </value-attributes>
+        <on-ambari-upgrade add="false"/>
+    </property>
+
+    <property>
+        <name>internal-communication.shared-secret</name>
+        <value>trino</value>
+        <description>
+            internal-communication.shared-secret
+        </description>
+        <on-ambari-upgrade add="false"/>
+    </property>
+
+
+    <!--
+    指定密码认证器的配置文件路径。
+    这个文件通常包含用户认证所需的用户名密码对等信息。
+    配置这个路径后，Trino 在启动时会读取该文件用于身份验证。
+-->
+    <property>
+        <name>password-authenticator.config-files</name>
+        <value>/etc/trino/conf/password-authenticator.properties</value>
+        <description>
+            Specifies the path to the password authenticator configuration file. This file contains user credentials and
+            authentication settings.
+        </description>
+        <on-ambari-upgrade add="false"/>
+    </property>
+
+    <!--
+        插件目录路径。
+        Trino 会在启动时从该目录加载自定义插件（如连接器、函数、认证插件等）。
+        确保该目录下的插件与 Trino 版本兼容。
+    -->
+    <property>
+        <name>plugin.dir</name>
+        <value>/usr/bigtop/current/trino/plugins</value>
+        <description>
+            Directory where Trino plugin jars are stored. Trino loads plugins from this directory during startup.
+        </description>
+        <on-ambari-upgrade add="false"/>
+    </property>
+
+    <!--
+        指定该节点是否为 Coordinator（协调节点）。
+        在 Trino 集群中，只有一个节点应当设置为 coordinator=true，其他 worker 节点应设置为 false。
+        Coordinator 负责接收 SQL 请求，解析计划执行。
+    -->
+    <property>
+        <name>coordinator</name>
+        <value>true</value>
+        <description>
+            Whether this Trino node acts as the coordinator. The coordinator is responsible for parsing, planning, and
+            scheduling queries.
+        </description>
+        <value-attributes>
+            <type>boolean</type>
+        </value-attributes>
+        <on-ambari-upgrade add="false"/>
+    </property>
+
+
+</configuration>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/connectors-properties.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/connectors-properties.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/connectors-properties.xml
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/connectors-properties.xml	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,81 @@
+<?xml version='1.0'?>
+<?xml-stylesheet type='text/xsl' href='configuration.xsl'?>
+<!--
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * 'License'); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an 'AS IS' BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+<configuration>
+    <property>
+        <name>connectors</name>
+        <value>{
+{% if has_hive_metastore %}
+  'hive': [
+    'connector.name=hive',
+    'hive.metastore.uri={{hive_metastore_uris}}',
+    'fs.hadoop.enabled=true',
+	  {% if security_enabled %}
+    'hive.metastore.thrift.impersonation.enabled=false',
+    'hive.metastore.service.principal={{trino_principal}}',
+    'hive.metastore.client.principal={{trino_principal}}',
+    'hive.metastore.client.keytab={{trino_keytab}}',
+    'hive.hdfs.impersonation.enabled=false',
+    'hive.hdfs.trino.principal={{trino_principal}}',
+    'hive.hdfs.trino.keytab={{trino_keytab}}',
+     {% endif %}
+     'hive.metastore.authentication.type={{authentication_type}}',
+     'hive.hdfs.authentication.type={{authentication_type}}',
+     'hive.config.resources=/etc/hadoop/conf/core-site.xml,/etc/hadoop/conf/hdfs-site.xml'
+  ],
+{% endif %}
+  'tpch': [
+    'connector.name=tpch',
+    'tpch.splits-per-node=4'
+  ],
+  'tpcds': [
+    'connector.name=tpcds',
+    'tpcds.splits-per-node=4'
+  ],
+  'memory': [
+    'connector.name=memory'
+  ],
+  'jmx': [
+    'connector.name=jmx'
+  ]
+}
+</value>
+        <description>
+            Modify this property to add connectors. The format should be
+			{'connector1':
+              ['key1=value1',
+			  'key2=value2'..
+			  ],
+			  'connector2' :[
+			  'key1=value1',
+               'key2=value2'
+			   ..
+			   ]
+			   ..
+			 }
+			 . Note the single quotes around each value!
+			 This example will create files connector1.properties, connector2.properties for trino with entries
+            key1=value1 etc. If you don't want to add any connectors then leave the value as {};
+            Ambari will not accept an empty value for this property.
+        </description>
+    </property>
+
+</configuration>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/event-listener-properties.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/event-listener-properties.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/event-listener-properties.xml
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/event-listener-properties.xml	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,41 @@
+<?xml version="1.0"?>
+<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
+<!--
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+<configuration>
+    <property>
+        <name>enable.event-listener</name>
+        <value>false</value>
+        <description>enable.event-listener</description>
+        <on-ambari-upgrade add="false"/>
+    </property>
+    <property>
+        <name>content</name>
+        <value>event-listener.name=http
+http-event-listener.log-created=true
+http-event-listener.connect-ingest-uri=
+
+        </value>
+        <description>mysql,http
+        </description>
+        <on-ambari-upgrade add="false"/>
+    </property>
+
+</configuration>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/group-provider-properties.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/group-provider-properties.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/group-provider-properties.xml
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/group-provider-properties.xml	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,43 @@
+<?xml version="1.0"?>
+<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
+<!--
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+<configuration>
+    <property>
+        <name>group-provider.name</name>
+        <value>file</value>
+        <description>
+            group-provider.name
+        </description>
+		<on-ambari-upgrade add="false"/>
+    </property>
+
+    <property>
+        <name>file.group-file</name>
+        <value>/etc/trino/conf/group.txt</value>
+        <description>
+            file.group-file
+        </description>
+		<on-ambari-upgrade add="false"/>
+    </property>
+
+
+
+</configuration>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/group-txt.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/group-txt.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/group-txt.xml
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/group-txt.xml	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,37 @@
+<?xml version="1.0"?>
+<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
+<!--
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+<configuration>
+    <property>
+        <name>content</name>
+        <value>
+        </value>
+        <description>
+group_name:user_1,user_2,user_3
+
+        </description>
+        <value-attributes>
+            <type>content</type>
+            <show-property-name>false</show-property-name>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>
+</configuration>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/jvm-config.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/jvm-config.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/jvm-config.xml
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/jvm-config.xml	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,54 @@
+<?xml version="1.0"?>
+<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
+<!--
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+<configuration>
+    <property>
+        <name>content</name>
+        <value>-server
+-XX:MaxRAMPercentage=30
+-XX:G1HeapRegionSize=32M
+-XX:+ExplicitGCInvokesConcurrent
+-XX:+ExitOnOutOfMemoryError
+-XX:+HeapDumpOnOutOfMemoryError
+-XX:-OmitStackTraceInFastThrow
+-XX:ReservedCodeCacheSize=512M
+-XX:PerMethodRecompilationCutoff=10000
+-XX:PerBytecodeRecompilationCutoff=10000
+-Djdk.attach.allowAttachSelf=true
+-Djdk.nio.maxCachedBufferSize=2000000
+-Dfile.encoding=UTF-8
+# Allow loading dynamic agent used by JOL
+-XX:+EnableDynamicAgentLoading
+        </value>
+        <description>
+            A list of command line options used for launching the Java Virtual
+            Machine. The format of the file must be one option per line. These
+            options are not interpreted by the shell, so options containing spaces or
+            other special characters should not be quoted (as demonstrated by the
+            OnOutOfMemoryError option).
+        </description>
+        <value-attributes>
+            <type>content</type>
+            <show-property-name>false</show-property-name>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>
+</configuration>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/log-properties.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/log-properties.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/log-properties.xml
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/log-properties.xml	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,38 @@
+<?xml version="1.0"?>
+<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
+<!--
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+<configuration>
+    <property>
+        <name>content</name>
+        <value>
+# Enable verbose logging from Trino
+io.trino=INFO
+        </value>
+        <description>
+log.properties
+        </description>
+        <value-attributes>
+            <type>content</type>
+            <show-property-name>false</show-property-name>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>
+</configuration>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/node-properties.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/node-properties.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/node-properties.xml
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/node-properties.xml	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,73 @@
+<?xml version="1.0"?>
+<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
+<!--
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+<configuration>
+    <property>
+        <name>node.environment</name>
+        <value>bigtop</value>
+        <description>
+            The name of the environment.
+            All Trino nodes in a cluster must have the same environment name.
+        </description>
+		<on-ambari-upgrade add="false"/>
+    </property>
+
+    <property>
+        <name>node.data-dir</name>
+        <value>/usr/bigtop/current/trino</value>
+        <description>
+            The location (filesystem path) of the data directory.
+            Trino will store logs and other data here.
+        </description>
+		<on-ambari-upgrade add="false"/>
+    </property>
+
+    <property>
+        <name>catalog.config</name>
+        <value>/etc/trino/conf/catalog</value>
+        <description>
+            catalog.config
+        </description>
+		<on-ambari-upgrade add="false"/>
+    </property>
+
+<!--
+    <property>
+        <name>node.server-log-file</name>
+        <value>/var/log/trino/server.log</value>
+        <description>
+            node.server-log-file
+        </description>
+		<on-ambari-upgrade add="false"/>
+    </property>
+
+    <property>
+        <name>node.launcher-log-file</name>
+        <value>/var/log/trino/launcher.log</value>
+        <description>
+            node.launcher-log-file
+        </description>
+		<on-ambari-upgrade add="false"/>
+    </property>
+-->
+
+
+</configuration>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/password-authenticator-properties.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/password-authenticator-properties.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/password-authenticator-properties.xml
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/password-authenticator-properties.xml	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,75 @@
+<?xml version="1.0"?>
+<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
+<!--
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+<configuration>
+    <property>
+        <name>password-authenticator.name</name>
+        <value>file</value>
+        <description>
+            password-authenticator.name
+        </description>
+		<on-ambari-upgrade add="false"/>
+    </property>
+
+    <property>
+        <name>file.password-file</name>
+        <value>/etc/trino/conf/password.db</value>
+        <description>
+		file.password-file
+        </description>
+		<on-ambari-upgrade add="false"/>
+    </property>
+
+    <property>
+        <name>file.auth-token-cache.max-size</name>
+        <value>1000</value>
+        <description>
+        </description>
+		<on-ambari-upgrade add="false"/>
+    </property>
+
+    <property>
+        <name>ldap.url</name>
+        <value>ldap://openldap:1389</value>
+        <description>he URL to the LDAP server. The URL scheme must be ldap:// or ldaps://. Connecting to the LDAP server without TLS enabled requires ldap.allow-insecure=true.
+        </description>
+		<on-ambari-upgrade add="false"/>
+    </property>
+  <property>
+    <name>ldap.allow-insecure</name>
+    <value>true</value>
+    <display-name>ldap.allow-insecure</display-name>
+    <description>Allow using an LDAP connection that is not secured with TLS.</description>
+    <value-attributes>
+      <type>boolean</type>
+    </value-attributes>
+    <on-ambari-upgrade add="false"/>
+  </property>
+
+    <property>
+        <name>ldap.user-bind-pattern</name>
+        <value>uid=${USER},ou=users,dc=example,dc=org</value>
+        <description>he URL to the LDAP server. The URL scheme must be ldap:// or ldaps://. Connecting to the LDAP server without TLS enabled requires ldap.allow-insecure=true.
+        </description>
+		<on-ambari-upgrade add="false"/>
+    </property>
+
+</configuration>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/ranger-trino-audit.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/ranger-trino-audit.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/ranger-trino-audit.xml
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/ranger-trino-audit.xml	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,133 @@
+<?xml version="1.0"?>
+<!--
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+<configuration>
+  <property>
+    <name>xasecure.audit.is.enabled</name>
+    <value>true</value>
+    <description>Is Audit enabled?</description>
+    <value-attributes>
+      <type>boolean</type>
+    </value-attributes>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>xasecure.audit.destination.hdfs</name>
+    <value>true</value>
+    <display-name>Audit to HDFS</display-name>
+    <description>Is Audit to HDFS enabled?</description>
+    <value-attributes>
+      <type>boolean</type>
+    </value-attributes>
+    <depends-on>
+      <property>
+        <type>ranger-env</type>
+        <name>xasecure.audit.destination.hdfs</name>
+      </property>
+    </depends-on>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>xasecure.audit.destination.hdfs.dir</name>
+    <value>hdfs://NAMENODE_HOSTNAME:8020/ranger/audit</value>
+    <description>HDFS folder to write audit to, make sure the service user has requried permissions</description>
+    <depends-on>
+      <property>
+        <type>ranger-env</type>
+        <name>xasecure.audit.destination.hdfs.dir</name>
+      </property>
+    </depends-on>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>xasecure.audit.destination.hdfs.batch.filespool.dir</name>
+    <value>/var/log/trino/audit/hdfs/spool</value>
+    <description>/var/log/trino/audit/hdfs/spool</description>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>xasecure.audit.destination.solr</name>
+    <value>false</value>
+    <display-name>Audit to SOLR</display-name>
+    <description>Is Solr audit enabled?</description>
+    <value-attributes>
+      <type>boolean</type>
+    </value-attributes>
+    <depends-on>
+      <property>
+        <type>ranger-env</type>
+        <name>xasecure.audit.destination.solr</name>
+      </property>
+    </depends-on>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>xasecure.audit.destination.solr.urls</name>
+    <value/>
+    <description>Solr URL</description>
+    <value-attributes>
+      <empty-value-valid>true</empty-value-valid>
+    </value-attributes>
+    <depends-on>
+      <property>
+        <type>ranger-admin-site</type>
+        <name>ranger.audit.solr.urls</name>
+      </property>
+    </depends-on>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>xasecure.audit.destination.solr.zookeepers</name>
+    <value>NONE</value>
+    <description>Solr Zookeeper string</description>
+    <depends-on>
+      <property>
+        <type>ranger-admin-site</type>
+        <name>ranger.audit.solr.zookeepers</name>
+      </property>
+    </depends-on>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>xasecure.audit.destination.solr.batch.filespool.dir</name>
+    <value>/var/log/trino/audit/solr/spool</value>
+    <description>/var/log/trino/audit/solr/spool</description>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>xasecure.audit.provider.summary.enabled</name>
+    <value>false</value>
+    <display-name>Audit provider summary enabled</display-name>
+    <description>Enable Summary audit?</description>
+    <value-attributes>
+      <type>boolean</type>
+    </value-attributes>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>ranger.plugin.trino.ambari.cluster.name</name>
+    <value>{{cluster_name}}</value>
+    <description>Capture cluster name from where Ranger trino plugin is enabled.</description>
+    <value-attributes>
+      <empty-value-valid>true</empty-value-valid>
+    </value-attributes>
+    <on-ambari-upgrade add="false"/>
+  </property>
+</configuration>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/ranger-trino-plugin-properties.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/ranger-trino-plugin-properties.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/ranger-trino-plugin-properties.xml
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/ranger-trino-plugin-properties.xml	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,135 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+<configuration supports_final="true">
+  <property>
+    <name>common.name.for.certificate</name>
+    <value/>
+    <description>Common name for certificate, this value should match what is specified in repo within ranger admin</description>
+    <value-attributes>
+      <empty-value-valid>true</empty-value-valid>
+    </value-attributes>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>policy_user</name>
+    <value>ambari-qa</value>
+    <display-name>Policy user for TRINO</display-name>
+    <depends-on>
+      <property>
+        <type>ranger-env</type>
+        <name>ranger_user</name>
+      </property>
+    </depends-on>
+    <description>This user must be system user and also present at Ranger admin portal</description>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>ranger-trino-plugin-enabled</name>
+    <value>No</value>
+    <display-name>Enable Ranger for TRINO</display-name>
+    <description>Enable ranger trino plugin ?</description>
+    <value-attributes>
+      <type>boolean</type>
+      <overridable>false</overridable>
+    </value-attributes>
+    <depends-on>
+      <property>
+        <type>ranger-env</type>
+        <name>ranger-trino-plugin-enabled</name>
+      </property>
+    </depends-on>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>REPOSITORY_CONFIG_USERNAME</name>
+    <value>trino</value>
+    <display-name>Ranger repository config user</display-name>
+    <description>Used for repository creation on ranger admin</description>
+    <depends-on>
+      <property>
+        <type>ranger-trino-plugin-properties</type>
+        <name>ranger-trino-plugin-enabled</name>
+      </property>
+      <property>
+        <type>trino-env</type>
+        <name>trino_user</name>
+      </property>
+    </depends-on>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>REPOSITORY_CONFIG_PASSWORD</name>
+    <value>trino</value>
+    <display-name>Ranger repository config password</display-name>
+    <property-type>PASSWORD</property-type>
+    <description>Used for repository creation on ranger admin</description>
+    <value-attributes>
+      <type>password</type>
+    </value-attributes>
+    <on-ambari-upgrade add="false"/>
+  </property>
+
+  <!-- Inherited from HBase in HDP 2.6 -->
+  <property>
+    <name>external_admin_username</name>
+    <value></value>
+    <display-name>External Ranger admin username</display-name>
+    <description>Add ranger default admin username if want to communicate to external ranger</description>
+    <value-attributes>
+      <empty-value-valid>true</empty-value-valid>
+    </value-attributes>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>external_admin_password</name>
+    <value></value>
+    <display-name>External Ranger admin password</display-name>
+    <property-type>PASSWORD</property-type>
+    <description>Add ranger default admin password if want to communicate to external ranger</description>
+    <value-attributes>
+      <type>password</type>
+      <empty-value-valid>true</empty-value-valid>
+    </value-attributes>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>external_ranger_admin_username</name>
+    <value></value>
+    <display-name>External Ranger Ambari admin username</display-name>
+    <description>Add ranger default ambari admin username if want to communicate to external ranger</description>
+    <value-attributes>
+      <empty-value-valid>true</empty-value-valid>
+    </value-attributes>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>external_ranger_admin_password</name>
+    <value></value>
+    <display-name>External Ranger Ambari admin password</display-name>
+    <property-type>PASSWORD</property-type>
+    <description>Add ranger default ambari admin password if want to communicate to external ranger</description>
+    <value-attributes>
+      <type>password</type>
+      <empty-value-valid>true</empty-value-valid>
+    </value-attributes>
+    <on-ambari-upgrade add="false"/>
+  </property>
+</configuration>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/ranger-trino-policymgr-ssl.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/ranger-trino-policymgr-ssl.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/ranger-trino-policymgr-ssl.xml
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/ranger-trino-policymgr-ssl.xml	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,84 @@
+<?xml version="1.0"?>
+<!--
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+<configuration>
+  <property>
+    <name>xasecure.policymgr.clientssl.keystore</name>
+    <value/>
+    <description>Java Keystore files</description>
+    <value-attributes>
+      <empty-value-valid>true</empty-value-valid>
+    </value-attributes>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>xasecure.policymgr.clientssl.keystore.password</name>
+    <value>myKeyFilePassword</value>
+    <property-type>PASSWORD</property-type>
+    <description>password for keystore</description>
+    <value-attributes>
+      <type>password</type>
+    </value-attributes>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>xasecure.policymgr.clientssl.truststore</name>
+    <value/>
+    <description>java truststore file</description>
+    <value-attributes>
+      <empty-value-valid>true</empty-value-valid>
+    </value-attributes>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>xasecure.policymgr.clientssl.truststore.password</name>
+    <value>changeit</value>
+    <property-type>PASSWORD</property-type>
+    <description>java truststore password</description>
+    <value-attributes>
+      <type>password</type>
+    </value-attributes>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>xasecure.policymgr.clientssl.keystore.credential.file</name>
+    <value>jceks://file{{credential_file}}</value>
+    <description>java keystore credential file</description>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>xasecure.policymgr.clientssl.truststore.credential.file</name>
+    <value>jceks://file{{credential_file}}</value>
+    <description>java truststore credential file</description>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>xasecure.policymgr.clientssl.truststore.type</name>
+    <value>jks</value>
+    <description>Type of truststore. Default: jks</description>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>xasecure.policymgr.clientssl.keystore.type</name>
+    <value>jks</value>
+    <description>Type of keystore. Default: jks</description>
+    <on-ambari-upgrade add="false"/>
+  </property>
+</configuration>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/ranger-trino-security.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/ranger-trino-security.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/ranger-trino-security.xml
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/ranger-trino-security.xml	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,119 @@
+<?xml version="1.0"?>
+<!--
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+<configuration>
+  <property>
+    <name>ranger.plugin.trino.service.name</name>
+    <value>{{repo_name}}</value>
+    <description>Name of the Ranger service containing Trino policies</description>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>ranger.plugin.trino.policy.source.impl</name>
+    <value>org.apache.ranger.admin.client.RangerAdminRESTClient</value>
+    <description>Class to retrieve policies from the source</description>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>ranger.plugin.trino.policy.rest.url</name>
+    <value>{{policymgr_mgr_url}}</value>
+    <description>URL to Ranger Admin</description>
+    <on-ambari-upgrade add="false"/>
+    <depends-on>
+      <property>
+        <type>admin-properties</type>
+        <name>policymgr_external_url</name>
+      </property>
+    </depends-on>
+  </property>
+  <property>
+    <name>ranger.plugin.trino.policy.rest.ssl.config.file</name>
+    <value>/etc/trino/conf/ranger-policymgr-ssl.xml</value>
+    <description>Path to the file containing SSL details to contact Ranger Admin</description>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>ranger.plugin.trino.policy.pollIntervalMs</name>
+    <value>30000</value>
+    <description>How often to poll for changes in policies?</description>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>ranger.plugin.trino.policy.cache.dir</name>
+    <value>/etc/ranger/{{repo_name}}/policycache</value>
+    <description>Directory where Ranger policies are cached after successful retrieval from the source</description>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>xasecure.trino.update.xapolicies.on.grant.revoke</name>
+    <value>true</value>
+    <display-name>Should Trino GRANT/REVOKE update XA policies</display-name>
+    <description>Should Trino plugin update Ranger policies for updates to permissions done using GRANT/REVOKE?</description>
+    <value-attributes>
+      <type>boolean</type>
+    </value-attributes>
+    <on-ambari-upgrade add="false"/>
+  </property>
+
+  <property>
+    <name>ranger.plugin.trino.access.cluster.name</name>
+    <value>{{cluster_name}}</value>
+    <description>Name to identify the cluster running the Trino instance. This is recorded in audit logs generated by the plugin</description>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>ranger.plugin.trino.super.users</name>
+    <value></value>
+    <value-attributes>
+      <empty-value-valid>true</empty-value-valid>
+    </value-attributes>
+    <description>Comma separated list of user names. Superusers will be authorized for all accesses, without requiring explicit policy grants.</description>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>ranger.plugin.trino.super.groups</name>
+    <value></value>
+    <value-attributes>
+      <empty-value-valid>true</empty-value-valid>
+    </value-attributes>
+    <description>Comma separated list of group names. Users in supergroups will be authorized for all accesses, without requiring explicit policy grants.</description>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>ranger.plugin.trino.use.rangerGroups</name>
+    <value>false</value>
+    <display-name>ranger.plugin.trino.use.rangerGroups</display-name>
+    <description>Boolean flag to specify whether user-to-groups mapping should be obtained from in Apache Ranger. Default: false</description>
+    <value-attributes>
+      <type>boolean</type>
+    </value-attributes>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>ranger.plugin.trino.use.only.rangerGroups</name>
+    <value>false</value>
+    <display-name>ranger.plugin.trino.use.only.rangerGroups</display-name>
+    <description>Boolean flag. true: use only user-to-groups mapping from Apache Ranger; false: use user-to-groups mappings from Apache Ranger and Trino. Default: false</description>
+    <value-attributes>
+      <type>boolean</type>
+    </value-attributes>
+    <on-ambari-upgrade add="false"/>
+  </property>
+</configuration>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/resource-groups-json.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/resource-groups-json.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/resource-groups-json.xml
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/resource-groups-json.xml	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,59 @@
+<?xml version="1.0"?>
+<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
+<!--
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+<configuration>
+    <property>
+        <name>content</name>
+        <value>{
+  "rootGroups": [
+    {
+      "name": "global",
+      "softMemoryLimit": "80%",
+      "hardConcurrencyLimit": 50,
+      "maxQueued": 100,
+      "schedulingPolicy": "weighted",
+      "jmxExport": false
+    }
+  ],
+  "selectors": [
+    {
+      "source": ".*cli.*",
+      "group": "global"
+    },
+    {
+    "source": "jdbc.*",
+    "group": "global"
+    }
+  ],
+  "cpuQuotaPeriod": "1h"
+}
+
+        </value>
+        <description>
+
+        </description>
+        <value-attributes>
+            <type>content</type>
+            <show-property-name>false</show-property-name>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>
+</configuration>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/resource-groups-properties.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/resource-groups-properties.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/resource-groups-properties.xml
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/resource-groups-properties.xml	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,43 @@
+<?xml version="1.0"?>
+<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
+<!--
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+<configuration>
+    <property>
+        <name>resource-groups.configuration-manager</name>
+        <value>file</value>
+        <description>
+            resource-groups.configuration-manager
+        </description>
+		<on-ambari-upgrade add="false"/>
+    </property>
+
+    <property>
+        <name>resource-groups.config-file</name>
+        <value>/etc/trino/conf/resource-groups.json</value>
+        <description>
+            resource-groups.config-file
+        </description>
+		<on-ambari-upgrade add="false"/>
+    </property>
+
+
+
+</configuration>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/rules-json.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/rules-json.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/rules-json.xml
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/rules-json.xml	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,40 @@
+<?xml version="1.0"?>
+<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
+<!--
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+<configuration>
+    <property>
+        <name>content</name>
+        <value>{
+  "schemas": []
+}
+        </value>
+        <description>
+		{
+  "schemas": []
+}
+        </description>
+        <value-attributes>
+            <type>content</type>
+            <show-property-name>false</show-property-name>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>
+</configuration>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/session-property-config-json.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/session-property-config-json.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/session-property-config-json.xml
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/session-property-config-json.xml	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,43 @@
+<?xml version="1.0"?>
+<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
+<!--
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+<configuration>
+    <property>
+        <name>content</name>
+        <value>[
+    {
+        "group": "global.*",
+        "sessionProperties": {
+            "query_max_execution_time": "8h"
+        }
+    }
+]
+        </value>
+        <description>
+
+        </description>
+        <value-attributes>
+            <type>content</type>
+            <show-property-name>false</show-property-name>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>
+</configuration>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/session-property-config-properties.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/session-property-config-properties.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/session-property-config-properties.xml
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/session-property-config-properties.xml	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,43 @@
+<?xml version="1.0"?>
+<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
+<!--
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+<configuration>
+    <property>
+        <name>session-property-config.configuration-manager</name>
+        <value>file</value>
+        <description>
+            session-property-config.configuration-manager
+        </description>
+		<on-ambari-upgrade add="false"/>
+    </property>
+
+    <property>
+        <name>session-property-manager.config-file</name>
+        <value>/etc/trino/conf/session-property-config.json</value>
+        <description>
+           session-property-config.json
+        </description>
+		<on-ambari-upgrade add="false"/>
+    </property>
+
+
+
+</configuration>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/trino-env.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/trino-env.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/trino-env.xml
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/trino-env.xml	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,127 @@
+<?xml version="1.0"?>
+<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
+<!--
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+<configuration supports_adding_forbidden="true">
+    <property>
+        <name>trino_user</name>
+        <display-name>trino User</display-name>
+        <value>trino</value>
+        <property-type>USER</property-type>
+        <value-attributes>
+            <type>user</type>
+            <overridable>false</overridable>
+            <user-groups>
+                <property>
+                    <type>cluster-env</type>
+                    <name>user_group</name>
+                </property>
+                <property>
+                    <type>trino-env</type>
+                    <name>trino_group</name>
+                </property>
+            </user-groups>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>
+    <property>
+        <name>trino_group</name>
+        <display-name>trino Group</display-name>
+        <value>hadoop</value>
+        <property-type>GROUP</property-type>
+        <description>trino group</description>
+        <value-attributes>
+            <type>user</type>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>
+    <property>
+        <name>trino_log_dir</name>
+        <display-name>trino Log directory</display-name>
+        <value>/var/log/trino</value>
+        <description>trino Log Dir</description>
+        <value-attributes>
+            <type>directory</type>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>
+
+   <property>
+    <name>trino_pid_dir</name>
+    <value>/var/run/trino</value>
+    <display-name>trino Pid Dir</display-name>
+    <description>Dir containing process ID file</description>
+    <value-attributes>
+      <type>directory</type>
+      <overridable>false</overridable>
+      <editable-only-at-install>true</editable-only-at-install>
+    </value-attributes>
+    <on-ambari-upgrade add="true"/>
+  </property>
+
+
+  <property>
+    <name>trino_jdk_home</name>
+    <value>/opt/modules/jdk-23.0.2+7/</value>
+    <display-name>trino_jdk_home</display-name>
+    <description>trino_jdk_home</description>
+  </property>
+
+  <property>
+    <name>trino_principal</name>
+    <description>trino principal name</description>
+    <property-type>KERBEROS_PRINCIPAL</property-type>
+    <on-ambari-upgrade add="true"/>
+  </property>
+  <property>
+    <name>trino_keytab</name>
+    <description>trino keytab path</description>
+    <on-ambari-upgrade add="true"/>
+  </property>
+
+  <property>
+    <name>trino_user_nofile_limit</name>
+    <value>131072</value>
+    <description>Max open files limit setting for TRINO user.</description>
+    <on-ambari-upgrade add="false"/>
+  </property>
+  <property>
+    <name>trino_user_nproc_limit</name>
+    <value>128000</value>
+    <description>Max number of processes limit setting for TRINO user.</description>
+    <on-ambari-upgrade add="false"/>
+  </property>
+
+  <property>
+    <name>file.user.trino.password</name>
+     <value>trino</value>
+    <property-type>PASSWORD</property-type>
+    <display-name>Trino Password</display-name>
+    <description>password to use trino</description>
+    <value-attributes>
+      <type>password</type>
+      <overridable>false</overridable>
+      <hidden>TRINO_CLI,CONFIG_DOWNLOAD</hidden>
+      <keystore>true</keystore>
+    </value-attributes>
+    <on-ambari-upgrade add="false"/>
+  </property>
+
+</configuration>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/trino-ranger-plugin-logback.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/trino-ranger-plugin-logback.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/trino-ranger-plugin-logback.xml
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/configuration/trino-ranger-plugin-logback.xml	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,79 @@
+<?xml version="1.0"?>
+<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
+<!--
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+<configuration supports_final="false" supports_adding_forbidden="false">
+  <property>
+    <name>content</name>
+    <display-name>trino-ranger-plugin-logback template</display-name>
+    <description>trino-ranger-plugin-logback.xml</description>
+    <value><![CDATA[<?xml version="1.0" encoding="UTF-8"?>
+<!--
+  Licensed to the Apache Software Foundation (ASF) under one or more
+  contributor license agreements.  See the NOTICE file distributed with
+  this work for additional information regarding copyright ownership.
+  The ASF licenses this file to You under the Apache License, Version 2.0
+  (the "License"); you may not use this file except in compliance with
+  the License.  You may obtain a copy of the License at
+
+      http://www.apache.org/licenses/LICENSE-2.0
+
+  Unless required by applicable law or agreed to in writing, software
+  distributed under the License is distributed on an "AS IS" BASIS,
+  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+  See the License for the specific language governing permissions and
+  limitations under the License.
+-->
+
+<configuration scan="true" scanPeriod="30 seconds">
+    <appender name="console" class="ch.qos.logback.core.ConsoleAppender">
+        <Target>System.out</Target>
+        <encoder>
+            <pattern>%-5p - %m</pattern>
+        </encoder>
+    </appender>
+
+    <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
+        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
+            <FileNamePattern>/data/trino/data/var/log/ranger.log.%d{yyyy-MM-dd}.log</FileNamePattern>
+            <MaxHistory>30</MaxHistory>
+        </rollingPolicy>
+        <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
+            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n</pattern>
+        </encoder>
+        <triggeringPolicy class="ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy">
+            <MaxFileSize>10MB</MaxFileSize>
+        </triggeringPolicy>
+    </appender>
+
+    <root level="INFO">
+        <appender-ref ref="console"/>
+        <appender-ref ref="FILE" />
+    </root>
+</configuration>
+]]>
+    </value>
+    <value-attributes>
+      <type>content</type>
+      <show-property-name>false</show-property-name>
+    </value-attributes>
+    <on-ambari-upgrade add="true"/>
+  </property>
+</configuration>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/kerberos.json
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/kerberos.json b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/kerberos.json
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/kerberos.json	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,36 @@
+{
+  "services": [
+    {
+      "name": "TRINO",
+      "identities": [
+        {
+          "name": "/spnego"
+        },
+		{
+              "name": "trino user",
+              "principal": {
+                "value": "trino@${realm}",
+                "type": "user",
+                "local_username": "${trino-env/trino_user}",
+				"configuration": "trino-env/trino_principal"
+              },
+              "keytab": {
+                "file": "${keytab_dir}/trino.keytab",
+                "owner": {
+                  "name": "${trino-env/trino_user}",
+                  "access": "r"
+                },
+                "group": {
+                  "name": "${cluster-env/user_group}",
+                  "access": ""
+                },
+				"configuration": "trino-env/trino_keytab"
+              }
+            }
+      ],
+      "components": [
+
+      ]
+    }
+  ]
+}
\ No newline at end of file
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/metainfo.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/metainfo.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/metainfo.xml
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/metainfo.xml	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,119 @@
+<?xml version="1.0"?>
+<!--
+# -*- coding: utf-8 -*-
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+# http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+-->
+<metainfo>
+    <schemaVersion>2.0</schemaVersion>
+    <services>
+        <service>
+            <name>TRINO</name>
+            <displayName>Trino</displayName>
+            <comment>Component Trino Integrated By JaneTTR . For commercial use, please contact mail: 3832514048@qq.com</comment>
+            <version>474</version>
+			<selection>TECH_PREVIEW</selection>
+            <components>
+                <component>
+                    <name>TRINO_COORDINATOR</name>
+                    <displayName>Trino Coordinator</displayName>
+                    <category>MASTER</category>
+                    <cardinality>1+</cardinality>
+                    <versionAdvertised>true</versionAdvertised>
+                    <recovery_enabled>true</recovery_enabled>
+                    <commandScript>
+                        <script>scripts/trino_coordinator.py</script>
+                        <scriptType>PYTHON</scriptType>
+                        <timeout>1200</timeout>
+                    </commandScript>
+                </component>
+
+                <component>
+                    <name>TRINO_WORKER</name>
+                    <displayName>Trino Worker</displayName>
+                    <category>SLAVE</category>
+                    <cardinality>1+</cardinality>
+                    <versionAdvertised>true</versionAdvertised>
+                    <recovery_enabled>true</recovery_enabled>
+                    <commandScript>
+                        <script>scripts/trino_worker.py</script>
+                        <scriptType>PYTHON</scriptType>
+                    </commandScript>
+                </component>
+
+                <component>
+                    <name>TRINO_CLI</name>
+                    <displayName>Trino Client</displayName>
+                    <category>CLIENT</category>
+                    <cardinality>0+</cardinality>
+                    <versionAdvertised>true</versionAdvertised>
+                    <commandScript>
+                        <script>scripts/trino_cli.py</script>
+                        <scriptType>PYTHON</scriptType>
+                    </commandScript>
+                </component>
+            </components>
+
+            <configuration-dependencies>
+                <config-type>config-properties</config-type>
+                <config-type>log-properties</config-type>
+                <config-type>jvm-config</config-type>
+                <config-type>node-properties</config-type>
+				<config-type>connectors-properties</config-type>
+				<config-type>group-provider-properties</config-type>
+				<config-type>group-txt</config-type>				.
+				<config-type>access-control-properties</config-type>
+				<config-type>password-authenticator-properties</config-type>
+				<config-type>access-control-properties</config-type>
+				<config-type>rules-json</config-type>
+				<config-type>resource-groups-properties</config-type>
+				<config-type>resource-groups-json</config-type>
+				<config-type>session-property-config-properties</config-type>
+				<config-type>session-property-config-json</config-type>
+				<config-type>event-listener-properties</config-type>
+				<config-type>ranger-trino-audit</config-type>
+				<config-type>ranger-trino-plugin-properties</config-type>
+				<config-type>ranger-trino-policymgr-ssl</config-type>
+				<config-type>ranger-trino-security</config-type>
+				<config-type>trino-ranger-plugin-logback</config-type>
+            </configuration-dependencies>
+			<restartRequiredAfterChange>true</restartRequiredAfterChange>
+
+      <osSpecifics>
+        <osSpecific>
+          <osFamily>any</osFamily>
+          <packages>
+            <package>
+              <name>trino_${stack_version}-trino-server</name>
+            </package>
+			<package>
+              <name>trino_${stack_version}-trino-cli</name>
+            </package>
+			<package>
+              <name>httpd-tools</name>
+            </package>
+          </packages>
+        </osSpecific>
+      </osSpecifics>
+
+            <quickLinksConfigurations>
+                <quickLinksConfiguration>
+                    <fileName>quicklinks.json</fileName>
+                    <default>true</default>
+                </quickLinksConfiguration>
+            </quickLinksConfigurations>
+
+
+        </service>
+    </services>
+</metainfo>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/common.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/common.py b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/common.py
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/common.py	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,86 @@
+# -*- coding: utf-8 -*-
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+# http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+import os
+
+from resource_management.core.resources.system import Execute
+import re
+from resource_management import *
+
+
+def recursive_glob(rootdir=".", suffix="", filter_func=None):
+    import glob
+    import os
+
+    """Recursively glob files with a specific suffix from rootdir, and apply an optional filter."""
+    files = [
+        os.path.join(looproot, filename)
+        for looproot, _, filenames in os.walk(rootdir)
+        for filename in filenames
+        if filename.endswith(suffix)
+    ]
+    # 如果提供了过滤函数，进一步过滤文件列表
+    if filter_func is not None:
+        files = [file for file in files if filter_func(file)]
+    return files
+
+
+def process_connector_conf(catalog_conf_dir, trino_user, trino_group):
+    white_list = ["jmx", "tpcds", "tpch"]
+
+    config = Script.get_config()
+    connector_lists = {
+        k: v
+        for k, v in list(config["configurations"]["connectors.properties"].items())
+        if k.startswith("connector_")
+    }
+    for k, v in list(connector_lists.items()):
+        connector_tpl_content = config["configurations"]["connectors.properties"][k]
+        connector_tpl_content_dict = dict(
+            item.split("=") for item in connector_tpl_content.split("\\n")
+        )
+
+        connector_name = k.split("_")[1]
+        connector_file = os.path.join(catalog_conf_dir, connector_name + ".properties")
+        print(
+            "writing connector file to {0} {1}".format(connector_file, connector_tpl_content_dict)
+        )
+
+        PropertiesFile(
+            connector_file,
+            properties=connector_tpl_content_dict,
+            owner=trino_user,
+            group=trino_group,
+        )
+
+    # 遍历删除catalog 目录下所有 .properties
+    connector_filepaths = recursive_glob(catalog_conf_dir, ".properties")
+    connector_name_lists = {
+        k.split("connector_")[1]
+        for k, v in list(config["configurations"]["connectors.properties"].items())
+        if k.startswith("connector_")
+    }
+    for filepath in connector_filepaths:
+        connector_file_name = os.path.basename(filepath)
+        connector_name = connector_file_name.split(".properties")[0]
+        if (
+                connector_name not in connector_name_lists
+                and connector_name not in white_list
+        ):
+            print(" connector file will be removed {0}".format(filepath))
+            File(filepath, action="delete")
+
+
+def check_jdk_version():
+    pass
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/params.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/params.py b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/params.py
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/params.py	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,657 @@
+#!/usr/bin/env python
+# -*- coding: utf-8 -*-
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+# http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+import os, re
+import uuid
+import resource_management.libraries.functions
+from resource_management import *
+from ambari_commons.os_check import OSCheck
+from ambari_commons.str_utils import cbool, cint
+from resource_management.libraries.functions import StackFeature
+from resource_management.libraries.functions import conf_select
+from resource_management.libraries.functions import get_kinit_path
+from resource_management.libraries.functions import stack_select
+from resource_management.libraries.functions.default import default
+from resource_management.libraries.functions.format import format
+from resource_management.libraries.functions.get_stack_version import get_stack_version
+from resource_management.libraries.functions.stack_features import check_stack_feature
+from resource_management.libraries.functions.version import format_stack_version
+from resource_management.libraries.resources.hdfs_resource import HdfsResource
+from resource_management.libraries.functions.get_not_managed_resources import (
+    get_not_managed_resources,
+)
+from resource_management.libraries.script.script import Script
+from resource_management.libraries.functions.get_architecture import get_architecture
+from resource_management.libraries.functions.copy_tarball import get_current_version
+from resource_management.libraries.functions.stack_features import (
+    check_stack_feature,
+    get_stack_feature_version,
+)
+from resource_management.libraries.functions import StackFeature
+
+import status_params
+
+from resource_management.libraries.functions.setup_ranger_plugin_xml import (
+    generate_ranger_service_config,
+)
+from resource_management.libraries.functions.setup_ranger_plugin_xml import (
+    get_audit_configs,
+)
+
+host_sys_prepped = default("/hostLevelParams/host_sys_prepped", False)
+retryAble = default("/commandParams/command_retry_enabled", False)
+
+# config object that holds the configurations declared in the config xml file
+config = Script.get_config()
+
+cluster_name = config["clusterName"]
+stack_name = default("/clusterLevelParams/stack_name", None)
+stack_root = Script.get_stack_root()
+# 3.2
+stack_version_unformatted = config["clusterLevelParams"]["stack_version"]
+# 3.2.0.0
+stack_version_formatted = format_stack_version(stack_version_unformatted)
+# 3.2
+major_stack_version = get_major_version(stack_version_formatted)
+
+# 3.2.1.0-001
+effective_version = get_current_version(service="TRINO")
+
+host_info = config["clusterHostInfo"]
+host_level_params = config["hostLevelParams"]
+
+java64_home = config["ambariLevelParams"]["java_home"]
+
+hostname = config["agentLevelParams"]["hostname"]
+hostname_lowercase = config["agentLevelParams"]["hostname"].lower()
+
+jvm_config = config["configurations"]["jvm-config"]
+trino_jvm_config_content = config["configurations"]["jvm-config"]["content"]
+
+config_properties = dict(config['configurations']['config-properties'])
+http_server_authentication_type = default('/configurations/config-properties/http-server.authentication.type', "")
+http_server_authentication_type = http_server_authentication_type.strip()
+if http_server_authentication_type == '' or http_server_authentication_type.lower() == 'none':
+    config_properties.pop('http-server.authentication.type', None)
+
+# http_server_http_port = config['configurations']['config-properties']['http-server.http.port']
+http_server_http_port = default('/configurations/config-properties/http-server.http.port', "8380")
+https_server_http_port = default('/configurations/config-properties/http-server.https.port', "8443")
+http_server_https_enabled = default('/configurations/config-properties/http-server.https.enabled', False)
+internal_communication_https_required = default(
+    '/configurations/config-properties/internal-communication.https.required', False)
+
+coordinator_hosts = default("/clusterHostInfo/trino_coordinator_hosts", [])
+coordinator_host = coordinator_hosts[0] if len(coordinator_hosts) > 0 else None
+discovery_uri = 'http://{0}:{1}'.format(coordinator_host, http_server_http_port)
+if http_server_https_enabled:
+    if internal_communication_https_required:
+        discovery_uri = 'https://{0}:{1}'.format(coordinator_host, https_server_http_port)
+else:
+    config_properties.pop('http-server.https.keystore.path', None)
+    config_properties.pop('http-server.https.keystore.key', None)
+    config_properties.pop('http-server.https.port', None)
+
+config_properties = dict(config["configurations"]["config-properties"])
+
+# application_properties["discovery.uri"] = discovery_uri
+
+config_properties["coordinator"] = "false"
+if hostname in coordinator_hosts or hostname_lowercase in coordinator_hosts:
+    config_properties["coordinator"] = "true"
+
+spiller_spill_path = config["configurations"]["config-properties"]["spiller-spill-path"]
+
+# application properties
+node_properties = dict(config["configurations"]["node-properties"])
+node_properties["node.id"] = str(uuid.uuid4())
+
+node_data_dir = config["configurations"]["node-properties"]["node.data-dir"]
+
+trino_log_properties_content = config["configurations"]["log-properties"]["content"]
+
+memory_configs = ["query.max-memory-per-node", "query.max-memory"]
+
+# jdk_home
+trino_jdk_home = config["configurations"]["trino-env"]["trino_jdk_home"]
+trino_log_dir = config["configurations"]["trino-env"]["trino_log_dir"]
+trino_pid_dir = config["configurations"]["trino-env"]["trino_pid_dir"]
+
+# trino_coordinator_pid_file =  format('{trino_pid_dir}/trino_coordinator.pid')
+# trino_worker_pid_file =  format('{trino_pid_dir}/trino_worker.pid')
+trino_pid_file = format("{trino_pid_dir}/launcher.pid")
+
+trino_coordinator_out_file = format("{trino_log_dir}/trino_coordinator.out")
+trino_worker_out_file = format("{trino_log_dir}/trino_worker.out")
+
+trino_server_log = format("{trino_log_dir}/server.log")
+trino_launcher_log = format("{trino_log_dir}/launcher.log")
+
+trino_dir = "/usr/bigtop/current/trino"
+trino_home = "/usr/bigtop/current/trino"
+trino_bin_dir = format("{trino_dir}/bin")
+plugin_dir = "{0}/plugin".format(trino_home)
+catalog_conf_dir = "{0}/etc/catalog".format(trino_home)
+trino_node_data_dir = "{0}".format(trino_home)
+
+trino_user = config["configurations"]["trino-env"]["trino_user"]
+trino_group = config["configurations"]["trino-env"]["trino_group"]
+user_group = config["configurations"]["cluster-env"]["user_group"]
+
+limits_conf_dir = "/etc/security/limits.d"
+trino_user_nofile_limit = default(
+    "/configurations/trino-env/trino_user_nofile_limit", "131072"
+)
+trino_user_nproc_limit = default(
+    "/configurations/trino-env/trino_user_nproc_limit", "128000"
+)
+
+trino_conf_dir = "/etc/trino/conf"
+
+# Password file authentication
+file_user_trino_password = config["configurations"]["trino-env"][
+    "file.user.trino.password"
+]
+password_authenticator_name = config["configurations"][
+    "password-authenticator-properties"
+]["password-authenticator.name"]
+password_authenticator_properties = dict(
+    config["configurations"]["password-authenticator-properties"]
+)
+file_password_file = config["configurations"]["password-authenticator-properties"][
+    "file.password-file"
+]
+
+if password_authenticator_name.lower() != 'file':
+    print("clear config:password-authenticator.name not 'file'")
+    password_authenticator_properties.pop('file.auth-token-cache.max-size', None)
+    password_authenticator_properties.pop('file.password-file', None)
+
+if password_authenticator_name.lower() != 'ldap':
+    print("clear config:password-authenticator.name not 'ldap'")
+    password_authenticator_properties.pop('ldap.url', None)
+    password_authenticator_properties.pop('ldap.allow-insecure', None)
+    password_authenticator_properties.pop('ldap.user-bind-pattern', None)
+
+# File group provider
+group_provider_properties = dict(config["configurations"]["group-provider-properties"])
+group_provider_name = config["configurations"]["group-provider-propertiess"][
+    "group-provider.name"
+]
+file_group_file = config["configurations"]["group-provider-properties"][
+    "file.group-file"
+]
+file_group_file_content = config["configurations"]["group-txt"]["content"]
+
+# access-control
+access_control_properties = dict(config["configurations"]["access-control-properties"])
+access_control_name = config["configurations"]["access-control-properties"][
+    "access-control.name"
+]
+security_config_file = None
+security_config_file_content = None
+if access_control_name == "file":
+    security_config_file = config["configurations"]["access-control-properties"][
+        "security.config-file"
+    ]
+    security_config_file_content = config["configurations"]["rules-json"]["content"]
+
+ranger_plugin_home = "{0}/apache-ranger".format(plugin_dir)
+
+if access_control_name == "ranger":
+    # Configure logback file
+    trino_ranger_plugin_logback_file = "/etc/trino/conf/trino-ranger-plugin-logback.xml"
+    trino_jvm_config_content = format(
+        "{trino_jvm_config_content} \n-Dlogback.configurationFile={trino_ranger_plugin_logback_file}"
+    )
+    # print(trino_jvm_config_content)
+
+trino_ranger_plugin_logback_content = config["configurations"][
+    "trino-ranger-plugin-logback"
+]["content"]
+
+# resource-groups-properties
+resource_groups_properties = dict(
+    config["configurations"]["resource-groups-properties"]
+)
+resource_groups_configuration_manager = config["configurations"][
+    "resource-groups-properties"
+]["resource-groups.configuration-manager"]
+resource_groups_json_file = config["configurations"]["resource-groups-properties"][
+    "resource-groups.config-file"
+]
+resource_groups_json_file_content = config["configurations"]["resource-groups-json"][
+    "content"
+]
+
+# session-property-config-properties
+session_property_config_properties = dict(
+    config["configurations"]["session-property-config-properties"]
+)
+session_property_config_configuration_manager = config["configurations"][
+    "session-property-config-properties"
+]["resource-groups.configuration-manager"]
+session_property_manager_config_file = config["configurations"][
+    "session-property-config-properties"
+]["session-property-manager.config-file"]
+session_property_manager_config_file_content = config["configurations"][
+    "session-property-config-json"
+]["content"]
+
+# enable.event-listener
+
+enable_event_listener = config["configurations"]["event-listener-properties"][
+    "enable.event-listener"
+]
+enable_event_listener_content = config["configurations"]["event-listener-properties"][
+    "content"
+]
+
+# configurations of security
+hostname = config["agentLevelParams"]["hostname"]
+kinit_path_local = get_kinit_path(
+    default("/configurations/kerberos-env/executable_search_paths", None)
+)
+authentication_type = "NONE"
+trino_principal = ""
+trino_keytab = ""
+security_enabled = config["configurations"]["cluster-env"]["security_enabled"]
+if security_enabled:
+    trino_principal = config["configurations"]["trino-env"]["trino_principal"]
+    trino_keytab = config["configurations"]["trino-env"]["trino_keytab"]
+    authentication_type = "KERBEROS"
+
+# connectors-properties
+trino_connectors_dir = format("{trino_conf_dir}/catalog")
+hive_metastore_hosts = default("/clusterHostInfo/hive_metastore_hosts", [])
+
+# print(hive_metastore_hosts)
+
+has_hive_metastore = not len(hive_metastore_hosts) == 0
+
+# print(has_hive_metastore)
+
+hive_metastore_uris = default(
+    "/configurations/hive-site/hive.metastore.uris", "thirift://localhost:8083"
+)
+trino_connectors_content_orgin = config["configurations"]["connectors-properties"][
+    "connectors"
+]
+# print(trino_connectors_content_orgin)
+# print(__name__)
+trino_connectors_content_inline = InlineTemplate(
+    trino_connectors_content_orgin,
+    has_hive_metastore=has_hive_metastore,
+    hive_metastore_uris=hive_metastore_uris,
+    security_enabled=security_enabled,
+    trino_principal=trino_principal,
+    trino_keytab=trino_keytab,
+    authentication_type=authentication_type,
+)
+
+trino_connectors_content = trino_connectors_content_inline.get_content()
+# print(hive_metastore_uris)
+# print(trino_connectors_content)
+
+
+component_directory = status_params.component_directory
+
+# get the correct version to use for checking stack features
+version_for_stack_feature_checks = get_stack_feature_version(config)
+
+stack_supports_ranger_kerberos = check_stack_feature(
+    StackFeature.RANGER_KERBEROS_SUPPORT, version_for_stack_feature_checks
+)
+stack_supports_ranger_audit_db = check_stack_feature(
+    StackFeature.RANGER_AUDIT_DB_SUPPORT, version_for_stack_feature_checks
+)
+
+# ranger trino plugin section start
+
+hdfs_user = config["configurations"]["hadoop-env"]["hdfs_user"]
+
+# to get db connector jar
+jdk_location = config["ambariLevelParams"]["jdk_location"]
+
+# ranger host
+ranger_admin_hosts = default("/clusterHostInfo/ranger_admin_hosts", [])
+has_ranger_admin = not len(ranger_admin_hosts) == 0
+
+# ranger support xml_configuration flag, instead of depending on ranger xml_configurations_supported/ranger-env introduced, using stack feature
+xml_configurations_supported = check_stack_feature(
+    StackFeature.RANGER_XML_CONFIGURATION, version_for_stack_feature_checks
+)
+
+# ranger trino plugin enabled property
+enable_ranger_trino = default(
+    "/configurations/ranger-trino-plugin-properties/ranger-trino-plugin-enabled", "No"
+)
+# Logger.info("/configurations/ranger-trino-plugin-properties/ranger-trino-plugin-enabled")
+# Logger.info(enable_ranger_trino)
+enable_ranger_trino = True if enable_ranger_trino.lower() == "yes" else False
+# Logger.info(enable_ranger_trino)
+
+policymgr_mgr_url = config["configurations"]["admin-properties"][
+    "policymgr_external_url"
+]
+
+# ranger trino service/repository name
+repo_name = str(config["clusterName"]) + "_trino"
+repo_name_value = config["configurations"]["ranger-trino-security"][
+    "ranger.plugin.trino.service.name"
+]
+if not is_empty(repo_name_value) and repo_name_value != "{{repo_name}}":
+    repo_name = repo_name_value
+
+trino_ranger_service_name = repo_name
+trino_service_name = "trino"
+ranger_config_resource = "{0}/ranger-{1}-security.xml,{0}/ranger-{1}-audit.xml,{0}/ranger-policymgr-ssl.xml".format(
+    trino_conf_dir, trino_service_name)
+
+# ranger trino properties
+if enable_ranger_trino:
+    access_control_properties["apache-ranger.service.name"] = trino_ranger_service_name
+    access_control_properties["apache-ranger.plugin.config.resource"] = ranger_config_resource
+    # get ranger policy url
+    policymgr_mgr_url = config["configurations"]["admin-properties"][
+        "policymgr_external_url"
+    ]
+    Logger.info(policymgr_mgr_url)
+    # can't get vaelue,temp enable it
+    # if xml_configurations_supported:
+    #  policymgr_mgr_url = config['configurations']['ranger-trino-security']['ranger.plugin.trino.policy.rest.url']
+
+    if not is_empty(policymgr_mgr_url) and policymgr_mgr_url.endswith("/"):
+        policymgr_mgr_url = policymgr_mgr_url.rstrip("/")
+
+    # ranger audit db user
+    xa_audit_db_user = default(
+        "/configurations/admin-properties/audit_db_user", "rangerlogger"
+    )
+
+    # ranger trino service/repository name
+    repo_name = str(config['clusterName']) + '_trino'
+    repo_name_value = config['configurations']['ranger-trino-security']['ranger.plugin.trino.service.name']
+    if not is_empty(repo_name_value) and repo_name_value != "{{repo_name}}":
+        repo_name = repo_name_value
+
+    common_name_for_certificate = config["configurations"][
+        "ranger-trino-plugin-properties"
+    ]["common.name.for.certificate"]
+    repo_config_username = config["configurations"]["ranger-trino-plugin-properties"][
+        "REPOSITORY_CONFIG_USERNAME"
+    ]
+    ranger_plugin_properties = config["configurations"][
+        "ranger-trino-plugin-properties"
+    ]
+    policy_user = config["configurations"]["ranger-trino-plugin-properties"][
+        "policy_user"
+    ]
+    repo_config_password = config["configurations"]["ranger-trino-plugin-properties"][
+        "REPOSITORY_CONFIG_PASSWORD"
+    ]
+
+    # ranger-env config
+    ranger_env = config["configurations"]["ranger-env"]
+
+    # create ranger-env config having external ranger credential properties
+    if not has_ranger_admin and enable_ranger_trino:
+        external_admin_username = default(
+            "/configurations/ranger-trino-plugin-properties/external_admin_username",
+            "admin",
+        )
+        external_admin_password = default(
+            "/configurations/ranger-trino-plugin-properties/external_admin_password",
+            "admin",
+        )
+        external_ranger_admin_username = default(
+            "/configurations/ranger-trino-plugin-properties/external_ranger_admin_username",
+            "amb_ranger_admin",
+        )
+        external_ranger_admin_password = default(
+            "/configurations/ranger-trino-plugin-properties/external_ranger_admin_password",
+            "amb_ranger_admin",
+        )
+        ranger_env = {}
+        ranger_env["admin_username"] = external_admin_username
+        ranger_env["admin_password"] = external_admin_password
+        ranger_env["ranger_admin_username"] = external_ranger_admin_username
+        ranger_env["ranger_admin_password"] = external_ranger_admin_password
+
+    xa_audit_db_password = ""
+    if (
+            not is_empty(config["configurations"]["admin-properties"]["audit_db_password"])
+            and stack_supports_ranger_audit_db
+            and has_ranger_admin
+    ):
+        xa_audit_db_password = config["configurations"]["admin-properties"][
+            "audit_db_password"
+        ]
+
+    downloaded_custom_connector = None
+    previous_jdbc_jar_name = None
+    driver_curl_source = None
+    driver_curl_target = None
+    previous_jdbc_jar = None
+
+    if has_ranger_admin and stack_supports_ranger_audit_db:
+        xa_audit_db_flavor = config["configurations"]["admin-properties"]["DB_FLAVOR"]
+        jdbc_jar_name, previous_jdbc_jar_name, audit_jdbc_url, jdbc_driver = (
+            get_audit_configs(config)
+        )
+
+        downloaded_custom_connector = (
+            format("{exec_tmp_dir}/{jdbc_jar_name}")
+            if stack_supports_ranger_audit_db
+            else None
+        )
+        driver_curl_source = (
+            format("{jdk_location}/{jdbc_jar_name}")
+            if stack_supports_ranger_audit_db
+            else None
+        )
+        driver_curl_target = (
+            format("{stack_root}/current/{component_directory}/lib/{jdbc_jar_name}")
+            if stack_supports_ranger_audit_db
+            else None
+        )
+        previous_jdbc_jar = (
+            format(
+                "{stack_root}/current/{component_directory}/lib/{previous_jdbc_jar_name}"
+            )
+            if stack_supports_ranger_audit_db
+            else None
+        )
+        sql_connector_jar = ""
+
+    trino_ranger_plugin_config = {
+        "username": repo_config_username,
+        #    'password': repo_config_password,
+        "jdbc.driverClassName": "io.trino.jdbc.TrinoDriver",
+        "jdbc.url": format("jdbc:trino://{coordinator_host}:{http_server_http_port}"),
+    }
+
+    if security_enabled:
+        trino_ranger_plugin_config["policy.download.auth.users"] = trino_user
+        trino_ranger_plugin_config["tag.download.auth.users"] = trino_user
+        trino_ranger_plugin_config["policy.grantrevoke.auth.users"] = trino_user
+
+    # there is something wrong when enable kerberos, infomation can't be updated,so init first
+    trino_ranger_plugin_config["policy.download.auth.users"] = trino_user
+    trino_ranger_plugin_config["tag.download.auth.users"] = trino_user
+    trino_ranger_plugin_config["policy.grantrevoke.auth.users"] = trino_user
+
+    # TODO:
+    # trino_ranger_plugin_config['setup.additional.default.policies'] = "true"
+    # trino_ranger_plugin_config['default-policy.1.name'] = "Service Check User Policy for trino"
+    # trino_ranger_plugin_config['default-policy.1.resource.table'] = "ambarismoketest"
+    # trino_ranger_plugin_config['default-policy.1.resource.column-family'] = "*"
+    # trino_ranger_plugin_config['default-policy.1.resource.column'] = "*"
+    # trino_ranger_plugin_config['default-policy.1.policyItem.1.users'] = policy_user
+    # trino_ranger_plugin_config['default-policy.1.policyItem.1.accessTypes'] = "read,write,create"
+
+    custom_ranger_service_config = generate_ranger_service_config(
+        ranger_plugin_properties
+    )
+    if len(custom_ranger_service_config) > 0:
+        trino_ranger_plugin_config.update(custom_ranger_service_config)
+
+    trino_ranger_plugin_repo = {
+        "isEnabled": "true",
+        "configs": trino_ranger_plugin_config,
+        "description": "trino repo",
+        "name": repo_name,
+        "type": "trino",
+    }
+
+    ranger_trino_principal = None
+    ranger_trino_keytab = None
+    if (
+            stack_supports_ranger_kerberos
+            and security_enabled
+            and "trino" in component_directory.lower()
+    ):
+        ranger_trino_principal = trino_principal
+        ranger_trino_keytab = trino_keytab
+
+    xa_audit_db_is_enabled = False
+    if xml_configurations_supported and stack_supports_ranger_audit_db:
+        xa_audit_db_is_enabled = config["configurations"]["ranger-trino-audit"][
+            "xasecure.audit.destination.db"
+        ]
+
+    xa_audit_hdfs_is_enabled = (
+        config["configurations"]["ranger-trino-audit"][
+            "xasecure.audit.destination.hdfs"
+        ]
+        if xml_configurations_supported
+        else False
+    )
+    ssl_keystore_password = (
+        config["configurations"]["ranger-trino-policymgr-ssl"][
+            "xasecure.policymgr.clientssl.keystore.password"
+        ]
+        if xml_configurations_supported
+        else None
+    )
+    ssl_truststore_password = (
+        config["configurations"]["ranger-trino-policymgr-ssl"][
+            "xasecure.policymgr.clientssl.truststore.password"
+        ]
+        if xml_configurations_supported
+        else None
+    )
+    credential_file = format("/etc/ranger/{repo_name}/cred.jceks")
+
+    # for SQLA explicitly disable audit to DB for Ranger
+    if (
+            has_ranger_admin
+            and stack_supports_ranger_audit_db
+            and xa_audit_db_flavor.lower() == "sqla"
+    ):
+        xa_audit_db_is_enabled = False
+
+# need this to capture cluster name from where ranger trino plugin is enabled
+cluster_name = config["clusterName"]
+
+# ranger trino plugin section end
+
+# access-control
+access_control_properties = dict(config['configurations']['access-control-properties'])
+# access_control_name = config['configurations']['access-control-properties']['access-control.name']
+access_control_name = 'allow-all'
+if enable_ranger_trino:
+    access_control_name = 'ranger'
+
+if enable_ranger_trino and security_enabled:
+    access_control_properties["ranger.principal"] = trino_principal
+    access_control_properties["ranger.keytab"] = trino_keytab
+
+security_config_file = None
+security_config_file_content = None
+if access_control_name == 'allow-all':
+    print("clear config:access_control_name = 'allow-all'")
+    access_control_properties.clear()
+    access_control_properties.update({'access-control.name': 'allow-all'})
+
+elif access_control_name == 'file':
+    security_config_file = config['configurations']['access-control-properties']['security.config-file']
+    security_config_file_content = config['configurations']['rules-json']['content']
+    access_control_properties.clear()
+    access_control_properties.update({'access-control.name': 'file'})
+    access_control_properties.update({'security.config-file': security_config_file})
+
+elif access_control_name == 'ranger':
+    print("remove config:access_control_name = 'ranger'")
+    access_control_properties.pop('access-control.config-files', None)
+    # Configure logback file
+    trino_ranger_plugin_logback_file = "/etc/trino/conf/trino-ranger-plugin-logback.xml"
+    trino_jvm_config_content = format(
+        "{trino_jvm_config_content} \n-Dlogback.configurationFile={trino_ranger_plugin_logback_file}")
+    # print(trino_jvm_config_content)
+    # trino_range_properties = dict(config['configurations']['ranger-properties'])
+
+trino_ranger_plugin_logback_content = config['configurations']['trino-ranger-plugin-logback']['content']
+
+# core-site
+core_site_configurations = None
+if "core-site" in config["configurations"]:
+    core_site_configurations = config["configurations"]["core-site"]
+    core_site_attributes = config["configurationAttributes"]["core-site"]
+
+# for create_hdfs_directory
+# New Cluster Stack Version that is defined during the RESTART of a Stack Upgrade
+version = default("/commandParams/version", None)
+
+hadoop_conf_dir = conf_select.get_hadoop_conf_dir()
+hadoop_bin_dir = stack_select.get_hadoop_dir("bin")
+
+if stack_version_formatted and check_stack_feature(
+        StackFeature.ROLLING_UPGRADE, stack_version_formatted
+):
+    hadoop_home = stack_select.get_hadoop_dir("home")
+
+hdfs_user = config["configurations"]["hadoop-env"]["hdfs_user"]
+hdfs_principal_name = config["configurations"]["hadoop-env"]["hdfs_principal_name"]
+hdfs_user_keytab = config["configurations"]["hadoop-env"]["hdfs_user_keytab"]
+user_group = config["configurations"]["cluster-env"]["user_group"]
+
+execute_path = os.environ["PATH"] + os.pathsep + hadoop_bin_dir
+
+default_fs = config["configurations"]["core-site"]["fs.defaultFS"]
+hdfs_site = config["configurations"]["hdfs-site"]
+hdfs_resource_ignore_file = "/var/lib/ambari-agent/data/.hdfs_resource_ignore"
+
+dfs_type = default("/clusterLevelParams/dfs_type", "")
+
+import functools
+
+# create partial functions with common arguments for every HdfsResource call
+# to create/delete hdfs directory/file/copyfromlocal we need to call params.HdfsResource in code
+HdfsResource = functools.partial(
+    HdfsResource,
+    user=hdfs_user,
+    hdfs_resource_ignore_file=hdfs_resource_ignore_file,
+    security_enabled=security_enabled,
+    keytab=hdfs_user_keytab,
+    kinit_path_local=kinit_path_local,
+    hadoop_bin_dir=hadoop_bin_dir,
+    hadoop_conf_dir=hadoop_conf_dir,
+    principal_name=hdfs_principal_name,
+    hdfs_site=hdfs_site,
+    default_fs=default_fs,
+    immutable_paths=get_not_managed_resources(),
+    dfs_type=dfs_type,
+)
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/setup_ranger_trino.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/setup_ranger_trino.py b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/setup_ranger_trino.py
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/setup_ranger_trino.py	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,136 @@
+#!/usr/bin/env python
+"""
+Licensed to the Apache Software Foundation (ASF) under one
+or more contributor license agreements.  See the NOTICE file
+distributed with this work for additional information
+regarding copyright ownership.  The ASF licenses this file
+to you under the Apache License, Version 2.0 (the
+"License"); you may not use this file except in compliance
+with the License.  You may obtain a copy of the License at
+
+    http://www.apache.org/licenses/LICENSE-2.0
+
+Unless required by applicable law or agreed to in writing, software
+distributed under the License is distributed on an "AS IS" BASIS,
+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+See the License for the specific language governing permissions and
+limitations under the License.
+
+"""
+
+from resource_management.core.logger import Logger
+from resource_management.libraries.functions.setup_ranger_plugin_xml import (
+    setup_ranger_plugin,
+)
+
+
+def setup_ranger_trino(upgrade_type=None, service_name="trino_coordinator"):
+    import params
+
+    if params.enable_ranger_trino:
+        stack_version = None
+
+        if upgrade_type is not None:
+            stack_version = params.version
+
+        if params.retryAble:
+            Logger.info(
+                "Trino: Setup ranger: command retry enables thus retrying if ranger admin is down !"
+            )
+        else:
+            Logger.info(
+                "Trino: Setup ranger: command retry not enabled thus skipping if ranger admin is down !"
+            )
+
+        if params.xa_audit_hdfs_is_enabled:
+            try:
+                params.HdfsResource(
+                    "/ranger/audit",
+                    type="directory",
+                    action="create_on_execute",
+                    owner=params.hdfs_user,
+                    group=params.user_group,
+                    mode=0o755,
+                    recursive_chmod=True,
+                )
+                params.HdfsResource(
+                    "/ranger/audit/trino",
+                    type="directory",
+                    action="create_on_execute",
+                    owner=params.trino_user,
+                    group=params.user_group,
+                    mode=0o700,
+                    recursive_chmod=True,
+                )
+
+                params.HdfsResource(None, action="execute")
+            except Exception as err:
+                Logger.exception(
+                    "Audit directory creation in HDFS for TRINO Ranger plugin failed with error:\n{0}".format(
+                        err
+                    )
+                )
+
+        api_version = "v2"
+
+        setup_ranger_plugin(
+            "trino",
+            params.trino_service_name,
+            params.previous_jdbc_jar,
+            params.downloaded_custom_connector,
+            params.driver_curl_source,
+            params.driver_curl_target,
+            params.java64_home,
+            params.repo_name,
+            params.trino_ranger_plugin_repo,
+            params.ranger_env,
+            params.ranger_plugin_properties,
+            params.policy_user,
+            params.policymgr_mgr_url,
+            params.enable_ranger_trino,
+            conf_dict=params.trino_conf_dir,
+            component_user=params.trino_user,
+            component_group=params.user_group,
+            cache_service_list=["trino"],
+            plugin_audit_properties=params.config["configurations"][
+                "ranger-trino-audit"
+            ],
+            plugin_audit_attributes=params.config["configurationAttributes"][
+                "ranger-trino-audit"
+            ],
+            plugin_security_properties=params.config["configurations"][
+                "ranger-trino-security"
+            ],
+            plugin_security_attributes=params.config["configurationAttributes"][
+                "ranger-trino-security"
+            ],
+            plugin_policymgr_ssl_properties=params.config["configurations"][
+                "ranger-trino-policymgr-ssl"
+            ],
+            plugin_policymgr_ssl_attributes=params.config["configurationAttributes"][
+                "ranger-trino-policymgr-ssl"
+            ],
+            component_list=["trino"],
+            audit_db_is_enabled=params.xa_audit_db_is_enabled,
+            credential_file=params.credential_file,
+            xa_audit_db_password=params.xa_audit_db_password,
+            ssl_truststore_password=params.ssl_truststore_password,
+            ssl_keystore_password=params.ssl_keystore_password,
+            stack_version_override=stack_version,
+            skip_if_rangeradmin_down=not params.retryAble,
+            api_version=api_version,
+            is_security_enabled=params.security_enabled,
+            is_stack_supports_ranger_kerberos=params.stack_supports_ranger_kerberos
+            if params.security_enabled
+            else None,
+            component_user_principal=params.ranger_trino_principal
+            if params.security_enabled
+            else None,
+            component_user_keytab=params.ranger_trino_keytab
+            if params.security_enabled
+            else None,
+            plugin_home=params.ranger_plugin_home,
+            setup_plugin_keystore=False
+        )
+    else:
+        Logger.info("Ranger Trino plugin is not enabled")
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/status_params.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/status_params.py b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/status_params.py
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/status_params.py	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,49 @@
+"""
+Licensed to the Apache Software Foundation (ASF) under one
+or more contributor license agreements.  See the NOTICE file
+distributed with this work for additional information
+regarding copyright ownership.  The ASF licenses this file
+to you under the Apache License, Version 2.0 (the
+"License"); you may not use this file except in compliance
+with the License.  You may obtain a copy of the License at
+
+  http://www.apache.org/licenses/LICENSE-2.0
+
+Unless required by applicable law or agreed to in writing, software
+distributed under the License is distributed on an "AS IS" BASIS,
+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+See the License for the specific language governing permissions and
+limitations under the License.
+
+Ambari Agent
+
+"""
+
+import os
+from resource_management.libraries.script import Script
+from resource_management.libraries.functions import format
+from resource_management.libraries.functions.default import default
+
+# a map of the Ambari role to the component name
+# for use with <stack-root>/current/<component>
+# TODO: add the map to the current with the actual
+SERVER_ROLE_DIRECTORY_MAP = {
+    "TRINO_HOME": "trino",
+}
+
+component_directory = Script.get_component_from_role(
+    SERVER_ROLE_DIRECTORY_MAP, "TRINO_HOME"
+)
+
+
+config = Script.get_config()
+
+trino_pid_dir = config["configurations"]["trino-env"]["trino_pid_dir"]
+trino_log_dir = config["configurations"]["trino-env"]["trino_log_dir"]
+# trino_coordinator_pid_file = os.path.join(trino_pid_dir, 'trino_coordinator.pid')
+# trino_worker_pid_file = os.path.join(trino_pid_dir, 'trino_worker.pid');
+
+trino_pid_file = os.path.join(trino_pid_dir, "launcher.pid")
+
+trino_user = config["configurations"]["trino-env"]["trino_user"]
+trino_group = config["configurations"]["trino-env"]["trino_group"]
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino.py b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino.py
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino.py	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,354 @@
+#!/usr/bin/env python
+# coding=utf-8
+"""
+Licensed to the Apache Software Foundation (ASF) under one
+or more contributor license agreements.  See the NOTICE file
+distributed with this work for additional information
+regarding copyright ownership.  The ASF licenses this file
+to you under the Apache License, Version 2.0 (the
+"License"); you may not use this file except in compliance
+with the License.  You may obtain a copy of the License at
+
+    http://www.apache.org/licenses/LICENSE-2.0
+
+Unless required by applicable law or agreed to in writing, software
+distributed under the License is distributed on an "AS IS" BASIS,
+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+See the License for the specific language governing permissions and
+limitations under the License.
+
+"""
+
+import ast
+import os
+from ambari_commons.os_family_impl import OsFamilyFuncImpl, OsFamilyImpl
+from resource_management import *
+from resource_management.core.resources.system import Execute
+
+
+@OsFamilyFuncImpl(os_family=OsFamilyImpl.DEFAULT)
+def trino(name=None, env=None):
+    import params
+    env.set_params(params)
+
+    mode_identified_for_file = 0o644
+    mode_identified_for_dir = 0o755
+
+    # 替换 etc 为软链接
+    Execute(format(
+        "if [ -e {trino_home}/etc ] && [ ! -L {trino_home}/etc ]; then \
+            rm -rf {trino_home}/etc; \
+         fi; \
+         ln -sfn /etc/trino/conf {trino_home}/etc"
+    ))
+
+    # 替换 plugin 为备份目录（不做软链）
+    Execute(format(
+        "if [ -e {trino_home}/plugin ]; then \
+            mv {trino_home}/plugin {trino_home}/plugins; \
+         fi"
+    ))
+
+    # 替换 secrets-plugin 为备份目录（不做软链）
+    Execute(format(
+        "if [ -e {trino_home}/secrets-plugin ]; then \
+            mv {trino_home}/secrets-plugin {trino_home}/secrets-plugins; \
+         fi"
+    ))
+
+    # 确保 var 目录存在，否则无法创建 log/run 链接
+    Directory(format("{trino_home}/var"), create_parents=True, mode=0755, owner="trino", group="hadoop")
+
+    # 软链接 var/log → /var/log/trino
+    Execute(format(
+        "if [ -e {trino_home}/var/log ] && [ ! -L {trino_home}/var/log ]; then \
+            rm -rf {trino_home}/var/log; \
+         fi; \
+         ln -sfn /var/log/trino {trino_home}/var/log"
+    ))
+
+    # 软链接 var/run → /var/run/trino
+    Execute(format(
+        "if [ -e {trino_home}/var/run ] && [ ! -L {trino_home}/var/run ]; then \
+            rm -rf {trino_home}/var/run; \
+         fi; \
+         ln -sfn /var/run/trino {trino_home}/var/run"
+    ))
+
+    Directory(
+        params.trino_home,
+        owner=params.trino_user,
+        group=params.trino_group,
+        mode=mode_identified_for_dir,
+    )
+
+    # On some OS this folder could be not exists, so we will create it before pushing there files
+    Directory(params.limits_conf_dir, create_parents=True, owner="root", group="root")
+
+    File(
+        os.path.join(params.limits_conf_dir, "trino.conf"),
+        owner="root",
+        group="root",
+        mode=0o644,
+        content=Template("trino.conf.j2"),
+    )
+
+    Directory(
+        params.trino_log_dir,
+        owner=params.trino_user,
+        create_parents=True,
+        group=params.user_group,
+        mode=0o775,
+    )
+
+    Directory(
+        params.trino_pid_dir,
+        owner=params.trino_user,
+        create_parents=True,
+        group=params.user_group,
+        mode=0o775,
+    )
+
+    Directory(
+        params.node_data_dir,
+        owner=params.trino_user,
+        create_parents=True,
+        group=params.user_group,
+        mode=0o775,
+    )
+
+    Directory(
+        params.spiller_spill_path,
+        owner=params.trino_user,
+        create_parents=True,
+        group=params.user_group,
+        mode=0o775,
+    )
+
+    # create log and pid links
+    # Execute('rm -fr {1}/var && ln -sf {0}/var {1}/var'.format(params.trino_dir,params.node_data_dir) ,user=params.trino_user)
+
+    Directory(
+        os.path.join(params.trino_conf_dir, "catalog"),
+        owner=params.trino_user,
+        create_parents=True,
+        group=params.user_group,
+        mode=0o775,
+    )
+
+    File(
+        os.path.join(params.trino_conf_dir, "config.properties"),
+        mode=0o755,
+        owner=params.trino_user,
+        group=params.user_group,
+        content=Template('config.properties.j2')
+    )
+
+    PropertiesFile(
+        os.path.join(params.trino_conf_dir, "node.properties"),
+        properties=params.node_properties,
+        mode=0o755,
+        owner=params.trino_user,
+        group=params.user_group,
+    )
+
+    File(
+        os.path.join(params.trino_conf_dir, "jvm.config"),
+        owner=params.trino_user,
+        group=params.trino_group,
+        mode=0o755,
+        content=InlineTemplate(params.trino_jvm_config_content),
+    )
+
+    File(
+        os.path.join(params.trino_conf_dir, "log.properties"),
+        owner=params.trino_user,
+        group=params.trino_group,
+        mode=0o755,
+        content=InlineTemplate(params.trino_log_properties_content),
+    )
+
+    # clean connector properties files
+    # Execute('rm -f {0}/*'.format(params.trino_connectors_dir))
+    # print(params.trino_connectors_content)
+
+    # create connector properties files
+    connectors_dict = ast.literal_eval(params.trino_connectors_content)
+    for connector in connectors_dict:
+        connector_content = "\n".join(connectors_dict[connector])
+        connector_file_path = os.path.join(
+            params.trino_connectors_dir, connector + ".properties"
+        )
+        File(
+            connector_file_path,
+            owner=params.trino_user,
+            group=params.trino_group,
+            mode=0o644,
+            content=connector_content,
+        )
+
+    # password-authenticator-properties
+    PropertiesFile(
+        os.path.join(params.trino_conf_dir, "password-authenticator.properties"),
+        properties=params.password_authenticator_properties,
+        mode=0o755,
+        owner=params.trino_user,
+        group=params.user_group,
+    )
+
+    # create passwd for trino user
+    File(
+        params.file_password_file,
+        owner=params.trino_user,
+        group=params.trino_group,
+        mode=0o644,
+        content="",
+    )
+
+    # update passwd for trino user
+    Execute(
+        "htpasswd -b -B -C 10 {0} {1} {2}".format(
+            params.file_password_file,
+            params.trino_user,
+            params.file_user_trino_password,
+        ),
+        user=params.trino_user,
+    )
+
+    # File group provider
+    PropertiesFile(
+        os.path.join(params.trino_conf_dir, "group-provider.properties"),
+        properties=params.group_provider_properties,
+        mode=0o755,
+        owner=params.trino_user,
+        group=params.user_group,
+    )
+    File(
+        params.file_group_file,
+        owner=params.trino_user,
+        group=params.trino_group,
+        mode=0o755,
+        content=InlineTemplate(params.file_group_file_content),
+    )
+
+    # access_control_file
+    PropertiesFile(
+        os.path.join(params.trino_conf_dir, "access-control.properties"),
+        properties=params.access_control_properties,
+        mode=0o755,
+        owner=params.trino_user,
+        group=params.user_group,
+    )
+
+    if params.security_config_file and params.security_config_file_content:
+        File(
+            params.security_config_file,
+            owner=params.trino_user,
+            group=params.trino_group,
+            mode=0o755,
+            content=InlineTemplate(params.security_config_file_content),
+        )
+
+    # resource-groups.configuration-manager
+    PropertiesFile(
+        os.path.join(params.trino_conf_dir, "resource-groups.properties"),
+        properties=params.resource_groups_properties,
+        mode=0o755,
+        owner=params.trino_user,
+        group=params.user_group,
+    )
+    File(
+        params.resource_groups_json_file,
+        owner=params.trino_user,
+        group=params.trino_group,
+        mode=0o755,
+        content=InlineTemplate(params.resource_groups_json_file_content),
+    )
+
+    # session-property-config-properties
+    PropertiesFile(
+        os.path.join(params.trino_conf_dir, "session-property-config.properties"),
+        properties=params.session_property_config_properties,
+        mode=0o755,
+        owner=params.trino_user,
+        group=params.user_group,
+    )
+    File(
+        params.session_property_manager_config_file,
+        owner=params.trino_user,
+        group=params.trino_group,
+        mode=0o755,
+        content=InlineTemplate(params.session_property_manager_config_file_content),
+    )
+
+    # core-site.xml
+    if params.core_site_configurations is not None:
+        XmlConfig(
+            os.path.join(params.trino_conf_dir, "core-site.xml"),
+            conf_dir=params.trino_conf_dir,
+            configurations=params.core_site_configurations,
+            configuration_attributes=params.core_site_attributes,
+            owner=params.trino_user,
+            group=params.trino_group,
+            mode=0o644,
+        )
+
+    # enable_event_listener
+    if params.enable_event_listener:
+        File(
+            os.path.join(params.trino_conf_dir, "event-listener.properties"),
+            owner=params.trino_user,
+            group=params.trino_group,
+            mode=0o755,
+            content=InlineTemplate(params.enable_event_listener_content),
+        )
+
+    # session-property-config-properties
+    File(
+        os.path.join(params.trino_conf_dir, "trino-ranger-plugin-logback.xml"),
+        owner=params.trino_user,
+        group=params.trino_group,
+        mode=0o755,
+        content=InlineTemplate(params.trino_ranger_plugin_logback_content),
+    )
+
+    if params.access_control_name == 'ranger' and params.repo_name is not None:
+        ranger_trino_policymgr_ssl = params.config['configurations']['ranger-trino-policymgr-ssl']
+        XmlConfig("ranger-trino-policymgr-ssl.xml",
+                  conf_dir=params.trino_conf_dir,
+                  configurations=ranger_trino_policymgr_ssl,
+                  owner=params.trino_user,
+                  group=params.trino_group,
+                  mode=0o755)
+
+        ranger_trino_audit = params.config['configurations']['ranger-trino-audit']
+        XmlConfig("ranger-trino-{0}-audit.xml".format(params.repo_name),
+                  conf_dir=params.trino_conf_dir,
+                  configurations=ranger_trino_audit,
+                  owner=params.trino_user,
+                  group=params.trino_group,
+                  mode=0o755)
+
+        ranger_trino_policymgr_ssl = params.config['configurations']['ranger-trino-security']
+        XmlConfig("ranger-trino-{0}-security.xml".format(params.repo_name),
+                  conf_dir=params.trino_conf_dir,
+                  configurations=ranger_trino_policymgr_ssl,
+                  owner=params.trino_user,
+                  group=params.trino_group,
+                  mode=0o755)
+
+        ranger_trino_security = params.config['configurations']['ranger-trino-policymgr-ssl']
+        XmlConfig("ranger-trino-{0}-policymgr-ssl.xml".format(params.repo_name),
+                  conf_dir=params.trino_conf_dir,
+                  configurations=ranger_trino_security,
+                  owner=params.trino_user,
+                  group=params.trino_group,
+                  mode=0o755)
+
+        # ranger.properties
+        # PropertiesFile(os.path.join(params.trino_conf_dir, "ranger.properties"),
+        #     properties = params.trino_range_properties,
+        #     mode=0o755,
+        #     owner=params.trino_user,
+        #     group=params.user_group
+        # )
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino_cli.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino_cli.py b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino_cli.py
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino_cli.py	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,47 @@
+import sys, os, pwd, grp, signal, time
+from resource_management import *
+from subprocess import call
+from resource_management.libraries.script.script import Script
+from trino_service import trino_service
+from trino import trino
+
+
+class trino_cli(Script):
+    """
+    Contains the interface definitions for methods like install,
+    start, stop, status, etc. for the trino Server
+    """
+
+    def install(self, env):
+        import params
+
+        env.set_params(params)
+        self.install_packages(env)
+        self.configure(env)
+
+    def configure(self, env):
+        import params
+
+        env.set_params(params)
+
+    def save_configs(self, env):
+        import params
+
+        env.set_params(params)
+
+    def start(self, env, upgrade_type=None):
+        import params
+
+        env.set_params(params)
+
+    def stop(self, env, upgrade_type=None):
+        import params
+
+        env.set_params(params)
+
+    def status(self, env):
+        raise ClientComponentHasNoStatus()
+
+
+if __name__ == "__main__":
+    trino_cli().execute()
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino_client.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino_client.py b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino_client.py
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino_client.py	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,302 @@
+# -*- coding: utf-8 -*-
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+# http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+"""
+Simple client to communicate with a Trino server.
+"""
+
+from http.client import HTTPConnection, HTTPException
+import logging
+import json
+import socket
+import sys
+import time
+from urllib.error import HTTPError, URLError
+from urllib.request import urlopen
+
+
+URL_TIMEOUT_MS = 5000
+NUM_ROWS = 1000
+DATA_RESP = "data"
+NEXT_URI_RESP = "nextUri"
+RETRY_TIMEOUT = 120
+SYSTEM_RUNTIME_NODES = "select * from system.runtime.nodes"
+SHOW_CATALOGS = "show catalogs"
+SLEEP_INTERVAL = 10
+
+logging.basicConfig(stream=sys.stdout)
+_LOGGER = logging.getLogger(__name__)
+
+
+def smoketest_trino(client, all_hosts):
+    ensure_nodes_are_up(client, all_hosts)
+    ensure_catalogs_are_available(client)
+    client.execute_query("select * from nation", schema="sf1", catalog="tpch")
+    rows = client.get_rows()
+    if len(rows) != 25:
+        raise RuntimeError(
+            "Trino server failed to return the correct \
+number of rows from nation table in TPCH connector. Expected 25 but got {0}".format(
+                len(rows)
+            )
+        )
+
+
+def ensure_catalogs_are_available(client):
+    rows = []
+    elapsed_time = 0
+    while elapsed_time < RETRY_TIMEOUT:
+        client.execute_query(SHOW_CATALOGS)
+        rows = client.get_rows()
+        if not rows:
+            time.sleep(SLEEP_INTERVAL)
+            _LOGGER.debug(
+                "Failed to load catalogs after "
+                "waiting for %d seconds. Retrying..." % elapsed_time
+            )
+            elapsed_time += SLEEP_INTERVAL
+        else:
+            break
+    if not rows:
+        raise RuntimeError(
+            "Trino server failed to load all catalogs within \
+{0} seconds.".format(RETRY_TIMEOUT)
+        )
+
+
+def ensure_nodes_are_up(client, all_hosts):
+    result = True
+    elapsed_time = 0
+    while elapsed_time < RETRY_TIMEOUT:
+        result = client.execute_query(SYSTEM_RUNTIME_NODES)
+        if not result:
+            time.sleep(SLEEP_INTERVAL)
+            _LOGGER.debug(
+                "Status retrieval for the server failed after "
+                "waiting for %d seconds. Retrying..." % elapsed_time
+            )
+            elapsed_time += SLEEP_INTERVAL
+        else:
+            break
+    if not result:
+        raise RuntimeError(
+            "Trino server failed to start within \
+{0} seconds.".format(RETRY_TIMEOUT)
+        )
+
+    # Verify that the nodes we expect to have registered with the Discovery
+    # service have actually registered correctly
+    elapsed_time = 0
+    are_expected_nodes_up = False
+    while elapsed_time < RETRY_TIMEOUT:
+        client.execute_query(SYSTEM_RUNTIME_NODES)
+        nodes_returned_from_trino = []
+        for row in client.get_rows():
+            nodes_returned_from_trino.append(row[0])
+        if len(nodes_returned_from_trino) == len(all_hosts):
+            are_expected_nodes_up = True
+            break
+        else:
+            time.sleep(SLEEP_INTERVAL)
+            _LOGGER.debug("Elapsed time {0}".format(elapsed_time))
+            _LOGGER.debug(
+                "Number of hosts returned from Presto {0} do not match number of hosts specified by user {1}".format(
+                    nodes_returned_from_trino, all_hosts
+                )
+            )
+            elapsed_time += SLEEP_INTERVAL
+    if not are_expected_nodes_up:
+        raise RuntimeError(
+            "Number of hosts returned from Presto {0} do not equal the number of hosts specified by user {1}".format(
+                nodes_returned_from_trino, all_hosts
+            )
+        )
+
+
+# This class was copied more or less verbatim from
+# https://github.com/trinosql/trino-admin/blob/master/trinoadmin/trinoclient.py
+class TrinoClient:
+    response_from_server = {}
+    # rows returned by the query
+    rows = []
+    next_uri = ""
+
+    def __init__(self, server, user, port=None):
+        self.server = server
+        self.user = user
+        self.port = port if port else None
+
+    def clear_old_results(self):
+        if self.rows:
+            self.rows = []
+
+        if self.next_uri:
+            self.next_uri = ""
+
+        if self.response_from_server:
+            self.response_from_server = {}
+
+    def execute_query(self, sql, schema="sf1", catalog="tpch"):
+        """
+        Execute a query connecting to Trino server using passed parameters.
+
+        Client sends http POST request to the Trino server, page:
+        '/v1/statement'. Header information should
+        include: X-Presto-Catalog, X-Presto-Schema,  X-Presto-User
+
+        Args:
+            sql: SQL query to be executed
+            schema: Presto schema to be used while executing query
+                (default=default)
+            catalog: Catalog to be used by the server
+
+        Returns:
+            True or False exit status
+        """
+        if not sql:
+            raise InvalidArgumentError("SQL query missing")
+
+        if not self.server:
+            raise InvalidArgumentError("Server IP missing")
+
+        if not self.user:
+            raise InvalidArgumentError("Username missing")
+
+        if not self.port:
+            raise InvalidArgumentError("Port missing")
+
+        self.clear_old_results()
+
+        headers = {
+            "X-Presto-Catalog": catalog,
+            "X-Presto-Schema": schema,
+            "X-Presto-User": self.user,
+        }
+        answer = ""
+        try:
+            _LOGGER.info(
+                "Connecting to server at: "
+                + self.server
+                + ":"
+                + str(self.port)
+                + " as user "
+                + self.user
+            )
+            conn = HTTPConnection(self.server, int(self.port), False, URL_TIMEOUT_MS)
+            conn.request("POST", "/v1/statement", sql, headers)
+            response = conn.getresponse()
+
+            if response.status != 200:
+                conn.close()
+                _LOGGER.error(
+                    "Connection error: " + str(response.status) + " " + response.reason
+                )
+                return False
+
+            answer = response.read()
+            conn.close()
+
+            self.response_from_server = json.loads(answer)
+            _LOGGER.info("Query executed successfully")
+            return True
+        except (HTTPException, socket.error):
+            _LOGGER.error(
+                "Error connecting to trino server at: "
+                + self.server
+                + ":"
+                + str(self.port)
+            )
+            return False
+        except ValueError as e:
+            _LOGGER.error(
+                "Error connecting to Trino server: "
+                + str(e)
+                + " error from server: "
+                + answer
+            )
+            raise e
+
+    def get_response_from(self, uri):
+        """
+        Sends a GET request to the Trino server at the specified next_uri
+        and updates the response
+        """
+        try:
+            conn = urlopen(uri, None, URL_TIMEOUT_MS)
+            answer = conn.read()
+            conn.close()
+
+            self.response_from_server = json.loads(answer)
+            _LOGGER.info("GET request successful for uri: " + uri)
+            return True
+        except (HTTPError, URLError) as e:
+            _LOGGER.error("Error opening the trino response uri: " + str(e.reason))
+            return False
+
+    def build_results_from_response(self):
+        """
+        Build result from the response
+
+        The reponse_from_server may contain up to 3 uri's.
+        1. link to fetch the next packet of data ('nextUri')
+        2. TODO: information about the query execution ('infoUri')
+        3. TODO: cancel the query ('partialCancelUri').
+        """
+        if NEXT_URI_RESP in self.response_from_server:
+            self.next_uri = self.response_from_server[NEXT_URI_RESP]
+        else:
+            self.next_uri = ""
+
+        if DATA_RESP in self.response_from_server:
+            if self.rows:
+                self.rows.extend(self.response_from_server[DATA_RESP])
+            else:
+                self.rows = self.response_from_server[DATA_RESP]
+
+    def get_rows(self, num_of_rows=NUM_ROWS):
+        """
+        Get the rows returned from the query.
+
+        The client sends GET requests to the server using the 'nextUri'
+        from the previous response until the servers response does not
+        contain anymore 'nextUri's.  When there is no 'nextUri' the query is
+        finished
+
+        Note that this can only be called once and does not page through
+        the results.
+
+        Parameters:
+            num_of_rows: to be retrieved. 1000 by default
+        """
+        if num_of_rows == 0:
+            return []
+
+        self.build_results_from_response()
+
+        if not self.get_next_uri():
+            return []
+
+        while self.get_next_uri():
+            if not self.get_response_from(self.get_next_uri()):
+                return []
+            if len(self.rows) <= num_of_rows:
+                self.build_results_from_response()
+        return self.rows
+
+    def get_next_uri(self):
+        return self.next_uri
+
+
+class InvalidArgumentError(ValueError):
+    pass
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino_coordinator.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino_coordinator.py b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino_coordinator.py
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino_coordinator.py	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,69 @@
+import sys, os, pwd, grp, signal, time
+from resource_management import *
+from subprocess import call
+from resource_management.libraries.script.script import Script
+from trino_service import trino_service
+from trino import trino
+from setup_ranger_trino import setup_ranger_trino
+
+
+class trino_coordinator(Script):
+    """
+    Contains the interface definitions for methods like install,
+    start, stop, status, etc. for the trino Server
+    """
+
+    def install(self, env):
+        config = Script.get_config()
+        import params
+
+        env.set_params(params)
+        self.install_packages(env)
+
+    def configure(self, env):
+        import params
+
+        env.set_params(params)
+        trino(name="trino_coordinator", env=env)
+
+    def start(self, env):
+        import params
+        self.configure(env)
+        setup_ranger_trino(upgrade_type=None, service_name="trino_coordinator")
+        trino_service("trino_coordinator", action="start", upgrade_type=None)
+
+    def stop(self, env):
+        import params
+
+        env.set_params(params)
+        trino_service("trino_coordinator", action="stop", upgrade_type=None)
+
+    def status(self, env):
+        import status_params
+
+        env.set_params(status_params)
+        # use built-in method to check status using pidfile
+        check_process_status(status_params.trino_pid_file)
+
+        # import params
+        # env.set_params(params)
+        # trino_service('trino_coordinator', action='status', upgrade_type=None)
+
+    def get_user(self):
+        import params
+
+        return params.trino_user
+
+    def get_log_folder(self):
+        import params
+
+        return params.trino_log_dir
+
+    def get_pid_files(self):
+        import status_params
+
+        return [status_params.trino_pid_file]
+
+
+if __name__ == "__main__":
+    trino_coordinator().execute()
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino_service.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino_service.py b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino_service.py
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino_service.py	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,143 @@
+#!/usr/bin/env python
+"""
+Licensed to the Apache Software Foundation (ASF) under one
+or more contributor license agreements.  See the NOTICE file
+distributed with this work for additional information
+regarding copyright ownership.  The ASF licenses this file
+to you under the Apache License, Version 2.0 (the
+"License"); you may not use this file except in compliance
+with the License.  You may obtain a copy of the License at
+
+    http://www.apache.org/licenses/LICENSE-2.0
+
+Unless required by applicable law or agreed to in writing, software
+distributed under the License is distributed on an "AS IS" BASIS,
+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+See the License for the specific language governing permissions and
+limitations under the License.
+
+"""
+
+from resource_management import *
+import os
+from ambari_commons.os_family_impl import OsFamilyFuncImpl, OsFamilyImpl
+import time
+
+
+def trino_service(name, action="start", upgrade_type=None):
+    # initializing the op command variables
+    import params
+
+    trinoExecEnv = {"JAVA_HOME": params.trino_jdk_home}
+    trinoEnvExport = format(
+        "export JAVA_HOME={trino_jdk_home}; export PATH=$JAVA_HOME/bin:$PATH;"
+    )
+
+    trino_pid_file = params.trino_pid_file
+    trino_out_file = params.trino_coordinator_out_file
+
+    process_id_exists_command = (
+            as_sudo(["test", "-f", trino_pid_file])
+            + " && "
+            + as_sudo(["pgrep", "-F", trino_pid_file])
+    )
+
+    if name == "trino_worker":
+        #      trino_pid_file = params.trino_worker_pid_file
+        trino_out_file = params.trino_worker_out_file
+
+    if action == "start":
+        Execute(
+            format(
+                "{trinoEnvExport} {trino_bin_dir}/launcher  start \
+                --etc-dir=/usr/bigtop/current/trino/etc  > {trino_out_file} 2>&1 "
+            ),
+            environment=trinoExecEnv,
+            user=params.trino_user,
+            not_if=process_id_exists_command,
+        )
+
+        time.sleep(10)
+        tryTimes = 5
+        while tryTimes > 0:
+            server_log_content = get_trino_server_log_content(params.trino_server_log)
+            launcher_log_content = get_trino_server_log_content(
+                params.trino_launcher_log
+            )
+
+            if "SERVER STARTED" in server_log_content:
+                start_success = True
+                break
+            elif "ERROR" in server_log_content:
+                start_success = False
+                break
+            else:
+                Logger.info("waiting for trno start...")
+                time.sleep(10)
+                tryTimes = tryTimes - 1
+
+        Logger.info("---launcher.log content---")
+        Logger.info(server_log_content)
+
+        Logger.info("---launcher.log content---")
+        Logger.info(launcher_log_content)
+
+        if not start_success:
+            Logger.error("start fail, pls check logs!")
+            raise Exception("start fail!")
+
+        if tryTimes == 0:
+            Logger.error("start timeout ,pls check logs.")
+            raise Exception("start timeout!")
+
+        # Execute ('ps -ef | grep trino | grep io.trino.server.TrinoServer | grep -v grep | awk \'{print $2}\' > ' + trino_pid_file,  user=params.trino_user)
+
+    elif action == "stop":
+        Execute(
+            format(
+                "{trinoEnvExport} {trino_bin_dir}/launcher stop > {trino_out_file} 2>&1 "
+            ),
+            environment=trinoExecEnv,
+            user=params.trino_user,
+            only_if=process_id_exists_command,
+        )
+        # Kill the process of trino
+        # Execute ('ps -ef | grep trino | grep io.trino.server.TrinoServer | grep -v grep | awk  \'{print $2}\' | xargs kill -9', user=params.trino_user, ignore_failures=True)
+        File(trino_pid_file, action="delete", owner=params.trino_user)
+
+    elif action == "status":
+        try:
+            Execute(
+                format("{trinoEnvExport} {trino_bin_dir}/launcher status  "),
+                environment=trinoExecEnv,
+                user=params.trino_user,
+            )
+            Execute(
+                "ps -ef | grep trino | grep io.trino.server.TrinoServer | grep -v grep | awk '{print $2}' > "
+                + trino_pid_file,
+                user=params.trino_user,
+            )
+
+        except ExecutionFailed as ef:
+            if ef.code == 3:
+                raise Exception(
+                    "hadoop.security.credential.provider.path property should be set"
+                )
+            else:
+                raise ef
+
+    else:
+        Logger.info(format("unknown command type: :{action}"))
+
+
+# get
+def get_trino_server_log_content(filename):
+    import params
+
+    print(filename)
+    if filename and os.path.exists(filename):
+        with open(params.trino_server_log) as f:
+            file_content = f.read()
+            return file_content
+    else:
+        return ""
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino_worker.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino_worker.py b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino_worker.py
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino_worker.py	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,71 @@
+import sys, os, pwd, grp, signal, time
+from resource_management import *
+from subprocess import call
+from resource_management.libraries.script.script import Script
+from trino_service import trino_service
+from trino import trino
+from setup_ranger_trino import setup_ranger_trino
+
+
+class trino_worker(Script):
+    """
+    Contains the interface definitions for methods like install,
+    start, stop, status, etc. for the trino Server
+    """
+
+    def install(self, env):
+        config = Script.get_config()
+        import params
+
+        env.set_params(params)
+        self.install_packages(env)
+        self.configure(env)
+
+    def configure(self, env):
+        import params
+
+        env.set_params(params)
+        trino(name="trino_worker", env=env)
+
+    def start(self, env):
+        import params
+
+        self.configure(env)
+        setup_ranger_trino(upgrade_type=None, service_name="trino_coordinator")
+        trino_service("trino_worker", action="start", upgrade_type=None)
+
+    def stop(self, env):
+        import params
+
+        env.set_params(params)
+        trino_service("trino_worker", action="stop", upgrade_type=None)
+
+    def status(self, env):
+        import status_params
+
+        env.set_params(status_params)
+        # use built-in method to check status using pidfile
+        check_process_status(status_params.trino_pid_file)
+
+        # import params
+        # env.set_params(params)
+        # trino_service('trino_worker', action='status', upgrade_type=None)
+
+    def get_user(self):
+        import params
+
+        return params.trino_user
+
+    def get_log_folder(self):
+        import params
+
+        return params.trino_log_dir
+
+    def get_pid_files(self):
+        import status_params
+
+        return [status_params.trino_pid_file]
+
+
+if __name__ == "__main__":
+    trino_worker().execute()
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/templates/config.properties.j2
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/templates/config.properties.j2 b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/templates/config.properties.j2
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/templates/config.properties.j2	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,57 @@
+# Whether this node acts as the Trino coordinator (only one node should be true)
+coordinator={{ config_properties['coordinator'] }}
+
+# Discovery URI used by Trino nodes to find each other
+discovery.uri={{ discovery_uri }}
+
+# Port for HTTP server
+http-server.http.port={{ config_properties['http-server.http.port'] }}
+
+# Whether HTTPS is enabled for the HTTP server
+http-server.https.enabled={{ config_properties['http-server.https.enabled'] }}
+
+{% if config_properties['http-server.https.enabled'] == 'true' %}
+# Port for HTTPS server
+http-server.https.port={{ config_properties['http-server.https.port'] }}
+
+# Path to the HTTPS certificate (PEM format)
+http-server.https.keystore.path={{ config_properties['http-server.https.keystore.path'] }}
+
+# Keystore key password
+http-server.https.keystore.key={{ config_properties['http-server.https.keystore.key'] }}
+{% endif %}
+
+{% if config_properties['http-server.authentication.type'] is defined %}
+# Type of HTTP authentication (e.g., PASSWORD, NONE)
+http-server.authentication.type={{ config_properties['http-server.authentication.type'] }}
+{% endif %}
+
+# Path to the password authenticator config file
+password-authenticator.config-files={{ config_properties['password-authenticator.config-files'] }}
+
+# Path for HTTP server request logs
+http-server.log.path={{ config_properties['http-server.log.path'] }}
+
+# Whether HTTPS is required for internal node communication
+internal-communication.https.required={{ config_properties['internal-communication.https.required'] }}
+
+# Shared secret for internal communication
+internal-communication.shared-secret={{ config_properties['internal-communication.shared-secret'] }}
+
+# Whether the coordinator node should be included in query scheduling
+node-scheduler.include-coordinator={{ config_properties['node-scheduler.include-coordinator'] }}
+
+# Maximum total memory that a query can use
+query.max-memory={{ config_properties['query.max-memory'] }}
+
+# Maximum memory that a query can use on a single node
+query.max-memory-per-node={{ config_properties['query.max-memory-per-node'] }}
+
+# Whether to enable spilling to disk
+spill-enabled={{ config_properties['spill-enabled'] }}
+
+# Path to store spilled data
+spiller-spill-path={{ config_properties['spiller-spill-path'] }}
+
+# Directory where Trino plugins are located
+plugin.dir={{ config_properties['plugin.dir'] }}
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/templates/launcher.j2
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/templates/launcher.j2 b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/templates/launcher.j2
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/templates/launcher.j2	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,7 @@
+#!/bin/sh -eu
+
+
+export JAVA_HOME="{{trino_java_home}}"
+export PATH=$JAVA_HOME/bin:$PATH
+
+exec "$(dirname "$0")/launcher.py" "$@"
\ No newline at end of file
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/templates/trino.conf.j2
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/templates/trino.conf.j2 b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/templates/trino.conf.j2
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/templates/trino.conf.j2	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,35 @@
+{#
+# Licensed to the Apache Software Foundation (ASF) under one
+# or more contributor license agreements.  See the NOTICE file
+# distributed with this work for additional information
+# regarding copyright ownership.  The ASF licenses this file
+# to you under the Apache License, Version 2.0 (the
+# "License"); you may not use this file except in compliance
+# with the License.  You may obtain a copy of the License at
+#
+#   http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+#}
+
+# Licensed to the Apache Software Foundation (ASF) under one or more
+# contributor license agreements.  See the NOTICE file distributed with
+# this work for additional information regarding copyright ownership.
+# The ASF licenses this file to You under the Apache License, Version 2.0
+# (the "License"); you may not use this file except in compliance with
+# the License.  You may obtain a copy of the License at
+#
+#     http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+{{trino_user}}   - nofile {{trino_user_nofile_limit}}
+{{trino_user}}   - nproc  {{trino_user_nproc_limit}}
\ No newline at end of file
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/quicklinks/quicklinks.json
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/quicklinks/quicklinks.json b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/quicklinks/quicklinks.json
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/quicklinks/quicklinks.json	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,37 @@
+{
+    "name": "default",
+    "description": "default quick links configuration",
+    "configuration": {
+      "protocol":
+      {
+        "type":"http",
+        "checks":[
+        ]
+      },
+      "links": [
+        {
+          "name": "trino_ui",
+          "label": "Trino UI",
+          "requires_user_name": "false",
+          "component_name": "TRINO_COORDINATOR",
+          "url":"%@://%@:%@",
+          "port":{
+            "http_property": "http-server.http.port",
+            "http_default_port": "8280",
+            "regex": "^(\\d+)$",
+            "site": "config-properties"
+          },
+          "protocol":{
+            "type":"https",
+            "checks":[
+              {
+                "property":"http-server.https.enabled",
+                "desired":"true",
+                "site":"config-properties"
+              }
+             ]
+         }
+        }
+      ]
+    }
+  }
\ No newline at end of file
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/role_command_order.json
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/role_command_order.json b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/role_command_order.json
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/role_command_order.json	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,8 @@
+{
+  "general_deps" : {
+    "_comment" : "dependencies for TRINO",
+	"TRINO_COORDINATOR-START" : ["HIVE_METASTORE-START", "RANGER_USERSYNC-START"],
+	"TRINO_WORKER-START" : ["TRINO_COORDINATOR-START"],
+	"TRINO_COORDINATOR-STOP" : ["TRINO_WORKER-STOP"]
+  }
+}
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/service_advisor.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/service_advisor.py b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/service_advisor.py
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/service_advisor.py	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,227 @@
+#!/usr/bin/env ambari-python-wrap
+"""
+Licensed to the Apache Software Foundation (ASF) under one
+or more contributor license agreements.  See the NOTICE file
+distributed with this work for additional information
+regarding copyright ownership.  The ASF licenses this file
+to you under the Apache License, Version 2.0 (the
+"License"); you may not use this file except in compliance
+with the License.  You may obtain a copy of the License at
+
+    http://www.apache.org/licenses/LICENSE-2.0
+
+Unless required by applicable law or agreed to in writing, software
+distributed under the License is distributed on an "AS IS" BASIS,
+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+See the License for the specific language governing permissions and
+limitations under the License.
+"""
+
+# Python imports
+import imp
+import os
+import traceback
+import re
+import socket
+import fnmatch
+
+
+from resource_management.core.logger import Logger
+
+SCRIPT_DIR = os.path.dirname(os.path.abspath(__file__))
+STACKS_DIR = os.path.join(SCRIPT_DIR, "../../../../../stacks/")
+PARENT_FILE = os.path.join(STACKS_DIR, "service_advisor.py")
+
+try:
+    if "BASE_SERVICE_ADVISOR" in os.environ:
+        PARENT_FILE = os.environ["BASE_SERVICE_ADVISOR"]
+    with open(PARENT_FILE, "rb") as fp:
+        service_advisor = imp.load_module(
+            "service_advisor", fp, PARENT_FILE, (".py", "rb", imp.PY_SOURCE)
+        )
+except Exception as e:
+    traceback.print_exc()
+    print("Failed to load parent")
+
+
+class TrinoServiceAdvisor(service_advisor.ServiceAdvisor):
+    def __init__(self, *args, **kwargs):
+        self.as_super = super(TrinoServiceAdvisor, self)
+        self.as_super.__init__(*args, **kwargs)
+
+        # Always call these methods
+        self.modifyMastersWithMultipleInstances()
+        self.modifyCardinalitiesDict()
+        self.modifyHeapSizeProperties()
+        self.modifyNotValuableComponents()
+        self.modifyComponentsNotPreferableOnServer()
+        self.modifyComponentLayoutSchemes()
+
+    def modifyMastersWithMultipleInstances(self):
+        """
+        Modify the set of masters with multiple instances.
+        Must be overriden in child class.
+        """
+        # Nothing to do
+        pass
+
+    def modifyCardinalitiesDict(self):
+        """
+        Modify the dictionary of cardinalities.
+        Must be overriden in child class.
+        """
+        # Nothing to do
+        pass
+
+    def modifyHeapSizeProperties(self):
+        """
+        Modify the dictionary of heap size properties.
+        Must be overriden in child class.
+        """
+        pass
+
+    def modifyNotValuableComponents(self):
+        """
+        Modify the set of components whose host assignment is based on other services.
+        Must be overriden in child class.
+        """
+        # Nothing to do
+        pass
+
+    def modifyComponentsNotPreferableOnServer(self):
+        """
+        Modify the set of components that are not preferable on the server.
+        Must be overriden in child class.
+        """
+        # Nothing to do
+        pass
+
+    def modifyComponentLayoutSchemes(self):
+        """
+        Modify layout scheme dictionaries for components.
+        The scheme dictionary basically maps the number of hosts to
+        host index where component should exist.
+        Must be overriden in child class.
+        """
+
+        # Nothing to do
+        pass
+
+    def getServiceComponentLayoutValidations(self, services, hosts):
+        """
+        Get a list of errors.
+        Must be overriden in child class.
+        """
+
+        return self.getServiceComponentCardinalityValidations(services, hosts, "TRINO")
+
+    def getServiceConfigurationRecommendations(
+        self, configurations, clusterData, services, hosts
+    ):
+        """
+        Entry point.
+        Must be overriden in child class.
+        """
+        # Logger.info("Class: %s, Method: %s. Recommending Service Configurations." %
+        #            (self.__class__.__name__, inspect.stack()[0][3]))
+
+        recommender = TrinoRecommender()
+        recommender.recommendTrinoConfigurationsFromHDP32(
+            configurations, clusterData, services, hosts
+        )
+
+    # def getServiceConfigurationRecommendationsForSSO(self, configurations, clusterData, services, hosts):
+    #   """
+    #   Entry point.
+    #   Must be overriden in child class.
+    #   """
+    #   recommender = TrinoRecommender()
+    #   recommender.recommendConfigurationsForSSO(configurations, clusterData, services, hosts)
+
+    def getServiceConfigurationsValidationItems(
+        self, configurations, recommendedDefaults, services, hosts
+    ):
+        """
+        Entry point.
+        Validate configurations for the service. Return a list of errors.
+        The code for this function should be the same for each Service Advisor.
+        """
+        # Logger.info("Class: %s, Method: %s. Validating Configurations." %
+        #            (self.__class__.__name__, inspect.stack()[0][3]))
+
+        return []
+
+    @staticmethod
+    def isKerberosEnabled(services, configurations):
+        """
+        Determines if security is enabled by testing the value of core-site/hadoop.security.authentication enabled.
+        If the property exists and is equal to "kerberos", then is it enabled; otherwise is it assumed to be
+        disabled.
+
+        :type services: dict
+        :param services: the dictionary containing the existing configuration values
+        :type configurations: dict
+        :param configurations: the dictionary containing the updated configuration values
+        :rtype: bool
+        :return: True or False
+        """
+        if (
+            configurations
+            and "core-site" in configurations
+            and "hadoop.security.authentication"
+            in configurations["core-site"]["properties"]
+        ):
+            return (
+                configurations["core-site"]["properties"][
+                    "hadoop.security.authentication"
+                ].lower()
+                == "kerberos"
+            )
+        elif (
+            services
+            and "core-site" in services["configurations"]
+            and "hadoop.security.authentication"
+            in services["configurations"]["core-site"]["properties"]
+        ):
+            return (
+                services["configurations"]["core-site"]["properties"][
+                    "hadoop.security.authentication"
+                ].lower()
+                == "kerberos"
+            )
+        else:
+            return False
+
+
+class TrinoRecommender(service_advisor.ServiceAdvisor):
+    """
+    Trino Recommender suggests properties when adding the service for the first time or modifying configs via the UI.
+    """
+
+    def __init__(self, *args, **kwargs):
+        self.as_super = super(TrinoRecommender, self)
+        self.as_super.__init__(*args, **kwargs)
+
+    def recommendTrinoConfigurationsFromHDP32(
+        self, configurations, clusterData, services, hosts
+    ):
+        """
+        Recommend configurations for this service based on HDP 3.2.
+        """
+        putTrinoRangerPluginProperty = self.putProperty(configurations, "ranger-trino-plugin-properties", services)
+        putTrinoAccessControlProperty = self.putProperty(configurations, "access-control-properties", services)
+        putTrinoAccessControlPropertyAttribute = self.putPropertyAttribute(configurations, "access-control-properties")
+        if "ranger-env" in services["configurations"] and "trino-env" in services["configurations"]:
+            rangerEnvTrinoPluginProperty = services["configurations"]["ranger-env"]["properties"]["ranger-trino-plugin-enabled"]
+
+            putTrinoRangerPluginProperty("ranger-trino-plugin-enabled", rangerEnvTrinoPluginProperty)
+            self.logger.info("recommendTrinoConfigurationsFromHDP32 {}".format(rangerEnvTrinoPluginProperty))
+            if (rangerEnvTrinoPluginProperty.lower() == "yes"):
+                putTrinoAccessControlProperty("access-control.name", "apache-ranger")
+            else:
+                putTrinoAccessControlProperty("access-control.name", "allow-all")
+                putTrinoAccessControlPropertyAttribute("apache-ranger.service.name", "delete", "true")
+                putTrinoAccessControlPropertyAttribute("apache-ranger.plugin.config.resource", "delete", "true")
+        else:
+            putTrinoAccessControlPropertyAttribute("apache-ranger.service.name", "delete", "true")
+            putTrinoAccessControlPropertyAttribute("apache-ranger.plugin.config.resource", "delete", "true")
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/setup.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/setup.py b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/setup.py
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/setup.py	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,59 @@
+#!/usr/bin/env python
+# -*- coding: utf-8 -*-
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+# http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+try:
+    from setuptools import setup
+except ImportError:
+    from distutils.core import setup
+
+with open("README.md") as readme_file:
+    readme = readme_file.read()
+
+with open("HISTORY.rst") as history_file:
+    history = history_file.read().replace(".. :changelog:", "")
+
+test_requirements = [
+    "tox==1.9.2",
+    "nose==1.3.7",
+    "mock==1.0.1",
+]
+
+
+setup(
+    name="ambari-presto",
+    version="1.3",
+    description="This project contains the integration code for integrating \
+Presto as a service in Ambari.",
+    long_description=readme + "\n\n" + history,
+    author="Teradata Corporation",
+    author_email="anton.petrov@teradata.com",
+    url="https://github.com/TeradataCenterForHadoop/ambari-presto-service",
+    packages=["package.scripts"],
+    include_package_data=True,
+    license="APLv2",
+    zip_safe=False,
+    keywords=["presto", "ambari", "hadoop"],
+    classifiers=[
+        "Development Status :: 3 - Alpha",
+        "Intended Audience :: Developers",
+        "License :: OSI Approved :: APLv2 License",
+        "Natural Language :: English",
+        "Programming Language :: Python :: 2",
+        "Programming Language :: Python :: 2.6",
+        "Programming Language :: Python :: 2.7",
+    ],
+    test_suite="tests",
+    tests_require=test_requirements,
+)
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/themes/theme.json
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/themes/theme.json b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/themes/theme.json
new file mode 100644
--- /dev/null	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/themes/theme.json	(revision a9232930c5e50a22a5d9cbbe9428f38e0bc0359e)
@@ -0,0 +1,218 @@
+{
+  "name": "default",
+  "description": "Default theme for Presto service",
+  "configuration": {
+    "layouts": [
+      {
+        "name": "default",
+        "tabs": [
+          {
+            "name": "settings",
+            "display-name": "Settings",
+            "layout": {
+              "tab-columns": "2",
+              "tab-rows": "3",
+              "sections": [
+                {
+                  "name": "section-node-config",
+                  "display-name": "Node Config",
+                  "row-index": "0",
+                  "column-index": "0",
+                  "row-span": "1",
+                  "column-span": "1",
+                  "subsections": [
+                    {
+                      "name": "subsection-node-config",
+                      "row-index": "0",
+                      "column-index": "0",
+                      "row-span": "1",
+                      "column-span": "1"
+                    }
+                  ]
+                },
+                {
+                  "name": "section-general-config",
+                  "display-name": "General Config",
+                  "row-index": "0",
+                  "column-index": "1",
+                  "row-span": "3",
+                  "column-span": "1",
+                  "subsections": [
+                    {
+                      "name": "subsection-general-config",
+                      "row-index": "0",
+                      "column-index": "0",
+                      "row-span": "3",
+                      "column-span": "1"
+                    }
+                  ]
+                },
+                {
+                  "name": "section-connector-config",
+                  "display-name": "Connectors",
+                  "row-index": "1",
+                  "column-index": "0",
+                  "row-span": "1",
+                  "column-span": "1",
+                  "subsections": [
+                    {
+                      "name": "subsection-connector-config",
+                      "row-index": "0",
+                      "column-index": "0",
+                      "row-span": "1",
+                      "column-span": "1"
+                    }
+                  ]
+                },
+                {
+                  "name": "section-jvm-config",
+                  "display-name": "JVM Config",
+                  "row-index": "2",
+                  "column-index": "0",
+                  "row-span": "1",
+                  "column-span": "1",
+                  "subsections": [
+                    {
+                      "name": "subsection-jvm-config",
+                      "row-index": "0",
+                      "column-index": "0",
+                      "row-span": "1",
+                      "column-span": "1"
+                    }
+                  ]
+                }
+              ]
+            }
+          }
+        ]
+      }
+    ],
+    "placement": {
+      "configuration-layout": "default",
+      "configs": [
+        {
+          "config": "node.properties/node.environment",
+          "subsection-name": "subsection-node-config"
+        },
+        {
+          "config": "node.properties/plugin.config-dir",
+          "subsection-name": "subsection-node-config"
+        },
+        {
+          "config": "node.properties/plugin.dir",
+          "subsection-name": "subsection-node-config"
+        },
+        {
+          "config": "connectors.properties/connectors.to.add",
+          "subsection-name": "subsection-connector-config"
+        },
+        {
+          "config": "connectors.properties/connectors.to.delete",
+          "subsection-name": "subsection-connector-config"
+        },
+        {
+          "config": "config.properties/node-scheduler.include-coordinator",
+          "subsection-name": "subsection-general-config"
+        },
+        {
+          "config": "config.properties/http-server.http.port",
+          "subsection-name": "subsection-general-config"
+        },
+        {
+          "config": "config.properties/query.max-memory",
+          "subsection-name": "subsection-general-config"
+        },
+        {
+          "config": "config.properties/query.max-memory-per-node",
+          "subsection-name": "subsection-general-config"
+        },
+        {
+          "config": "config.properties/discovery.uri",
+          "subsection-name": "subsection-general-config"
+        },
+        {
+          "config": "jvm.config/jvm.config",
+          "subsection-name": "subsection-jvm-config"
+        }
+      ]
+    },
+    "widgets": [
+      {
+        "config": "node.properties/node.environment",
+        "widget": {
+          "type": "text-area"
+        }
+      },
+      {
+        "config": "node.properties/plugin.config-dir",
+        "widget": {
+          "type": "directory"
+        }
+      },
+      {
+        "config": "node.properties/plugin.dir",
+        "widget": {
+          "type": "directory"
+        }
+      },
+      {
+        "config": "connectors.properties/connectors.to.add",
+        "widget": {
+          "type": "text-area"
+        }
+      },
+      {
+        "config": "connectors.properties/connectors.to.delete",
+        "widget": {
+          "type": "text-area"
+        }
+      },
+      {
+        "config": "config.properties/node-scheduler.include-coordinator",
+        "widget": {
+          "type": "toggle"
+        }
+      },
+      {
+        "config": "config.properties/http-server.http.port",
+        "widget": {
+          "type": "text-area"
+        }
+      },
+      {
+        "config": "config.properties/query.max-memory",
+        "widget": {
+          "type": "slider",
+          "units": [
+            {
+              "unit-name": "GB"
+            }
+          ]
+        }
+      },
+      {
+        "config": "config.properties/query.max-memory-per-node",
+        "widget": {
+          "type": "slider",
+          "units": [
+            {
+              "unit-name": "GB"
+            }
+          ]
+        }
+      },
+      {
+        "config": "config.properties/discovery.uri",
+        "widget": {
+          "type": "text-area"
+        }
+      },
+      {
+        "config": "jvm.config/jvm.config",
+        "widget": {
+          "type": "text-area"
+        }
+      }
+    ]
+  }
+}
\ No newline at end of file
