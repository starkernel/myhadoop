Subject: [PATCH] fixed： 2.2.3 第一次优化调整，none knox
---
Index: ambari-common/src/main/python/resource_management/libraries/functions/solr_cloud_util_v2.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-common/src/main/python/resource_management/libraries/functions/solr_cloud_util_v2.py b/ambari-common/src/main/python/resource_management/libraries/functions/solr_cloud_util_v2.py
--- a/ambari-common/src/main/python/resource_management/libraries/functions/solr_cloud_util_v2.py	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-common/src/main/python/resource_management/libraries/functions/solr_cloud_util_v2.py	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -1,4 +1,5 @@
 #!/usr/bin/env python3
+# -*- coding: utf-8 -*-

 import os
 import shlex
@@ -8,77 +9,121 @@
 from resource_management.core.exceptions import Fail
 from resource_management.core.resources.system import Execute

-__all__ = [
-    "check_znode",
-]
+__all__ = ["check_znode"]
+
+
+def _append_jvmflag(env: dict, flag: str) -> None:
+    """
+    zkCli.sh 在不同发行版下可能读取 CLIENT_JVMFLAGS / JVMFLAGS，两个都塞最保险
+    """
+    extra = " " + flag
+    env["CLIENT_JVMFLAGS"] = (env.get("CLIENT_JVMFLAGS") or "") + extra
+    env["JVMFLAGS"] = (env.get("JVMFLAGS") or "") + extra
+
+
+def _read_text_safely(path: str) -> str:
+    if not path or not os.path.exists(path):
+        return ""
+    try:
+        with open(path, "r", encoding="utf-8", errors="ignore") as f:
+            return f.read()
+    except Exception:
+        return ""
+
+
+def _safe_unlink(path: str) -> None:
+    try:
+        if path and os.path.exists(path):
+            os.remove(path)
+    except Exception:
+        pass
+
+
+def _has_sasl_symptom(out: str) -> bool:
+    if not out:
+        return False
+    return (
+        ("AuthFailed" in out)
+        or ("SASL configuration failed" in out)
+        or ("No password provided" in out)
+        or ("GSS initiate failed" in out)
+        or ("javax.security.auth.login.LoginException" in out)
+    )


-def _escape_for_single_quotes(s: str) -> str:
+def _looks_like_interactive_without_command(out: str) -> bool:
     """
-    在 bash 单引号字符串里安全插入内容：
-    abc'def -> abc'"'"'def
+    判断是否“进了交互但没执行命令”：
+    - 常见只看到 WATCHER / SyncConnected / 提示信息
+    - 看不到 stat 的关键字段，也看不到 NoNode
     """
-    return s.replace("'", "'\"'\"'")
+    if not out:
+        return False
+
+    has_watcher = ("WATCHER::" in out) or ("SyncConnected" in out)
+    has_stat_result = ("cZxid" in out) or ("mZxid" in out) or ("ctime" in out) or ("Created" in out)
+    has_nonode = ("Node does not exist" in out) or ("KeeperErrorCode = NoNode" in out) or ("NO_NODE" in out)
+
+    # 有 watcher，但既没有 stat 结果，也没有明确 NoNode，基本就是没跑起来 stat
+    return has_watcher and (not has_stat_result) and (not has_nonode)


 def check_znode(
-        zookeeper_quorum,
-        solr_znode,
-        java64_home=None,
-        zkcli_path="/usr/bigtop/current/zookeeper-client/bin/zkCli.sh",
+    zookeeper_quorum,
+    solr_znode,
+    java64_home=None,
+    zkcli_path="/usr/bigtop/current/zookeeper-client/bin/zkCli.sh",

-        # --- 新增：用于解决你遇到的 SASL/AuthFailed/timeout 124 ---
-        disable_sasl=False,                 # True: 强制 -Dzookeeper.sasl.client=false（适用于 ZK 未启用 Kerberos 的场景）
-        jaas_conf=None,                     # 如 /etc/zookeeper/conf/jaas-client.conf（ZK 启用 Kerberos 时常用）
-        jaas_section="Client",              # JAAS section name，默认 Client
-        kinit_keytab=None,                  # 如 /etc/security/keytabs/solr.service.keytab
-        kinit_principal=None,               # 如 solr/host@REALM
-        timeout_sec=15,                     # 外层 /usr/bin/timeout 秒数
+    # --- SASL/JAAS/Kerberos 控制 ---
+    disable_sasl=False,          # True: 强制 -Dzookeeper.sasl.client=false（适用于 ZK 未启用 Kerberos 的场景）
+    jaas_conf=None,              # 如 /etc/zookeeper/conf/jaas-client.conf（ZK 启用 Kerberos 时常用）
+    jaas_section="Client",       # JAAS section name，默认 Client
+    kinit_keytab=None,           # 如 /etc/security/keytabs/solr.service.keytab
+    kinit_principal=None,        # 如 solr/host@REALM
+    timeout_sec=15,              # 外层 /usr/bin/timeout 秒数
 ):
     """
-    轻量版 check_znode：
-    - 不再依赖 /usr/lib/ambari-infra-solr-client/solrCloudCli.sh
-    - 直接调用 zkCli.sh:  echo stat /znode | zkCli.sh -server host1:2181,...
-    - 失败抛 Fail，交给外层 @retry 处理重试
+    轻量版 check_znode（可直接用于 Ambari 脚本）：
+
+    执行策略（重点修复你遇到的“交互模式卡住/没执行 stat”）：
+    1) 优先使用 zkCli.sh 的“单命令模式”：
+       zkCli.sh -server host1:2181,host2:2181 stat /path
+       这种模式执行完会退出，不依赖 stdin/tty。
+    2) 若某些发行版不支持单命令模式，则降级用 heredoc 输入多行命令：
+       zkCli.sh -server ... <<'EOF'
+       stat /path
+       quit
+       EOF
+
+    同时保留：
+    - disable_sasl / jaas_conf / kinit
+    - 自动兜底：当未显式走 Kerberos 路径但出现 SASL 症状时，自动重试一次并强制 -Dzookeeper.sasl.client=false
     """

-    # 基本校验，避免 stat 收到奇怪参数
-    if not solr_znode or not solr_znode.startswith("/"):
+    # -------- 参数校验 --------
+    if not solr_znode or not str(solr_znode).startswith("/"):
         raise Fail("Invalid solr_znode: {0}".format(solr_znode))
+    if not zookeeper_quorum:
+        raise Fail("Invalid zookeeper_quorum: {0}".format(zookeeper_quorum))

-    # 如果你希望强制使用指定 JDK，也可以在这里构造环境变量
+    # -------- 环境变量 --------
     env = {}
     if java64_home:
         env["JAVA_HOME"] = java64_home

-    # NOTE:
-    # - Ubuntu 上用 shell.call + 管道有时会卡住（zkCli 进入交互模式不退出）
-    # - 这里最小改造为使用 Execute，并且给 zkCli 额外输入 quit，确保退出
-    # - 同时把输出重定向到临时文件，方便后续解析判断
+    # 临时输出文件（用来解析 stat 结果/错误）
     out_file = "/tmp/zkcli_stat_{0}.out".format(uuid.uuid4().hex)

-    # --- 新增：SASL/JAAS 控制（解决 AuthFailed/No password provided 导致卡住超时） ---
-    jvm_flags = []
-
-    # 1) 强制禁用 SASL（如果你的 ZK 没开 Kerberos，这是最稳的止血）
+    # -------- JVM Flags：SASL/JAAS 控制 --------
     if disable_sasl:
-        jvm_flags.append("-Dzookeeper.sasl.client=false")
+        _append_jvmflag(env, "-Dzookeeper.sasl.client=false")

-    # 2) 指定 JAAS（如果你的 ZK 开了 Kerberos，一般需要）
     if jaas_conf:
-        jvm_flags.append("-Djava.security.auth.login.config={0}".format(jaas_conf))
-        jvm_flags.append("-Dzookeeper.sasl.client=true")
-        jvm_flags.append("-Dzookeeper.sasl.clientconfig={0}".format(jaas_section))
-        # 这里不强塞 principal/keytab，因为通常 jaas_conf 里已经写死了
-        # 真要动态注入，建议在 jaas_conf 里配 useKeyTab/doNotPrompt/useTicketCache
+        _append_jvmflag(env, "-Djava.security.auth.login.config={0}".format(jaas_conf))
+        _append_jvmflag(env, "-Dzookeeper.sasl.client=true")
+        _append_jvmflag(env, "-Dzookeeper.sasl.clientconfig={0}".format(jaas_section))

-    if jvm_flags:
-        extra = " " + " ".join(jvm_flags)
-        # zkCli.sh 在不同发行版下可能读取 CLIENT_JVMFLAGS / JVMFLAGS，两个都塞最保险
-        env["CLIENT_JVMFLAGS"] = env.get("CLIENT_JVMFLAGS", "") + extra
-        env["JVMFLAGS"] = env.get("JVMFLAGS", "") + extra
-
-    # 3) 可选：先 kinit（避免 “No password provided / asked for a password”）
+    # 可选：先 kinit
     if kinit_keytab and kinit_principal:
         kinit_cmd = "kinit -kt {kt} {princ}".format(
             kt=shlex.quote(kinit_keytab),
@@ -87,78 +132,129 @@
         Logger.info("Refreshing Kerberos ticket with: {0}".format(kinit_cmd))
         Execute(kinit_cmd, environment=env, logoutput=True, timeout=20)

-    # 仍然保持“echo stat ... | zkCli.sh ...”这个思路，但用 printf 追加 quit，避免卡住
-    # 注意：这里不要对 solr_znode 用 shlex.quote，否则会把引号传进 zkCli 命令里
-    znode_for_printf = _escape_for_single_quotes(solr_znode)
-    inner = "printf 'stat {znode}\\nquit\\n' | {zkcli} -server {zk_quorum}".format(
-        znode=znode_for_printf,
-        zkcli=shlex.quote(zkcli_path),
-        zk_quorum=shlex.quote(zookeeper_quorum),
-    )
+    explicit_secure_path = bool(jaas_conf) or (bool(kinit_keytab) and bool(kinit_principal))
+
+    # -------- 组装两种执行方式（单命令优先，heredoc 兜底）--------
+    zkcli = shlex.quote(zkcli_path)
+    quorum = shlex.quote(str(zookeeper_quorum))
+    znode = shlex.quote(str(solr_znode))

-    # 合并 stderr，且加一个外层超时兜底（有网络/认证问题时防止无限等待）
-    cmd = "/usr/bin/timeout {t}s bash -lc {inner} > {out} 2>&1".format(
-        t=int(timeout_sec),
-        inner=shlex.quote(inner),
-        out=shlex.quote(out_file),
-    )
+    # 方式1：单命令模式（推荐，避免 stdin/tty/jline 问题）
+    inner_single = "{zkcli} -server {quorum} stat {znode}".format(zkcli=zkcli, quorum=quorum, znode=znode)
+
+    # 方式2：heredoc（兼容一些老/怪脚本）
+    # 注意用 <<'EOF' 关闭变量替换，避免路径里有奇怪字符导致 bash 展开
+    inner_heredoc = (
+        "{zkcli} -server {quorum} <<'EOF'\n"
+        "stat {raw_znode}\n"
+        "quit\n"
+        "EOF"
+    ).format(zkcli=zkcli, quorum=quorum, raw_znode=str(solr_znode))
+
+    def _wrap(inner: str, t: int) -> str:
+        return "/usr/bin/timeout {t}s bash -lc {inner} > {out} 2>&1".format(
+            t=int(t),
+            inner=shlex.quote(inner),
+            out=shlex.quote(out_file),
+        )

-    Logger.info("Checking znode with command: {0}".format(cmd))
+    cmd_single = _wrap(inner_single, timeout_sec)
+    cmd_heredoc = _wrap(inner_heredoc, timeout_sec)
+
+    def _run(cmd: str, run_env: dict) -> None:
+        Logger.info("Checking znode with command: {0}".format(cmd))
+        Execute(cmd, environment=run_env, logoutput=True, timeout=int(timeout_sec) + 10)
+
+    def _run_with_fallbacks(base_env: dict) -> None:
+        """
+        执行顺序：
+        - 先单命令
+        - 若疑似进入交互未执行，则用 heredoc 再跑
+        """
+        _safe_unlink(out_file)
+        _run(cmd_single, base_env)
+        out = _read_text_safely(out_file)

+        if _looks_like_interactive_without_command(out):
+            Logger.info("zkCli seems to enter interactive mode without executing stat; fallback to heredoc mode.")
+            _safe_unlink(out_file)
+            _run(cmd_heredoc, base_env)
+
+    # -------- 执行（带自动兜底重试：SASL 症状 -> 强制禁用 SASL 再跑一次）--------
+    tried_disable_sasl_fallback = False
     try:
-        # Execute 失败会直接抛异常（非 0 返回码/超时等）
-        Execute(cmd, environment=env, logoutput=True, timeout=int(timeout_sec) + 10)
+        _run_with_fallbacks(env)
     except Exception as e:
-        # 1) zkCli 本身执行失败（连不上、命令错误等）
-        #    Execute 会抛异常，这里尽量把输出带上，方便定位
-        out = ""
-        if os.path.exists(out_file):
+        out = _read_text_safely(out_file)
+        sasl_symptom = _has_sasl_symptom(out)
+
+        # 自动兜底：非 secure 路径 + SASL 症状 + 未显式 disable_sasl => 重试一次强制禁用 SASL
+        if sasl_symptom and (not explicit_secure_path) and (not disable_sasl):
+            Logger.info("Detected SASL symptom on non-secure path; retry once with -Dzookeeper.sasl.client=false")
+            env2 = dict(env)
+            _append_jvmflag(env2, "-Dzookeeper.sasl.client=false")
+            tried_disable_sasl_fallback = True
             try:
-                with open(out_file, "r", encoding="utf-8", errors="ignore") as f:
-                    out = f.read()
-            except Exception:
-                out = ""
-
-        # 如果是你现在这种 Kerberos/SASL 失败，给出更直观的提示（不影响原有异常语义）
-        hint = ""
-        if "AuthFailed" in out or "SASL configuration failed" in out or "No password provided" in out:
-            hint = " (Hint: ZooKeeper SASL/Kerberos auth failed; consider kinit/jaas_conf or disable_sasl)"
-
-        raise Fail(
-            "Failed to access ZooKeeper [{zk}] when checking znode [{znode}]. "
-            "Error={err}{hint}, output={out}".format(
-                zk=zookeeper_quorum,
-                znode=solr_znode,
-                err=str(e),
-                hint=hint,
-                out=out,
-            )
-        )
+                _run_with_fallbacks(env2)
+            except Exception as e2:
+                out2 = _read_text_safely(out_file)
+                raise Fail(
+                    "Failed to access ZooKeeper [{zk}] when checking znode [{znode}] "
+                    "even after disabling SASL fallback. Error={err}, output={out}".format(
+                        zk=zookeeper_quorum,
+                        znode=solr_znode,
+                        err=str(e2),
+                        out=out2,
+                    )
+                )
+        else:
+            hint = ""
+            if sasl_symptom:
+                hint = (
+                    " (Hint: ZooKeeper SASL/Kerberos client auth failed; "
+                    "for non-secure ZK set disable_sasl=True, "
+                    "for secure ZK provide jaas_conf and/or kinit.)"
+                )
+            raise Fail(
+                "Failed to access ZooKeeper [{zk}] when checking znode [{znode}]. "
+                "Error={err}{hint}, output={out}".format(
+                    zk=zookeeper_quorum,
+                    znode=solr_znode,
+                    err=str(e),
+                    hint=hint,
+                    out=out,
+                )
+            )

-    # 读取输出
-    out = ""
-    try:
-        with open(out_file, "r", encoding="utf-8", errors="ignore") as f:
-            out = f.read()
-    finally:
-        try:
-            os.remove(out_file)
-        except Exception:
-            pass
+    # -------- 读取输出并清理 --------
+    out = _read_text_safely(out_file)
+    _safe_unlink(out_file)

-    Logger.info("zkCli.sh output:\n{0}".format(out))
+    if tried_disable_sasl_fallback:
+        Logger.info("zkCli.sh output (after SASL-disabled fallback):\n{0}".format(out))
+    else:
+        Logger.info("zkCli.sh output:\n{0}".format(out))

-    # 2) 能连上 ZK，但是节点不存在
-    #    一般会包含 "Node does not exist" 或者没有 stat 信息(cZxid)
-    if "Node does not exist" in out or "NO_NODE" in out or "KeeperErrorCode = NoNode" in out:
+    # -------- 业务判断：NoNode / 正常 stat --------
+    if ("Node does not exist" in out) or ("NO_NODE" in out) or ("KeeperErrorCode = NoNode" in out):
         raise Fail(
             "ZNode [{znode}] does NOT exist in ZooKeeper [{zk}]".format(
                 znode=solr_znode, zk=zookeeper_quorum
             )
         )

-    # 经验上，正常 stat 输出里会有 cZxid / mZxid 这些字段
-    if "cZxid" not in out and "Created" not in out:
+    # 正常 stat 输出里一般会有这些字段（不同版本略有差异，尽量宽松）
+    has_stat = (
+        ("cZxid" in out)
+        or ("mZxid" in out)
+        or ("ctime" in out)
+        or ("mtime" in out)
+        or ("dataLength" in out)
+        or ("numChildren" in out)
+        or ("Created" in out)
+    )
+
+    if not has_stat:
         raise Fail(
             "Unexpected zkCli output when checking znode [{znode}] in ZooKeeper "
             "[{zk}]:\n{out}".format(znode=solr_znode, zk=zookeeper_quorum, out=out)
Index: ambari-server/src/main/resources/scripts/stack_advisor.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/scripts/stack_advisor.py b/ambari-server/src/main/resources/scripts/stack_advisor.py
--- a/ambari-server/src/main/resources/scripts/stack_advisor.py	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-server/src/main/resources/scripts/stack_advisor.py	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -151,6 +151,12 @@


 def instantiateStackAdvisor(stackName, stackVersion, parentVersions):
+  import warnings
+  warnings.filterwarnings(
+    "ignore",
+    category=DeprecationWarning,
+    message=r".*the imp module is deprecated.*"
+  )
   """Instantiates StackAdvisor implementation for the specified Stack"""
   import imp

Index: ambari-server/src/main/resources/stack-hooks/before-ANY/scripts/shared_initialization.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stack-hooks/before-ANY/scripts/shared_initialization.py b/ambari-server/src/main/resources/stack-hooks/before-ANY/scripts/shared_initialization.py
--- a/ambari-server/src/main/resources/stack-hooks/before-ANY/scripts/shared_initialization.py	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-server/src/main/resources/stack-hooks/before-ANY/scripts/shared_initialization.py	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -29,309 +29,328 @@


 def setup_users():
-  """
-  Creates users before cluster installation
-  """
-  import params
+    """
+    Creates users before cluster installation
+    """
+    import params

-  should_create_users_and_groups = False
-  if params.host_sys_prepped:
-    should_create_users_and_groups = not params.sysprep_skip_create_users_and_groups
-  else:
-    should_create_users_and_groups = not params.ignore_groupsusers_create
+    should_create_users_and_groups = False
+    if params.host_sys_prepped:
+        should_create_users_and_groups = not params.sysprep_skip_create_users_and_groups
+    else:
+        should_create_users_and_groups = not params.ignore_groupsusers_create

-  if should_create_users_and_groups:
-    for group in params.group_list:
-      Group(
-        group,
-      )
+    if should_create_users_and_groups:
+
+        # Ttbigdata 修改：确保创建 hbase 用户所需的 gid/groups 映射存在
+        if "hbase" not in params.user_list:
+            params.user_list.append("hbase")
+
+        if "hbase" not in params.user_to_gid_dict:
+            params.user_to_gid_dict["hbase"] = "hadoop"  # 默认主组
+        if "hbase" not in params.user_to_groups_dict:
+            params.user_to_groups_dict["hbase"] = ["hadoop"]  # 默认附加组
+
+        # Ttbigdata 修改：确保 admin 用户所需的 gid/groups 映射存在（用于 doAs/YARN 容器运行）
+        if "admin" not in params.user_list:
+            params.user_list.append("admin")
+
+        if "admin" not in params.user_to_gid_dict:
+            params.user_to_gid_dict["admin"] = "hadoop"  # 默认主组
+        if "admin" not in params.user_to_groups_dict:
+            params.user_to_groups_dict["admin"] = ["hadoop"]  # 默认附加组
+
+        for group in params.group_list:
+            Group(
+                group,
+            )

-    for user in params.user_list:
-      User(
-        user,
-        uid=get_uid(user) if params.override_uid == "true" else None,
-        gid=params.user_to_gid_dict[user],
-        groups=params.user_to_groups_dict[user],
-        fetch_nonlocal_groups=params.fetch_nonlocal_groups,
-      )
+        for user in params.user_list:
+            User(
+                user,
+                uid=get_uid(user) if params.override_uid == "true" else None,
+                gid=params.user_to_gid_dict[user],
+                groups=params.user_to_groups_dict[user],
+                fetch_nonlocal_groups=params.fetch_nonlocal_groups,
+            )

-    if params.override_uid == "true":
-      set_uid(params.smoke_user, params.smoke_user_dirs)
-    else:
-      Logger.info("Skipping setting uid for smoke user as host is sys prepped")
-  else:
-    Logger.info(
-      "Skipping creation of User and Group as host is sys prepped or ignore_groupsusers_create flag is on"
-    )
-    pass
+        if params.override_uid == "true":
+            set_uid(params.smoke_user, params.smoke_user_dirs)
+        else:
+            Logger.info("Skipping setting uid for smoke user as host is sys prepped")
+    else:
+        Logger.info(
+            "Skipping creation of User and Group as host is sys prepped or ignore_groupsusers_create flag is on"
+        )
+        pass

-  if params.has_hbase_masters:
-    Directory(
-      params.hbase_tmp_dir,
-      owner=params.hbase_user,
-      mode=0o775,
-      create_parents=True,
-      cd_access="a",
-    )
+    if params.has_hbase_masters:
+        Directory(
+            params.hbase_tmp_dir,
+            owner=params.hbase_user,
+            mode=0o775,
+            create_parents=True,
+            cd_access="a",
+        )

-    if params.override_uid == "true":
-      set_uid(params.hbase_user, params.hbase_user_dirs)
-    else:
-      Logger.info("Skipping setting uid for hbase user as host is sys prepped")
+        if params.override_uid == "true":
+            set_uid(params.hbase_user, params.hbase_user_dirs)
+        else:
+            Logger.info("Skipping setting uid for hbase user as host is sys prepped")

-  if should_create_users_and_groups:
-    if params.has_hdfs_clients:
-      create_dfs_cluster_admins()
-    if (
-      params.has_tez
-      and params.stack_version_formatted != ""
-      and compare_versions(params.stack_version_formatted, "2.3") >= 0
-    ):
-      create_tez_am_view_acls()
-  else:
-    Logger.info(
-      "Skipping setting dfs cluster admin and tez view acls as host is sys prepped"
-    )
+    if should_create_users_and_groups:
+        if params.has_hdfs_clients:
+            create_dfs_cluster_admins()
+        if (
+                params.has_tez
+                and params.stack_version_formatted != ""
+                and compare_versions(params.stack_version_formatted, "2.3") >= 0
+        ):
+            create_tez_am_view_acls()
+    else:
+        Logger.info(
+            "Skipping setting dfs cluster admin and tez view acls as host is sys prepped"
+        )


 def create_dfs_cluster_admins():
-  """
-  dfs.cluster.administrators support format <comma-delimited list of usernames><space><comma-delimited list of group names>
-  """
-  import params
+    """
+    dfs.cluster.administrators support format <comma-delimited list of usernames><space><comma-delimited list of group names>
+    """
+    import params

-  groups_list = create_users_and_groups(params.dfs_cluster_administrators_group)
+    groups_list = create_users_and_groups(params.dfs_cluster_administrators_group)

-  User(
-    params.hdfs_user,
-    groups=params.user_to_groups_dict[params.hdfs_user] + groups_list,
-    fetch_nonlocal_groups=params.fetch_nonlocal_groups,
-  )
+    User(
+        params.hdfs_user,
+        groups=params.user_to_groups_dict[params.hdfs_user] + groups_list,
+        fetch_nonlocal_groups=params.fetch_nonlocal_groups,
+    )


 def create_tez_am_view_acls():
-  """
-  tez.am.view-acls support format <comma-delimited list of usernames><space><comma-delimited list of group names>
-  """
-  import params
+    """
+    tez.am.view-acls support format <comma-delimited list of usernames><space><comma-delimited list of group names>
+    """
+    import params

-  if not params.tez_am_view_acls.startswith("*"):
-    create_users_and_groups(params.tez_am_view_acls)
+    if not params.tez_am_view_acls.startswith("*"):
+        create_users_and_groups(params.tez_am_view_acls)


 def create_users_and_groups(user_and_groups):
-  import params
+    import params

-  parts = re.split("\s+", user_and_groups)
-  if len(parts) == 1:
-    parts.append("")
+    parts = re.split("\s+", user_and_groups)
+    if len(parts) == 1:
+        parts.append("")

-  users_list = parts[0].strip(",").split(",") if parts[0] else []
-  groups_list = parts[1].strip(",").split(",") if parts[1] else []
+    users_list = parts[0].strip(",").split(",") if parts[0] else []
+    groups_list = parts[1].strip(",").split(",") if parts[1] else []

-  # skip creating groups and users if * is provided as value.
-  users_list = [x for x in users_list if x != "*"]
-  groups_list = [x for x in groups_list if x != "*"]
+    # skip creating groups and users if * is provided as value.
+    users_list = [x for x in users_list if x != "*"]
+    groups_list = [x for x in groups_list if x != "*"]

-  if users_list:
-    User(users_list, fetch_nonlocal_groups=params.fetch_nonlocal_groups)
+    if users_list:
+        User(users_list, fetch_nonlocal_groups=params.fetch_nonlocal_groups)

-  if groups_list:
-    Group(
-      copy(groups_list),
-    )
-  return groups_list
+    if groups_list:
+        Group(
+            copy(groups_list),
+        )
+    return groups_list


 def set_uid(user, user_dirs):
-  """
-  user_dirs - comma separated directories
-  """
-  import params
+    """
+    user_dirs - comma separated directories
+    """
+    import params

-  File(
-    format("{tmp_dir}/changeUid.sh"),
-    content=StaticFile("changeToSecureUid.sh"),
-    mode=0o555,
-  )
-  ignore_groupsusers_create_str = str(params.ignore_groupsusers_create).lower()
-  uid = get_uid(user, return_existing=True)
-  Execute(
-    format(
-      "{tmp_dir}/changeUid.sh {user} {user_dirs} {new_uid}",
-      new_uid=0 if uid is None else uid,
-    ),
-    not_if=format(
-      "(test $(id -u {user}) -gt 1000) || ({ignore_groupsusers_create_str})"
-    ),
-  )
+    File(
+        format("{tmp_dir}/changeUid.sh"),
+        content=StaticFile("changeToSecureUid.sh"),
+        mode=0o555,
+    )
+    ignore_groupsusers_create_str = str(params.ignore_groupsusers_create).lower()
+    uid = get_uid(user, return_existing=True)
+    Execute(
+        format(
+            "{tmp_dir}/changeUid.sh {user} {user_dirs} {new_uid}",
+            new_uid=0 if uid is None else uid,
+        ),
+        not_if=format(
+            "(test $(id -u {user}) -gt 1000) || ({ignore_groupsusers_create_str})"
+        ),
+    )


 def get_uid(user, return_existing=False):
-  """
-  Tries to get UID for username. It will try to find UID in custom properties in *cluster_env* and, if *return_existing=True*,
-  it will try to return UID of existing *user*.
+    """
+    Tries to get UID for username. It will try to find UID in custom properties in *cluster_env* and, if *return_existing=True*,
+    it will try to return UID of existing *user*.

-  :param user: username to get UID for
-  :param return_existing: return UID for existing user
-  :return:
-  """
-  import params
+    :param user: username to get UID for
+    :param return_existing: return UID for existing user
+    :return:
+    """
+    import params

-  user_str = str(user) + "_uid"
-  service_env = [
-    serviceEnv
-    for serviceEnv in params.config["configurations"]
-    if user_str in params.config["configurations"][serviceEnv]
-  ]
+    user_str = str(user) + "_uid"
+    service_env = [
+        serviceEnv
+        for serviceEnv in params.config["configurations"]
+        if user_str in params.config["configurations"][serviceEnv]
+    ]

-  if service_env and params.config["configurations"][service_env[0]][user_str]:
-    service_env_str = str(service_env[0])
-    uid = params.config["configurations"][service_env_str][user_str]
-    if len(service_env) > 1:
-      Logger.warning(f"Multiple values found for {user_str}, using {uid}")
-    return uid
-  else:
-    if return_existing:
-      # pick up existing UID or try to find available UID in /etc/passwd, see changeToSecureUid.sh for more info
-      if user == params.smoke_user:
-        return None
-      File(
-        format("{tmp_dir}/changeUid.sh"),
-        content=StaticFile("changeToSecureUid.sh"),
-        mode=0o555,
-      )
-      code, newUid = shell.call(format("{tmp_dir}/changeUid.sh {user}"))
-      return int(newUid)
-    else:
-      # do not return UID for existing user, used in User resource call to let OS to choose UID for us
-      return None
+    if service_env and params.config["configurations"][service_env[0]][user_str]:
+        service_env_str = str(service_env[0])
+        uid = params.config["configurations"][service_env_str][user_str]
+        if len(service_env) > 1:
+            Logger.warning(f"Multiple values found for {user_str}, using {uid}")
+        return uid
+    else:
+        if return_existing:
+            # pick up existing UID or try to find available UID in /etc/passwd, see changeToSecureUid.sh for more info
+            if user == params.smoke_user:
+                return None
+            File(
+                format("{tmp_dir}/changeUid.sh"),
+                content=StaticFile("changeToSecureUid.sh"),
+                mode=0o555,
+            )
+            code, newUid = shell.call(format("{tmp_dir}/changeUid.sh {user}"))
+            return int(newUid)
+        else:
+            # do not return UID for existing user, used in User resource call to let OS to choose UID for us
+            return None


 def setup_hadoop_env():
-  import params
+    import params

-  stackversion = params.stack_version_unformatted
-  Logger.info(f"FS Type: {params.dfs_type}")
-  if (
-    params.has_hdfs_clients
-    or stackversion.find("Gluster") >= 0
-    or params.dfs_type == "HCFS"
-  ):
-    if params.security_enabled:
-      tc_owner = "root"
-    else:
-      tc_owner = params.hdfs_user
+    stackversion = params.stack_version_unformatted
+    Logger.info(f"FS Type: {params.dfs_type}")
+    if (
+            params.has_hdfs_clients
+            or stackversion.find("Gluster") >= 0
+            or params.dfs_type == "HCFS"
+    ):
+        if params.security_enabled:
+            tc_owner = "root"
+        else:
+            tc_owner = params.hdfs_user

-    # create /etc/hadoop
-    Directory(params.hadoop_dir, mode=0o755)
+        # create /etc/hadoop
+        Directory(params.hadoop_dir, mode=0o755)

-    # write out hadoop-env.sh, but only if the directory exists
-    if os.path.exists(params.hadoop_conf_dir):
-      File(
-        os.path.join(params.hadoop_conf_dir, "hadoop-env.sh"),
-        owner=tc_owner,
-        group=params.user_group,
-        content=InlineTemplate(params.hadoop_env_sh_template),
-      )
+        # write out hadoop-env.sh, but only if the directory exists
+        if os.path.exists(params.hadoop_conf_dir):
+            File(
+                os.path.join(params.hadoop_conf_dir, "hadoop-env.sh"),
+                owner=tc_owner,
+                group=params.user_group,
+                content=InlineTemplate(params.hadoop_env_sh_template),
+            )


 def setup_env():
-  import params
+    import params

-  # Create tmp dir for java.io.tmpdir
-  # Handle a situation when /tmp is set to noexec
-  Directory(
-    params.hadoop_java_io_tmpdir,
-    owner=params.hdfs_user if params.has_hdfs_clients else None,
-    group=params.user_group,
-    mode=0o1777,
-  )
+    # Create tmp dir for java.io.tmpdir
+    # Handle a situation when /tmp is set to noexec
+    Directory(
+        params.hadoop_java_io_tmpdir,
+        owner=params.hdfs_user if params.has_hdfs_clients else None,
+        group=params.user_group,
+        mode=0o1777,
+    )


 def setup_java():
-  """
-  Install jdk using specific params.
-  Install ambari jdk as well if the stack and ambari jdk are different.
-  """
-  import params
+    """
+    Install jdk using specific params.
+    Install ambari jdk as well if the stack and ambari jdk are different.
+    """
+    import params

-  __setup_java(custom_java_home=params.java_home, custom_jdk_name=params.jdk_name)
-  if params.ambari_java_home and params.ambari_java_home != params.java_home:
-    __setup_java(
-      custom_java_home=params.ambari_java_home, custom_jdk_name=params.ambari_jdk_name
-    )
+    __setup_java(custom_java_home=params.java_home, custom_jdk_name=params.jdk_name)
+    if params.ambari_java_home and params.ambari_java_home != params.java_home:
+        __setup_java(
+            custom_java_home=params.ambari_java_home, custom_jdk_name=params.ambari_jdk_name
+        )


 def __setup_java(custom_java_home, custom_jdk_name):
-  """
-  Installs jdk using specific params, that comes from ambari-server
-  """
-  import params
+    """
+    Installs jdk using specific params, that comes from ambari-server
+    """
+    import params

-  java_exec = format("{custom_java_home}/bin/java")
+    java_exec = format("{custom_java_home}/bin/java")

-  if not os.path.isfile(java_exec):
-    if not params.jdk_name:  # if custom jdk is used.
-      raise Fail(
-        format(
-          "Unable to access {java_exec}. Confirm you have copied jdk to this host."
-        )
-      )
+    if not os.path.isfile(java_exec):
+        if not params.jdk_name:  # if custom jdk is used.
+            raise Fail(
+                format(
+                    "Unable to access {java_exec}. Confirm you have copied jdk to this host."
+                )
+            )

-    jdk_curl_target = format("{tmp_dir}/{custom_jdk_name}")
-    java_dir = os.path.dirname(params.java_home)
+        jdk_curl_target = format("{tmp_dir}/{custom_jdk_name}")
+        java_dir = os.path.dirname(params.java_home)

-    Directory(
-      params.artifact_dir,
-      create_parents=True,
-    )
+        Directory(
+            params.artifact_dir,
+            create_parents=True,
+        )

-    File(
-      jdk_curl_target,
-      content=DownloadSource(format("{jdk_location}/{custom_jdk_name}")),
-      not_if=format("test -f {jdk_curl_target}"),
-    )
+        File(
+            jdk_curl_target,
+            content=DownloadSource(format("{jdk_location}/{custom_jdk_name}")),
+            not_if=format("test -f {jdk_curl_target}"),
+        )

-    File(
-      jdk_curl_target,
-      mode=0o755,
-    )
+        File(
+            jdk_curl_target,
+            mode=0o755,
+        )

-    tmp_java_dir = tempfile.mkdtemp(prefix="jdk_tmp_", dir=params.tmp_dir)
+        tmp_java_dir = tempfile.mkdtemp(prefix="jdk_tmp_", dir=params.tmp_dir)

-    try:
-      if params.jdk_name.endswith(".bin"):
-        chmod_cmd = ("chmod", "+x", jdk_curl_target)
-        install_cmd = format(
-          "cd {tmp_java_dir} && echo A | {jdk_curl_target} -noregister && {sudo} cp -rp {tmp_java_dir}/* {java_dir}"
-        )
-      elif params.jdk_name.endswith(".gz"):
-        chmod_cmd = ("chmod", "a+x", java_dir)
-        install_cmd = format(
-          "cd {tmp_java_dir} && tar -xf {jdk_curl_target} && {sudo} cp -rp {tmp_java_dir}/* {java_dir}"
-        )
+        try:
+            if params.jdk_name.endswith(".bin"):
+                chmod_cmd = ("chmod", "+x", jdk_curl_target)
+                install_cmd = format(
+                    "cd {tmp_java_dir} && echo A | {jdk_curl_target} -noregister && {sudo} cp -rp {tmp_java_dir}/* {java_dir}"
+                )
+            elif params.jdk_name.endswith(".gz"):
+                chmod_cmd = ("chmod", "a+x", java_dir)
+                install_cmd = format(
+                    "cd {tmp_java_dir} && tar -xf {jdk_curl_target} && {sudo} cp -rp {tmp_java_dir}/* {java_dir}"
+                )

-      Directory(java_dir)
+            Directory(java_dir)

-      Execute(
-        chmod_cmd,
-        sudo=True,
-      )
+            Execute(
+                chmod_cmd,
+                sudo=True,
+            )

-      Execute(
-        install_cmd,
-      )
+            Execute(
+                install_cmd,
+            )

-    finally:
-      Directory(tmp_java_dir, action="delete")
+        finally:
+            Directory(tmp_java_dir, action="delete")

-    File(
-      format("{custom_java_home}/bin/java"),
-      mode=0o755,
-      cd_access="a",
-    )
-    Execute(
-      ("chmod", "-R", "755", params.java_home),
-      sudo=True,
-    )
+        File(
+            format("{custom_java_home}/bin/java"),
+            mode=0o755,
+            cd_access="a",
+        )
+        Execute(
+            ("chmod", "-R", "755", params.java_home),
+            sudo=True,
+        )
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/ATLAS/package/scripts/metadata.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/ATLAS/package/scripts/metadata.py b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/ATLAS/package/scripts/metadata.py
--- a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/ATLAS/package/scripts/metadata.py	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/ATLAS/package/scripts/metadata.py	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -50,6 +50,14 @@
               create_parents=True
               )

+    # Needed by both Server and Client
+    Directory('/home/atlas',
+              mode=0o755,
+              owner=params.metadata_user,
+              group=params.user_group,
+              create_parents=True
+              )
+
     if type == "server":
         Directory([params.pid_dir],
                   mode=0o755,
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HDFS/configuration/hdfs-site.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HDFS/configuration/hdfs-site.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HDFS/configuration/hdfs-site.xml
--- a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HDFS/configuration/hdfs-site.xml	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HDFS/configuration/hdfs-site.xml	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -410,13 +410,15 @@
     </property>
     <property>
         <name>dfs.cluster.administrators</name>
-        <value>hdfs</value>
-        <description>ACL for the admins, this configuration is used to control who can access the default servlets in
-            the namenode, etc. The value should be a comma separated list of users and groups. The user list comes first
-            and is separated by a space followed by the group list, e.g. "user1,user2 group1,group2". Both users and
-            groups are optional, so "user1", " group1", "", "user1 group1", "user1,user2 group1,group2" are all valid
-            (note the leading space in " group1"). '*' grants access to all users and groups, e.g. '*', '* ' and ' *'
-            are all valid.
+        <value>hdfs hadoop</value>
+        <description>
+            用于定义 HDFS 集群管理员的 ACL（访问控制列表）。
+            该配置项用于控制哪些用户或用户组可以访问 NameNode 上的默认管理 Servlet 等管理接口。
+            配置值为“用户列表 + 空格 + 用户组列表”的形式，用户和用户组之间用逗号分隔。
+            用户列表在前，用户组列表在后，例如："user1,user2 group1,group2"。
+            用户列表和用户组列表均为可选项，因此以下写法都是合法的：
+            "user1"、" group1"、""、"user1 group1"、"user1,user2 group1,group2"（注意 " group1" 前有一个空格）。
+            使用 "*" 表示授予所有用户和用户组访问权限，例如："*"、"* "、" *" 均为有效配置。
         </description>
         <on-ambari-upgrade add="true"/>
     </property>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HIVE/configuration/hive-site.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HIVE/configuration/hive-site.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HIVE/configuration/hive-site.xml
--- a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HIVE/configuration/hive-site.xml	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HIVE/configuration/hive-site.xml	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -149,9 +149,7 @@
     </property>
     <property>
         <name>hive.tez.java.opts</name>
-        <value>-server -Djava.net.preferIPv4Stack=true -XX:NewRatio=8 -XX:+UseNUMA -XX:+UseG1GC -XX:+ResizeTLAB
-            -XX:+PrintGCDetails -verbose:gc -XX:+PrintGCTimeStamps
-        </value>
+        <value>-server -Djava.net.preferIPv4Stack=true -XX:NewRatio=8 -XX:+UseNUMA -XX:+UseG1GC -XX:+ResizeTLAB -XX:+PrintGCDetails -verbose:gc -XX:+PrintGCTimeStamps</value>
         <description>Java command line options for Tez.</description>
         <on-ambari-upgrade add="false"/>
     </property>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/configuration/hue-desktop-ini.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/configuration/hue-desktop-ini.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/configuration/hue-desktop-ini.xml
--- a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/configuration/hue-desktop-ini.xml	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/configuration/hue-desktop-ini.xml	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -21,153 +21,159 @@
  */
 -->
 <configuration>
-
-  <property>
-    <name>DB_FLAVOR</name>
-    <value>postgresql_psycopg2</value>
-    <display-name>DB FLAVOR</display-name>
-    <description>The database type to be used (mysql/oracle/postgresql_psycopg2/sqlite3)</description>
-    <value-attributes>
-      <overridable>false</overridable>
-    </value-attributes>
-    <on-ambari-upgrade add="true"/>
-  </property>
-
-  <property>
-    <name>db_host</name>
-    <value>postgresql-hue</value>
-    <display-name>Hue Metastore Host</display-name>
-    <description>Database host</description>
-    <value-attributes>
-      <overridable>false</overridable>
-      <empty-value-valid>true</empty-value-valid>
-    </value-attributes>
-    <on-ambari-upgrade add="true"/>
-  </property>
+    <property>
+        <name>DB_FLAVOR</name>
+        <value>mysql</value>
+        <display-name>DB_FLAVOR</display-name>
+        <description>
+            【TTBIGDATA 定制】选择 Hue 使用的元数据库类型（默认：MySQL）。
+            选择后请确保已安装对应数据库驱动，并正确配置 db_host/db_port/db_name/db_user/db_password。
+        </description>
+        <value-attributes>
+            <type>value-list</type>
+            <entries>
+                <entry>
+                    <value>mysql</value>
+                    <label>MYSQL（推荐/默认）</label>
+                </entry>
+                <entry>
+                    <value>postgresql_psycopg2</value>
+                    <label>POSTGRESQL（psycopg2）</label>
+                </entry>
+                <entry>
+                    <value>oracle</value>
+                    <label>ORACLE</label>
+                </entry>
+                <entry>
+                    <value>sqlite3</value>
+                    <label>SQLITE3（仅测试/不推荐生产）</label>
+                </entry>
+            </entries>
+            <selection-cardinality>1</selection-cardinality>
+            <overridable>false</overridable>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>
+    <property>
+        <name>db_host</name>
+        <value/>
+        <display-name>Database Host</display-name>
+        <description>
+            【TTBIGDATA 定制】Hue 元数据库服务器地址（IP 或主机名）。
+        </description>
+        <value-attributes>
+            <overridable>false</overridable>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>

-  <property>
-    <name>db_port</name>
-    <value>5432</value>
-    <display-name>Hue Metastore Port</display-name>
-    <description>Hue Metastore Database Port</description>
-    <value-attributes>
-      <overridable>false</overridable>
-      <empty-value-valid>true</empty-value-valid>
-    </value-attributes>
-    <on-ambari-upgrade add="true"/>
-  </property>
+    <property>
+        <name>db_port</name>
+        <value>3306</value>
+        <display-name>Database Port</display-name>
+        <description>
+            【TTBIGDATA 定制】Hue 元数据库端口号。
+            MySQL 默认端口为 3306，PostgreSQL 默认端口为 5432。
+        </description>
+        <value-attributes>
+            <overridable>false</overridable>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>

-  <property>
-    <name>db_name</name>
-    <value>hue</value>
-    <display-name>Database Name</display-name>
-    <description>Database name</description>
-    <value-attributes>
-      <overridable>false</overridable>
-      <empty-value-valid>true</empty-value-valid>
-    </value-attributes>
-    <on-ambari-upgrade add="true"/>
-  </property>
+    <property>
+        <name>db_name</name>
+        <value/>
+        <display-name>Database Name</display-name>
+        <description>
+            【TTBIGDATA 定制】Hue 使用的数据库名称（Schema / Database）。
+        </description>
+        <value-attributes>
+            <overridable>false</overridable>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>

-  <property>
-    <name>db_user</name>
-    <value>hue</value>
-    <display-name>Database Username</display-name>
-    <description>Database username used for the Hue schema</description>
-    <value-attributes>
-      <overridable>false</overridable>
-      <empty-value-valid>true</empty-value-valid>
-    </value-attributes>
-    <on-ambari-upgrade add="true"/>
-  </property>
-
-  <property>
-    <name>db_password</name>
-    <value>hue</value>
-    <property-type>PASSWORD</property-type>
-    <display-name>Database Password</display-name>
-    <description>Database password for the Hue schema</description>
-    <value-attributes>
-      <type>password</type>
-      <overridable>false</overridable>
-      <empty-value-valid>true</empty-value-valid>
-    </value-attributes>
-    <on-ambari-upgrade add="true"/>
-  </property>
+    <property>
+        <name>db_user</name>
+        <value/>
+        <display-name>Database Username</display-name>
+        <description>
+            【TTBIGDATA 定制】用于访问 Hue 数据库的用户名。
+        </description>
+        <value-attributes>
+            <overridable>false</overridable>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>

-  <property>
-    <name>db_password</name>
-    <value>hue</value>
-    <display-name>Database Password</display-name>
-    <description>Database password for the Hue schema</description>
-    <value-attributes>
-      <type>password</type>
-      <overridable>false</overridable>
-      <empty-value-valid>true</empty-value-valid>
-    </value-attributes>
-    <property-type>PASSWORD</property-type>
-  </property>
+    <property>
+        <name>db_password</name>
+        <value/>
+        <display-name>Database Password</display-name>
+        <description>
+            【TTBIGDATA 定制】Hue 数据库用户对应的密码。
+        </description>
+        <value-attributes>
+            <type>password</type>
+            <overridable>false</overridable>
+        </value-attributes>
+        <property-type>PASSWORD</property-type>
+    </property>

-  <property>
-    <name>db_options</name>
-    <value>{}</value>
-    <display-name>Database Options</display-name>
-    <description>Database Options</description>
-    <on-ambari-upgrade add="true"/>
-  </property>
-  <property>
-    <name>hdfs_httpfs_host</name>
-    <value></value>
-    <display-name>hdfs_httpfs_host</display-name>
-    <description>when enable hdfs ha,set this values, if this value is empty,default choose first, it will not work.</description>
-    <on-ambari-upgrade add="true"/>
-    <value-attributes>
-      <empty-value-valid>true</empty-value-valid>
-    </value-attributes>
-  </property>
-  <!-- Kerberos configuration properties -->
-  <property>
-    <name>kerberos_hue_keytab</name>
-    <value>/etc/security/keytabs/hue.service.keytab</value>
-    <display-name>Kerberos Hue Keytab</display-name>
-    <description>Path to Hue's Kerberos keytab file.</description>
-    <value-attributes>
-      <empty-value-valid>true</empty-value-valid>
-    </value-attributes>
-    <on-ambari-upgrade add="true"/>
-  </property>
-  <property>
-    <name>kerberos_hue_principal</name>
-    <value>hue/_HOST@EXAMPLE.COM</value>
-    <display-name>Kerberos Hue Principal</display-name>
-    <description>Kerberos principal name for Hue</description>
-    <property-type>KERBEROS_PRINCIPAL</property-type>
-    <value-attributes>
-      <empty-value-valid>true</empty-value-valid>
-    </value-attributes>
-    <on-ambari-upgrade add="true"/>
-  </property>
+    <property>
+        <name>db_options</name>
+        <value>{}</value>
+        <display-name>Database Options</display-name>
+        <description>
+            【TTBIGDATA 定制】数据库连接的高级参数配置（JSON 格式）。
+            一般情况下保持默认即可。
+        </description>
+        <on-ambari-upgrade add="true"/>
+    </property>
+
+    <property>
+        <name>hdfs_httpfs_host</name>
+        <value/>
+        <display-name>hdfs_httpfs_host</display-name>
+        <description>
+            【TTBIGDATA 定制】在启用 HDFS HA 场景下，指定 HttpFS 服务主机。
+            若未配置，将默认选择列表中的第一个主机，可能导致访问失败。
+        </description>
+        <on-ambari-upgrade add="true"/>
+        <value-attributes>
+            <empty-value-valid>true</empty-value-valid>
+        </value-attributes>
+    </property>
+
+    <!-- Kerberos configuration properties -->
+    <property>
+        <name>kerberos_hue_keytab</name>
+        <value>/etc/security/keytabs/hue.service.keytab</value>
+        <display-name>Kerberos Hue Keytab</display-name>
+        <description>Path to Hue's Kerberos keytab file.</description>
+        <value-attributes>
+            <empty-value-valid>true</empty-value-valid>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>
+    <property>
+        <name>kerberos_hue_principal</name>
+        <value>hue/_HOST@EXAMPLE.COM</value>
+        <display-name>Kerberos Hue Principal</display-name>
+        <description>Kerberos principal name for Hue</description>
+        <property-type>KERBEROS_PRINCIPAL</property-type>
+        <value-attributes>
+            <empty-value-valid>true</empty-value-valid>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>

+
   <property>
     <name>content</name>
     <description>Hue Configure File</description>
     <value>
-# Hue configuration file
-# ===================================
-#
-# For complete documentation about the contents of this file, run
-#   $ (hue_root)/build/env/bin/hue config_help
-#
-# All .ini files under the current directory are treated equally.  Their
-# contents are merged to form the Hue configuration, which can
-# can be viewed on the Hue at
-#   http://(hue_host):(port)/dump_config
-
-
-###########################################################################
-# General configuration for core Desktop features (authentication, etc)
-###########################################################################
-
 [desktop]

   secret_key=941c6e219ae081990eb432b9bd6f169e7ff72b84d6c1a5382f6470a4130c747c
@@ -177,27 +183,20 @@
   django_debug_mode=false
   http_500_debug_mode=false
   gunicorn_work_class=gthread
+  server_user=hue
+  default_user=hue
+  server_group=hadoop
   app_blacklist=sqoop,pig,oozie,search,rdbms,security


   [[django_admins]]
   [[custom]]
   [[auth]]
-
-
-  # Configuration options for connecting to LDAP and Active Directory
-  # -------------------------------------------------------------------
   [[ldap]]
     [[[users]]]
     [[[groups]]]
     [[[ldap_servers]]]
-
-
-
-  # Configuration options for specifying the Source Version Control.
-  # ----------------------------------------------------------------
   [[vcs]]
-
   [[database]]
   {% if metastore_db_flavor != 'sqlite3' %}
     engine={{metastore_db_flavor}}
@@ -209,34 +208,14 @@
     options={{metastore_db_options}}
   {% endif %}

-  # Configuration options for specifying the Desktop session.
-  # For more info, see https://docs.djangoproject.com/en/1.4/topics/http/sessions/
-  # ------------------------------------------------------------------------
   [[session]]
-
-
-  # Configuration options for connecting to an external SMTP server
-  # ------------------------------------------------------------------------
   [[smtp]]
     host=localhost
     port=25
     user=
     password=
     tls=no
-
-  # Configuration options for KNOX integration for secured CDPD cluster
-  # ------------------------------------------------------------------------
   [[knox]]
-
-    # This is a list of hosts that knox proxy requests can come from
-    ## knox_proxyhosts=server1.domain.com,server2.domain.com
-    # List of Kerberos principal name which is allowed to impersonate others
-    ## knox_principal=knox1,knox2
-    # Comma separated list of strings representing the ports that the Hue server can trust as knox port.
-    ## knox_ports=80,8443
-
-  # Configuration options for Kerberos integration for secured Hadoop clusters
-  # ------------------------------------------------------------------------
   [[kerberos]]
     krb5_renewlifetime_enabled=false
   {% if security_enabled %}
@@ -245,49 +224,21 @@
     kinit_path={{kinit_path_local}}
   {% endif %}

-  # Configuration options for using OAuthBackend (Core) login
-  # ------------------------------------------------------------------------
   [[oauth]]

-  # Configuration options for using OIDCBackend (Core) login for SSO
-  # ------------------------------------------------------------------------
   [[oidc]]

-
-  # Configuration options for Metrics
-  # ------------------------------------------------------------------------
   [[metrics]]

-
-  # Configuration options for Slack
-  # ------------------------------------------------------------------------
   [[slack]]

-
-
-  # Configuration options for the request Tracing
-  # ------------------------------------------------------------------------
   [[tracing]]

-
-  # Configuration options for the Task Server
-  # ------------------------------------------------------------------------
   [[task_server]]

-
-   # Settings for the Google Cloud lib
-   # ------------------------------------------------------------------------
   [[gc_accounts]]
     [[[default]]]

-  ## Configuration for RAZ service integration
-  # ------------------------------------------------------------------------
-
-
-###########################################################################
-# Settings to configure the snippets available in the Notebook
-###########################################################################
-
 [notebook]
   [[interpreters]]
     [[[hive]]]
@@ -309,23 +260,10 @@



-###########################################################################
-# Settings to configure your Analytics Dashboards
-###########################################################################
-
 [dashboard]
-
   [[engines]]

-
-###########################################################################
-# Settings to configure your Hadoop cluster.
-###########################################################################
-
 [hadoop]
-
-  # Configuration for HDFS NameNode
-  # ------------------------------------------------------------------------
   [[hdfs_clusters]]
     [[[default]]]
       fs_defaultfs={{namenode_address}}
@@ -338,11 +276,7 @@
       {% endif %}

       hadoop_conf_dir={{hadoop_conf_dir}}
-
-  # Configuration for YARN (MR2)
-  # ------------------------------------------------------------------------
   [[yarn_clusters]]
-
     [[[default]]]
       resourcemanager_host={{resourcemanager_host1}}
       resourcemanager_port={{resourcemanager_port}}
@@ -374,10 +308,6 @@
       spark_history_server_url={{spark_history_server_url}}
     {% endif %}

-###########################################################################
-# Settings to configure Beeswax with Hive
-###########################################################################
-
 [beeswax]
   hive_server_host={{hive_server_host}}
   hive_server_port={{hive_server_port}}
@@ -391,17 +321,8 @@

   [[ssl]]

-
-###########################################################################
-# Settings to configure Metastore
-###########################################################################
-
 [metastore]

-###########################################################################
-# Settings to configure Impala
-###########################################################################
-
 [impala]
   server_host={{impala_host}}
   {% if security_enabled %}
@@ -419,11 +340,6 @@

   [[ssl]]

-
-###########################################################################
-# Settings to configure the Spark application.
-###########################################################################
-
 [spark]
   livy_server_url={{livy_server_url}}
   {% if security_enabled %}
@@ -441,100 +357,34 @@
   {% endif %}
   use_sasl=true

-###########################################################################
-# Settings to configure the Oozie app
-###########################################################################
-
 [oozie]

-###########################################################################
-# Settings to configure the Filebrowser app
-###########################################################################
-
 [filebrowser]

-###########################################################################
-# Settings to configure Pig
-###########################################################################
-
 [pig]

-
-###########################################################################
-# Settings to configure Sqoop2
-###########################################################################
-
 [sqoop]

-
-###########################################################################
-# Settings to configure Proxy
-###########################################################################
-
 [proxy]

-
-
-###########################################################################
-# Settings to configure HBase Browser
-###########################################################################
-
 [hbase]

   hbase_clusters={{hbase_cluster}}
   hbase_conf_dir=/etc/hbase/conf

-
-
-###########################################################################
-# Settings to configure Solr Search
-###########################################################################
-
 [search]

-
-###########################################################################
-# Settings to configure Solr API lib
-###########################################################################
-
 [libsolr]

-
-
-###########################################################################
-# Settings to configure the Data Import Wizard
-###########################################################################
-
 [indexer]

-
-
-###########################################################################
-# Settings to configure Job Designer
-###########################################################################
-
 [jobsub]

-
-###########################################################################
-# Settings to configure Job Browser.
-###########################################################################
-
 [jobbrowser]
   [[query_store]]

-
-###########################################################################
-# Settings to configure Sentry / Security App.
-###########################################################################
-
 [security]

-
-###########################################################################
-# Settings to configure the Zookeeper application.
-###########################################################################
-
 [zookeeper]

   [[clusters]]
@@ -545,34 +395,16 @@
       principal_name={{zk_principal}}
       {% endif %}

-
-###########################################################################
-# Settings for the User Admin application
-###########################################################################
-
 [useradmin]

   [[password_policy]]

-
-###########################################################################
-# Settings to configure liboozie
-###########################################################################
-
 [liboozie]

-
-###########################################################################
-# Settings for the AWS lib
-###########################################################################
-
 [aws]

   [[aws_accounts]]

-###########################################################################
-# Settings for the Azure lib
-###########################################################################
 [azure]
   [[azure_accounts]]
     [[[default]]]
@@ -583,68 +415,28 @@
   [[abfs_clusters]]
     [[[default]]]

-###########################################################################
-# Settings for the Sentry lib
-###########################################################################
-
 [libsentry]

-
-
-###########################################################################
-# Settings to configure the ZooKeeper Lib
-###########################################################################
-
 [libzookeeper]

-
-###########################################################################
-# Settings for the RDBMS application
-###########################################################################
-
 [librdbms]
   [[databases]]

-
-###########################################################################
-# Settings to configure SAML
-###########################################################################
-
 [libsaml]

-###########################################################################
-# Settings to configure OAuth
-###########################################################################
-
 [liboauth]

-
-###########################################################################
-# Settings to configure Kafka
-###########################################################################
-
 [kafka]
-
   [[kafka]]

-
-###########################################################################
-# Settings to configure Metadata
-###########################################################################
-
 [metadata]
-
   [[manager]]

   [[optimizer]]

-
   [[catalog]]
-
-
   # Deprecated by [[catalog]]
   [[navigator]]
-
   [[prometheus]]

     </value>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/configuration/hue-desktop-log-conf.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/configuration/hue-desktop-log-conf.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/configuration/hue-desktop-log-conf.xml
--- a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/configuration/hue-desktop-log-conf.xml	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/configuration/hue-desktop-log-conf.xml	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -72,6 +72,36 @@
 handlers=errorlog
 qualname=boto

+[logger_hive_server2_lib]
+level=DEBUG
+handlers=logfile,errorlog
+qualname=hive_server2_lib
+propagate=0
+
+[logger_beeswax]
+level=DEBUG
+handlers=logfile,errorlog
+qualname=beeswax
+propagate=0
+
+[logger_desktop_lib_thrift_util]
+level=DEBUG
+handlers=logfile,errorlog
+qualname=desktop.lib.thrift_util
+propagate=0
+
+[logger_desktop_lib_thrift_sasl]
+level=DEBUG
+handlers=logfile,errorlog
+qualname=desktop.lib.thrift_sasl
+propagate=0
+
+[logger_thrift_util]
+level=DEBUG
+handlers=logfile,errorlog
+qualname=thrift_util
+propagate=0
+
 # The logrotation limit is set at 5MB per file for a total of 5 copies.
 # I.e. 25MB for each set of logs.
 [handler_accesslog]
@@ -99,7 +129,7 @@
 datefmt=%d/%b/%Y %H:%M:%S %z

 [loggers]
-keys=root,access,django_auth_ldap,kazoo_client,djangosaml2,django_db,boto
+keys=root,access,django_auth_ldap,kazoo_client,djangosaml2,django_db,boto,hive_server2_lib,beeswax,desktop_lib_thrift_util,desktop_lib_thrift_sasl,thrift_util

 [handlers]
 keys=logfile,accesslog,errorlog
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/configuration/hue-env.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/configuration/hue-env.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/configuration/hue-env.xml
--- a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/configuration/hue-env.xml	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/configuration/hue-env.xml	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -61,33 +61,33 @@
             <type>directory</type>
         </value-attributes>
         <on-ambari-upgrade add="true"/>
-    </property>
+    </property>

-   <property>
-    <name>hue_pid_dir</name>
-    <value>/var/run/hue</value>
-    <display-name>Hue Pid Dir</display-name>
-    <description>Dir containing process ID file</description>
-    <value-attributes>
-      <type>directory</type>
-      <overridable>false</overridable>
-      <editable-only-at-install>true</editable-only-at-install>
-    </value-attributes>
-    <on-ambari-upgrade add="true"/>
-  </property>
+    <property>
+        <name>hue_pid_dir</name>
+        <value>/var/run/hue</value>
+        <display-name>Hue Pid Dir</display-name>
+        <description>Dir containing process ID file</description>
+        <value-attributes>
+            <type>directory</type>
+            <overridable>false</overridable>
+            <editable-only-at-install>true</editable-only-at-install>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>

- <property>
-    <name>http_host</name>
-    <value>{{http_host}}</value>
-    <display-name>HTTP Host</display-name>
-    <description>Webserver listens on this address</description>
-  </property>
+    <property>
+        <name>http_host</name>
+        <value>{{http_host}}</value>
+        <display-name>HTTP Host</display-name>
+        <description>Webserver listens on this address</description>
+    </property>

-  <property>
-    <name>http_port</name>
-    <value>8888</value>
-    <display-name>HTTP Post</display-name>
-    <description>Webserver listens on this port</description>
-  </property>
-
+    <property>
+        <name>http_port</name>
+        <value>8888</value>
+        <display-name>HTTP Post</display-name>
+        <description>Webserver listens on this port</description>
+    </property>
+
 </configuration>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/metainfo.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/metainfo.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/metainfo.xml
--- a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/metainfo.xml	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/metainfo.xml	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -16,95 +16,107 @@
    limitations under the License.
 -->
 <metainfo>
-  <schemaVersion>2.0</schemaVersion>
-  <services>
-    <service>
-      <name>HUE</name>
-      <displayName>Hue</displayName>
-      <comment>【增强】基于 Web 的大数据交互与管理界面，用于统一访问和管理 Hive、HDFS 等服务，使用前需安装并部署相应的大数据组件及认证服务</comment>
-      <version>4.11.0</version>
-      <selection>TECH_PREVIEW</selection>
-      <components>
-        <component>
-          <name>HUE_SERVER</name>
-          <displayName>Hue Server</displayName>
-          <category>MASTER</category>
-          <cardinality>1+</cardinality>
-          <versionAdvertised>true</versionAdvertised>
-          <commandScript>
-            <script>scripts/hue_server.py</script>
-            <scriptType>PYTHON</scriptType>
-            <timeout>1200</timeout>
-          </commandScript>
-          <customCommands>
-            <customCommand>
-              <name>UserSync</name>
-              <background>true</background>
-              <commandScript>
-                <script>scripts/hue_server.py</script>
-                <scriptType>PYTHON</scriptType>
-              </commandScript>
-            </customCommand>
-            <customCommand>
-              <name>MetastoreSync</name>
-              <background>true</background>
-              <commandScript>
-                <script>scripts/hue_server.py</script>
-                <scriptType>PYTHON</scriptType>
-              </commandScript>
-            </customCommand>
-          </customCommands>
-        </component>
-      </components>
+    <schemaVersion>2.0</schemaVersion>
+    <services>
+        <service>
+            <name>HUE</name>
+            <displayName>Hue</displayName>
+            <comment>【增强】基于 Web 的大数据交互与管理界面，用于统一访问和管理 Hive、HDFS
+                等服务，使用前需安装并部署相应的大数据组件及认证服务
+            </comment>
+            <version>4.11.0</version>
+            <selection>TECH_PREVIEW</selection>
+            <components>
+                <component>
+                    <name>HUE_SERVER</name>
+                    <displayName>Hue Server</displayName>
+                    <category>MASTER</category>
+                    <cardinality>1+</cardinality>
+                    <versionAdvertised>true</versionAdvertised>
+                    <commandScript>
+                        <script>scripts/hue_server.py</script>
+                        <scriptType>PYTHON</scriptType>
+                        <timeout>1200</timeout>
+                    </commandScript>
+                    <customCommands>
+                        <customCommand>
+                            <name>UserSync</name>
+                            <background>true</background>
+                            <commandScript>
+                                <script>scripts/hue_server.py</script>
+                                <scriptType>PYTHON</scriptType>
+                            </commandScript>
+                        </customCommand>
+                        <customCommand>
+                            <name>MetastoreSync</name>
+                            <background>true</background>
+                            <commandScript>
+                                <script>scripts/hue_server.py</script>
+                                <scriptType>PYTHON</scriptType>
+                            </commandScript>
+                        </customCommand>
+                    </customCommands>
+                </component>
+            </components>

-      <osSpecifics>
-        <osSpecific>
-          <osFamily>redhat9,redhat8,redhat7,amazonlinux2,redhat6,suse11,suse12,openeuler20,openeuler21,openeuler22,openeuler23,openeuler24,openeuler25,kylin10,kylin20,kylin30,uos10,uos20,anolis7,anolis8,anolis23</osFamily>
-          <packages>
-            <package>
-              <name>hue_${stack_version}</name>
-            </package>
-          </packages>
-        </osSpecific>
-        <osSpecific>
-          <osFamily>debian7,debian9,ubuntu12,ubuntu14,ubuntu16,ubuntu18,ubuntu20,ubuntu22,ubuntu24</osFamily>
-          <packages>
-            <package>
-              <name>hue-${stack_version}</name>
-            </package>
-          </packages>
-        </osSpecific>
-      </osSpecifics>
-
-      <requiredServices>
-        <service>HDFS</service>
-        <service>HTTPFS</service>
-        <service>HIVE</service>
-      </requiredServices>
-
-      <configuration-dependencies>
-        <config-type>hue-env</config-type>
-        <config-type>hue-desktop-ini</config-type>
-        <config-type>hue-desktop-log-conf</config-type>
-        <config-type>hue-desktop-log4j-properties</config-type>
-        <config-type>hadoop-env</config-type>
-        <config-type>hdfs-site</config-type>
-        <config-type>core-site</config-type>
-        <config-type>yarn-env</config-type>
-        <config-type>yarn-site</config-type>
-        <config-type>hive-site</config-type>
-        <config-type>zoo.cfg</config-type>
-        <config-type>httpfs-site</config-type>
-      </configuration-dependencies>
-      <restartRequiredAfterChange>true</restartRequiredAfterChange>
-
+            <osSpecifics>
+                <osSpecific>
+                    <osFamily>
+                        redhat9,redhat8,redhat7,amazonlinux2,redhat6,suse11,suse12,openeuler20,openeuler21,openeuler22,openeuler23,openeuler24,openeuler25,kylin10,kylin20,kylin30,uos10,uos20,anolis7,anolis8,anolis23
+                    </osFamily>
+                    <packages>
+                        <package>
+                            <name>hue_${stack_version}</name>
+                        </package>
+                    </packages>
+                </osSpecific>
+                <osSpecific>
+                    <osFamily>debian7,debian9,ubuntu12,ubuntu14,ubuntu16,ubuntu18,ubuntu20,ubuntu22,ubuntu24</osFamily>
+                    <packages>
+                        <package>
+                            <name>hue-${stack_version}</name>
+                        </package>
+                    </packages>
+                </osSpecific>
+            </osSpecifics>
+
+            <requiredServices>
+                <service>HDFS</service>
+                <service>HTTPFS</service>
+                <service>HIVE</service>
+            </requiredServices>
+
+            <configuration-dependencies>
+                <config-type>hue-env</config-type>
+                <config-type>hue-desktop-ini</config-type>
+                <config-type>hue-desktop-log-conf</config-type>
+                <config-type>hue-desktop-log4j-properties</config-type>
+                <config-type>hadoop-env</config-type>
+                <config-type>hdfs-site</config-type>
+                <config-type>core-site</config-type>
+                <config-type>yarn-env</config-type>
+                <config-type>yarn-site</config-type>
+                <config-type>hive-site</config-type>
+                <config-type>zoo.cfg</config-type>
+                <config-type>httpfs-site</config-type>
+            </configuration-dependencies>
+            <restartRequiredAfterChange>true</restartRequiredAfterChange>
+

-      <quickLinksConfigurations>
-        <quickLinksConfiguration>
-          <fileName>quicklinks.json</fileName>
-          <default>true</default>
-        </quickLinksConfiguration>
-      </quickLinksConfigurations>
-    </service>
-  </services>
+            <quickLinksConfigurations>
+                <quickLinksConfiguration>
+                    <fileName>quicklinks.json</fileName>
+                    <default>true</default>
+                </quickLinksConfiguration>
+            </quickLinksConfigurations>
+
+            <themes>
+                <theme>
+                    <fileName>themes.json</fileName>
+                    <default>true</default>
+                </theme>
+            </themes>
+
+        </service>
+    </services>
 </metainfo>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/package/scripts/hue.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/package/scripts/hue.py b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/package/scripts/hue.py
--- a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/package/scripts/hue.py	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/package/scripts/hue.py	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -33,6 +33,13 @@
               mode=0o775
               )

+    Directory('/home/hue',
+              owner=params.hue_user,
+              create_parents=True,
+              group=params.hue_group,
+              mode=0o775
+              )
+
     Directory(params.hue_pid_dir,
               owner=params.hue_user,
               create_parents=True,
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/package/scripts/hue_server.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/package/scripts/hue_server.py b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/package/scripts/hue_server.py
--- a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/package/scripts/hue_server.py	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/package/scripts/hue_server.py	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -1,4 +1,4 @@
-#!/usr/bin/env python3
+#!/usr/bin/env ambari-python-wrap
 """
 Licensed to the Apache Software Foundation (ASF) under one
 or more contributor license agreements.  See the NOTICE file
@@ -43,7 +43,7 @@
   def configure(self, env):
     import params
     env.set_params(params)
-    Execute('python /usr/lib/bigtop-select/distro-select set hue 3.2.0')
+    Execute('ambari-python-wrap /usr/lib/bigtop-select/distro-select set hue 3.2.0')
     hue(name = 'hue_server')

   def start(self, env):
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/package/scripts/hue_service.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/package/scripts/hue_service.py b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/package/scripts/hue_service.py
--- a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/package/scripts/hue_service.py	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/package/scripts/hue_service.py	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -1,4 +1,4 @@
-#!/usr/bin/env python3
+#!/usr/bin/env ambari-python-wrap
 """
 Licensed to the Apache Software Foundation (ASF) under one
 or more contributor license agreements.  See the NOTICE file
@@ -32,7 +32,7 @@
 #                       'LD_LIBRARY_PATH': '$LD_LIBRARY_PATH:/usr/hdp/current/hue/lib-native',
                       }
     if action == 'start':
-      Execute("usermod -g hue hadoop",
+      Execute("usermod -g hadoop hue",
           user="root"
         )
       # Kerberos: kinit before starting Hue (Ambari-style, no pwd/ccache handling)
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/themes/themes.json
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/themes/themes.json b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/themes/themes.json
new file mode 100644
--- /dev/null	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/HUE/themes/themes.json	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -0,0 +1,600 @@
+{
+  "name": "default",
+  "description": "Default theme for Hue service",
+  "configuration": {
+    "layouts": [
+      {
+        "name": "default",
+        "tabs": [
+          {
+            "name": "hue_databases_settings",
+            "display-name": "Hue Databases",
+            "layout": {
+              "tab-columns": "2",
+              "tab-rows": "6",
+              "sections": [
+                {
+                  "name": "section-hue-metastore",
+                  "display-name": "Hue Metastore",
+                  "row-index": "0",
+                  "column-index": "0",
+                  "row-span": "1",
+                  "column-span": "2",
+                  "section-columns": "2",
+                  "section-rows": "1",
+                  "subsections": [
+                    {
+                      "name": "subsection-hue-ms-row1-col1",
+                      "row-index": "0",
+                      "column-index": "0",
+                      "row-span": "1",
+                      "column-span": "1"
+                    },
+                    {
+                      "name": "subsection-hue-ms-row1-col2",
+                      "row-index": "0",
+                      "column-index": "1",
+                      "row-span": "1",
+                      "column-span": "1"
+                    }
+                  ]
+                },
+                {
+                  "name": "section-hue-rdbms",
+                  "display-name": "Hue RDBMS Apps",
+                  "row-index": "1",
+                  "column-index": "0",
+                  "row-span": "4",
+                  "column-span": "2",
+                  "section-columns": "2",
+                  "section-rows": "4",
+                  "subsections": [
+                    {
+                      "name": "subsection-hue-db-row1-col1",
+                      "display-name": "SQLite Configs",
+                      "row-index": "0",
+                      "column-index": "0",
+                      "row-span": "1",
+                      "column-span": "1"
+                    },
+                    {
+                      "name": "subsection-hue-db-row1-col2",
+                      "row-index": "0",
+                      "column-index": "1",
+                      "row-span": "1",
+                      "column-span": "1"
+                    },
+                    {
+                      "name": "subsection-hue-db-row2-col1",
+                      "display-name": "MySQL Configs",
+                      "row-index": "1",
+                      "column-index": "0",
+                      "row-span": "1",
+                      "column-span": "1"
+                    },
+                    {
+                      "name": "subsection-hue-db-row2-col2",
+                      "row-index": "1",
+                      "column-index": "1",
+                      "row-span": "1",
+                      "column-span": "1"
+                    },
+                    {
+                      "name": "subsection-hue-db-row3-col1",
+                      "display-name": "Oracle Configs",
+                      "row-index": "2",
+                      "column-index": "0",
+                      "row-span": "1",
+                      "column-span": "1"
+                    },
+                    {
+                      "name": "subsection-hue-db-row3-col2",
+                      "row-index": "2",
+                      "column-index": "1",
+                      "row-span": "1",
+                      "column-span": "1"
+                    },
+                    {
+                      "name": "subsection-hue-db-row4-col1",
+                      "display-name": "PostgreSQL Configs",
+                      "row-index": "3",
+                      "column-index": "0",
+                      "row-span": "1",
+                      "column-span": "1"
+                    },
+                    {
+                      "name": "subsection-hue-db-row4-col2",
+                      "row-index": "3",
+                      "column-index": "1",
+                      "row-span": "1",
+                      "column-span": "1"
+                    }
+                  ]
+                }
+              ]
+            }
+          }
+        ]
+      }
+    ],
+    "placement": {
+      "configuration-layout": "default",
+      "configs": [
+        {
+          "config": "hue-desktop-ini/DB_FLAVOR",
+          "subsection-name": "subsection-hue-ms-row1-col1"
+        },
+        {
+          "config": "hue-desktop-ini/db_name",
+          "subsection-name": "subsection-hue-ms-row1-col1"
+        },
+        {
+          "config": "hue-desktop-ini/db_user",
+          "subsection-name": "subsection-hue-ms-row1-col1",
+          "depends-on": [
+            {
+              "configs": [
+                "hue-desktop-ini/DB_FLAVOR"
+              ],
+              "if": "${hue-desktop-ini/DB_FLAVOR} === sqlite3",
+              "then": {
+                "property_value_attributes": {
+                  "visible": false
+                }
+              },
+              "else": {
+                "property_value_attributes": {
+                  "visible": true
+                }
+              }
+            }
+          ]
+        },
+        {
+          "config": "hue-desktop-ini/db_password",
+          "subsection-name": "subsection-hue-ms-row1-col1",
+          "depends-on": [
+            {
+              "configs": [
+                "hue-desktop-ini/DB_FLAVOR"
+              ],
+              "if": "${hue-desktop-ini/DB_FLAVOR} === sqlite3",
+              "then": {
+                "property_value_attributes": {
+                  "visible": false
+                }
+              },
+              "else": {
+                "property_value_attributes": {
+                  "visible": true
+                }
+              }
+            }
+          ]
+        },
+        {
+          "config": "hue-desktop-ini/db_host",
+          "subsection-name": "subsection-hue-ms-row1-col2",
+          "depends-on": [
+            {
+              "configs": [
+                "hue-desktop-ini/DB_FLAVOR"
+              ],
+              "if": "${hue-desktop-ini/DB_FLAVOR} === sqlite3",
+              "then": {
+                "property_value_attributes": {
+                  "visible": false
+                }
+              },
+              "else": {
+                "property_value_attributes": {
+                  "visible": true
+                }
+              }
+            }
+          ]
+        },
+        {
+          "config": "hue-desktop-ini/db_port",
+          "subsection-name": "subsection-hue-ms-row1-col2",
+          "depends-on": [
+            {
+              "configs": [
+                "hue-desktop-ini/DB_FLAVOR"
+              ],
+              "if": "${hue-desktop-ini/DB_FLAVOR} === sqlite3",
+              "then": {
+                "property_value_attributes": {
+                  "visible": false
+                }
+              },
+              "else": {
+                "property_value_attributes": {
+                  "visible": true
+                }
+              }
+            }
+          ]
+        },
+        {
+          "config": "hue-desktop-ini/db_password_script",
+          "subsection-name": "subsection-hue-ms-row1-col2",
+          "depends-on": [
+            {
+              "configs": [
+                "hue-desktop-ini/DB_FLAVOR"
+              ],
+              "if": "${hue-desktop-ini/DB_FLAVOR} === sqlite3",
+              "then": {
+                "property_value_attributes": {
+                  "visible": false
+                }
+              },
+              "else": {
+                "property_value_attributes": {
+                  "visible": true
+                }
+              }
+            }
+          ]
+        },
+        {
+          "config": "hue-desktop-ini/db_options",
+          "subsection-name": "subsection-hue-ms-row1-col2"
+        },
+        {
+          "config": "hue-rdbms-site/postgresql_name",
+          "subsection-name": "subsection-hue-db-row4-col2",
+          "depends-on": [
+            {
+              "configs": [
+                "hue-rdbms-site/postgresql_engine"
+              ],
+              "if": "${hue-rdbms-site/postgresql_engine}",
+              "then": {
+                "property_value_attributes": {
+                  "visible": true
+                }
+              },
+              "else": {
+                "property_value_attributes": {
+                  "visible": false
+                }
+              }
+            }
+          ]
+        },
+        {
+          "config": "hue-env/hue-hdfs-module-enabled",
+          "subsection-name": "section-hue-module-row1-col1",
+          "depends-on": [
+            {
+              "resource": "service",
+              "if": "HDFS",
+              "then": {
+                "property_value_attributes": {
+                  "visible": true
+                }
+              },
+              "else": {
+                "property_value_attributes": {
+                  "visible": false
+                }
+              }
+            }
+          ]
+        },
+        {
+          "config": "hue-env/hue-yarn-module-enabled",
+          "subsection-name": "section-hue-module-row1-col1",
+          "depends-on": [
+            {
+              "resource": "service",
+              "if": "YARN",
+              "then": {
+                "property_value_attributes": {
+                  "visible": true
+                }
+              },
+              "else": {
+                "property_value_attributes": {
+                  "visible": false
+                }
+              }
+            }
+          ]
+        },
+        {
+          "config": "hue-env/hue-hive-module-enabled",
+          "subsection-name": "section-hue-module-row1-col1",
+          "depends-on": [
+            {
+              "resource": "service",
+              "if": "HIVE",
+              "then": {
+                "property_value_attributes": {
+                  "visible": true
+                }
+              },
+              "else": {
+                "property_value_attributes": {
+                  "visible": false
+                }
+              }
+            }
+          ]
+        },
+        {
+          "config": "hue-env/hue-hbase-module-enabled",
+          "subsection-name": "section-hue-module-row1-col1",
+          "depends-on": [
+            {
+              "resource": "service",
+              "if": "HBASE",
+              "then": {
+                "property_value_attributes": {
+                  "visible": true
+                }
+              },
+              "else": {
+                "property_value_attributes": {
+                  "visible": false
+                }
+              }
+            }
+          ]
+        },
+        {
+          "config": "hue-env/hue-zookeeper-module-enabled",
+          "subsection-name": "section-hue-module-row1-col2",
+          "depends-on": [
+            {
+              "resource": "service",
+              "if": "ZOOKEEPER",
+              "then": {
+                "property_value_attributes": {
+                  "visible": true
+                }
+              },
+              "else": {
+                "property_value_attributes": {
+                  "visible": false
+                }
+              }
+            }
+          ]
+        },
+        {
+          "config": "hue-env/hue-oozie-module-enabled",
+          "subsection-name": "section-hue-module-row1-col2",
+          "depends-on": [
+            {
+              "resource": "service",
+              "if": "OOZIE",
+              "then": {
+                "property_value_attributes": {
+                  "visible": true
+                }
+              },
+              "else": {
+                "property_value_attributes": {
+                  "visible": false
+                }
+              }
+            }
+          ]
+        },
+        {
+          "config": "hue-env/hue-notebook-module-enabled",
+          "subsection-name": "section-hue-module-row1-col2"
+        },
+        {
+          "config": "hue-env/hue-rdbms-module-enabled",
+          "subsection-name": "section-hue-module-row1-col2"
+        },
+        {
+          "config": "hue-env/hue-solr-module-enabled",
+          "subsection-name": "section-hue-module-row1-col3",
+          "depends-on": [
+            {
+              "resource": "service",
+              "if": "SOLR",
+              "then": {
+                "property_value_attributes": {
+                  "visible": true
+                }
+              },
+              "else": {
+                "property_value_attributes": {
+                  "visible": false
+                }
+              }
+            }
+          ]
+        },
+        {
+          "config": "hue-env/hue-pig-module-enabled",
+          "subsection-name": "section-hue-module-row1-col3",
+          "depends-on": [
+            {
+              "resource": "service",
+              "if": "PIG",
+              "then": {
+                "property_value_attributes": {
+                  "visible": true
+                }
+              },
+              "else": {
+                "property_value_attributes": {
+                  "visible": false
+                }
+              }
+            }
+          ]
+        },
+        {
+          "config": "hue-env/hue-spark-module-enabled",
+          "subsection-name": "section-hue-module-row1-col3",
+          "depends-on": [
+            {
+              "resource": "service",
+              "if": "SPARK",
+              "then": {
+                "property_value_attributes": {
+                  "visible": true
+                }
+              },
+              "else": {
+                "property_value_attributes": {
+                  "visible": false
+                }
+              }
+            }
+          ]
+        },
+        {
+          "config": "hue-env/hue-impala-module-enabled",
+          "subsection-name": "section-hue-module-row1-col3",
+          "depends-on": [
+            {
+              "resource": "service",
+              "if": "IMPALA",
+              "then": {
+                "property_value_attributes": {
+                  "visible": true
+                }
+              },
+              "else": {
+                "property_value_attributes": {
+                  "visible": false
+                }
+              }
+            }
+          ]
+        }
+      ]
+    },
+    "widgets": [
+      {
+        "config": "hue-desktop-ini/DB_FLAVOR",
+        "widget": {
+          "type": "combo"
+        }
+      },
+      {
+        "config": "hue-desktop-ini/db_host",
+        "widget": {
+          "type": "text-field"
+        }
+      },
+      {
+        "config": "hue-desktop-ini/db_port",
+        "widget": {
+          "type": "text-field"
+        }
+      },
+      {
+        "config": "hue-desktop-ini/db_name",
+        "widget": {
+          "type": "text-field"
+        }
+      },
+      {
+        "config": "hue-desktop-ini/db_user",
+        "widget": {
+          "type": "text-field"
+        }
+      },
+      {
+        "config": "hue-desktop-ini/db_password",
+        "widget": {
+          "type": "password"
+        }
+      },
+      {
+        "config": "hue-desktop-ini/db_password_script",
+        "widget": {
+          "type": "text-field"
+        }
+      },
+      {
+        "config": "hue-desktop-ini/db_options",
+        "widget": {
+          "type": "text-field"
+        }
+      },
+      {
+        "config": "hue-env/hue-hdfs-module-enabled",
+        "widget": {
+          "type": "toggle"
+        }
+      },
+      {
+        "config": "hue-env/hue-yarn-module-enabled",
+        "widget": {
+          "type": "toggle"
+        }
+      },
+      {
+        "config": "hue-env/hue-hive-module-enabled",
+        "widget": {
+          "type": "toggle"
+        }
+      },
+      {
+        "config": "hue-env/hue-hbase-module-enabled",
+        "widget": {
+          "type": "toggle"
+        }
+      },
+      {
+        "config": "hue-env/hue-zookeeper-module-enabled",
+        "widget": {
+          "type": "toggle"
+        }
+      },
+      {
+        "config": "hue-env/hue-oozie-module-enabled",
+        "widget": {
+          "type": "toggle"
+        }
+      },
+      {
+        "config": "hue-env/hue-notebook-module-enabled",
+        "widget": {
+          "type": "toggle"
+        }
+      },
+      {
+        "config": "hue-env/hue-rdbms-module-enabled",
+        "widget": {
+          "type": "toggle"
+        }
+      },
+      {
+        "config": "hue-env/hue-solr-module-enabled",
+        "widget": {
+          "type": "toggle"
+        }
+      },
+      {
+        "config": "hue-env/hue-pig-module-enabled",
+        "widget": {
+          "type": "toggle"
+        }
+      },
+      {
+        "config": "hue-env/hue-spark-module-enabled",
+        "widget": {
+          "type": "toggle"
+        }
+      },
+      {
+        "config": "hue-env/hue-impala-module-enabled",
+        "widget": {
+          "type": "toggle"
+        }
+      }
+    ]
+  }
+}
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/configuration/ranger-admin-site.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/configuration/ranger-admin-site.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/configuration/ranger-admin-site.xml
--- a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/configuration/ranger-admin-site.xml	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/configuration/ranger-admin-site.xml	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -79,8 +79,16 @@
     </property>
     <property>
         <name>ranger.https.attrib.keystore.file</name>
-        <value>/etc/security/serverKeys/ranger-admin-keystore.jks</value>
-        <description>Ranger admin keystore (specify full path)</description>
+        <value>/etc/security/serverKeys/ranger-admin-server.jks</value>
+        <description>
+            【TTBigdata 定制】Ranger Admin 自身启用 HTTPS 服务时使用的 keystore 文件（Server 端证书）。
+            该 keystore 中必须包含私钥和服务端证书，用于浏览器或其他组件
+            通过 HTTPS 访问 Ranger Admin Web UI。
+            <br/>
+            <br/>
+            注意：此配置仅用于 Ranger Admin 作为 HTTPS 服务端的身份认证，
+            不用于 Ranger 访问 Knox、Solr、Atlas 等外部 HTTPS 服务。
+        </description>
         <on-ambari-upgrade add="false"/>
     </property>
     <property>
@@ -560,14 +568,77 @@
         <description/>
         <value-attributes>
             <empty-value-valid>true</empty-value-valid>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>
+    <property>
+        <name>ranger.truststore.enabled</name>
+        <value>false</value>
+        <display-name>Enable Ranger Outbound Truststore</display-name>
+        <description>
+            【TTBigdata 定制】是否为 Ranger Admin 启用出站 HTTPS 信任库（truststore）。
+            开启后，将在 Ranger Admin JVM 启动参数中注入 javax.net.ssl.trustStore*，
+            用于访问 Knox/Solr/Atlas 等 HTTPS 服务并校验证书链。
+            <br/>
+            <br/>
+            说明：
+            - 若外部服务使用自签证书/内网 CA 且未导入系统信任库，建议开启；
+            - 若开启knox，则设置true / false 不生效
+            - 若已统一使用系统 CA（cacerts/OS CA），可关闭。
+        </description>
+        <value-attributes>
+            <type>boolean</type>
+            <overridable>true</overridable>
         </value-attributes>
         <on-ambari-upgrade add="true"/>
     </property>
     <property>
         <name>ranger.truststore.file</name>
-        <value>/etc/ranger/admin/conf/ranger-admin-keystore.jks</value>
+        <value>/etc/ranger/admin/conf/ranger-admin-truststore.jks</value>
         <display-name>ranger.truststore.file</display-name>
-        <description>Ranger trust-store file-path</description>
+        <description>
+            【TTBigdata 定制】Ranger Admin 作为客户端访问外部 HTTPS 服务时使用的 truststore 文件。
+            <br/>
+            <br/>
+            该 truststore 用于存放被信任的 CA 证书或服务端证书，
+            例如 Knox、Solr、Atlas 等组件的 HTTPS 证书，
+            以支持 Ranger 在策略同步、资源查询等场景下
+            通过 HTTPS 与这些服务安全通信。
+            <br/>
+            <br/>
+            注意：该 truststore 不应包含私钥，
+            也不建议与 ranger.https.attrib.keystore.file 共用。
+            若配置路径不存在或 truststore 为空，
+            可能导致 HTTPS 调用失败并出现
+            “trustAnchors parameter must be non-empty” 错误。
+        </description>
+        <on-ambari-upgrade add="true"/>
+    </property>
+    <property>
+        <name>ranger.truststore.type</name>
+        <value>JKS</value>
+        <display-name>Ranger Truststore Type</display-name>
+        <description>
+            【TTBigdata 定制】Ranger Admin 出站 HTTPS 信任库格式类型。
+            常见取值：
+            - JKS：Java 默认格式（常用）
+            - PKCS12：跨语言兼容更好（.p12/.pfx）
+        </description>
+        <value-attributes>
+            <type>value-list</type>
+            <overridable>true</overridable>
+            <entries>
+                <entry>
+                    <value>JKS</value>
+                    <label>JKS</label>
+                </entry>
+                <entry>
+                    <value>PKCS12</value>
+                    <label>PKCS12</label>
+                </entry>
+            </entries>
+            <selection-cardinality>1</selection-cardinality>
+        </value-attributes>
         <on-ambari-upgrade add="true"/>
     </property>
     <property>
@@ -761,9 +832,38 @@
     </property>
     <property>
         <name>ranger.truststore.alias</name>
-        <value>trustStoreAlias</value>
-        <description></description>
-        <on-ambari-upgrade add="false"/>
+        <value>trustStoreCredentialAlias</value>
+        <display-name>Ranger Truststore Credential Alias</display-name>
+        <description>
+            【TTBigdata 定制】Ranger Admin 出站 HTTPS Truststore 的“凭据别名”（Credential Alias）。
+            <br/>
+            <br/>
+            当 Ranger Admin 需要通过 HTTPS 访问外部服务（如 Knox / Solr / Atlas 等）时，
+            通常需要为 JVM 指定 trustStore 及其密码（javax.net.ssl.trustStorePassword）。
+            为避免在配置文件或脚本中明文保存密码，可将 truststore 密码写入
+            Ranger Credential Provider（JCEKS），并在此处配置对应的 alias 名称。
+            <br/>
+            <br/>
+            读取逻辑示例：
+            <ul>
+                <li>credential provider：ranger.credential.provider.path（如 /etc/ranger/admin/rangeradmin.jceks）</li>
+                <li>alias：ranger.truststore.alias（本配置）</li>
+                <li>取到密码后，注入到 JAVA_OPTS：-Djavax.net.ssl.trustStorePassword=***</li>
+            </ul>
+            <br/>
+            注意：
+            <ul>
+                <li>该 alias 仅用于“truststore 密码”的安全存储，不是 JKS 内部证书条目的 alias。</li>
+                <li>若未配置或 JCEKS 中不存在该 alias，则可回退使用 ranger.truststore.password（明文）或默认值。</li>
+                <li>建议配合 ranger.truststore.enabled / ranger.truststore.file / ranger.truststore.type 一起使用。</li>
+            </ul>
+        </description>
+        <value-attributes>
+            <type>string</type>
+            <overridable>true</overridable>
+            <empty-value-valid>true</empty-value-valid>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
     </property>
     <property>
         <name>ranger.service.https.attrib.keystore.credential.alias</name>
@@ -810,7 +910,8 @@
     </property>
     <property>
         <name>ranger.audit.solr.bootstrap.enabled</name>
-        <description>Enable Ranger Audit Solr Bootstrap. Keep this config disable for Ambari based installation.</description>
+        <description>Enable Ranger Audit Solr Bootstrap. Keep this config disable for Ambari based installation.
+        </description>
         <value>false</value>
         <value-attributes>
             <overridable>false</overridable>
@@ -820,8 +921,11 @@
     </property>
     <property>
         <name>ranger.admin.cookie.name</name>
-        <description>RANGERADMINSESSIONID</description>
-        <value>false</value>
+        <description>
+            【TTBigdata 定制】Ranger Admin Web 会话 Cookie 的名称（浏览器端保存的 Session 标识）。
+            建议使用清晰且唯一的名字，避免与 Tomcat 默认的 JSESSIONID 或其它应用 Cookie 冲突。
+        </description>
+        <value>RANGERADMINSESSIONID</value>
         <on-ambari-upgrade add="false"/>
     </property>
     <property>
@@ -852,4 +956,83 @@
         <description>Enable Ranger Admin Portal Account Locking</description>
         <on-ambari-upgrade add="true"/>
     </property>
+
+    <property>
+        <name>ranger.resource.lookup.timeout.value.in.ms</name>
+        <value>60000</value>
+        <display-name>Ranger Resource Lookup Timeout (ms)</display-name>
+        <description>
+            【TTBigdata 定制】Ranger Admin 进行资源联想/下拉检索（lookupResource）时的超时时间（毫秒）。
+            典型现象：在 Ranger Web 页面输入数据库/表名时，慢慢输正常，输快了就出现：
+            - lookupResource(...) failed
+            - java.util.concurrent.TimeoutException
+            原因：快速输入会触发高频 lookup 请求，Ranger 需要通过 Hive JDBC（ZK serviceDiscovery）
+            去读取 /hiveserver2 namespace 并建立到 HiveServer2 的连接；当并发升高或 ZK/HS2 偶发抖动时，
+            请求排队时间 + 连接耗时 > 默认超时，就会超时失败。
+
+            推荐设置：
+            - 小集群/环境稳定：30000
+            - 网络/认证链路偶发慢（Kerberos + ZK）：60000
+            说明：该值越大，单次 lookup 容忍的等待时间越长，但也会让“真的卡住”的请求更晚返回。
+        </description>
+        <value-attributes>
+            <type>int</type>
+            <overridable>true</overridable>
+            <minimum>1000</minimum>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>
+
+    <property>
+        <name>ranger.validate.config.timeout.value.in.ms</name>
+        <value>60000</value>
+        <display-name>Ranger Validate Config Timeout (ms)</display-name>
+        <description>
+            【TTBigdata 定制】Ranger Admin 在创建/编辑 Service 时执行 “Test Connection / Validate”
+            的超时时间（毫秒）。
+            该校验同样依赖后端连通性（Kerberos/JDBC/ZooKeeper/服务端口等）。
+            若出现 Validate/Test Connection 偶发超时，可适当调大。
+
+            推荐设置：
+            - 默认建议：30000
+            - 环境抖动明显：60000
+        </description>
+        <value-attributes>
+            <type>int</type>
+            <overridable>true</overridable>
+            <minimum>1000</minimum>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>
+
+    <property>
+        <name>ranger.timed.executor.max.threadpool.size</name>
+        <value>50</value>
+        <display-name>TimedExecutor Max ThreadPool Size</display-name>
+        <description>
+            【TTBigdata 定制】Ranger Admin 内部 TimedExecutor 线程池最大线程数。
+            该线程池用于执行 lookup/validate 等带超时的后台任务。
+
+            典型现象：Ranger UI 输入较快时，请求并发激增，TimedExecutor 线程池过小会导致：
+            - 任务排队等待
+            - 等到超时时间到了还没轮到执行
+            - 最终表现为 lookupResource TimeoutException（“输快了就炸”）
+
+            推荐设置（按机器资源 HiveServer2 承载能力调整）：
+            - 小环境：30 ~ 50（推荐先 50）
+            - 中等环境：80 ~ 150
+            注意：
+            - 线程池越大，并发越高，对 HiveServer2/ZK 压力越大；
+            - 如果 HS2 本身较弱，盲目拉大可能造成 HS2 更慢，反而更容易超时。
+            建议做法：先把本项提高到 50，同时把 lookup timeout 调到 30000/60000，再观察超时是否消失。
+        </description>
+        <value-attributes>
+            <type>int</type>
+            <overridable>true</overridable>
+            <minimum>1</minimum>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>
+
+
 </configuration>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/metainfo.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/metainfo.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/metainfo.xml
--- a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/metainfo.xml	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/metainfo.xml	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -25,7 +25,9 @@
             <name>RANGER</name>
             <displayName>Ranger</displayName>
             <version>2.4.0</version>
-            <comment>【增强】集中式权限管理与安全策略服务，用于对集群组件进行统一的访问控制与审计，使用前需安装并部署数据库、Kerberos 等依赖组件</comment>
+            <comment>【增强】集中式权限管理与安全策略服务，用于对集群组件进行统一的访问控制与审计，使用前需安装并部署数据库、Kerberos
+                等依赖组件
+            </comment>
             <themes>
                 <theme>
                     <fileName>credentials.json</fileName>
@@ -65,6 +67,18 @@
                         <scriptType>PYTHON</scriptType>
                         <timeout>600</timeout>
                     </commandScript>
+                    <customCommands>
+                        <customCommand>
+                            <name>AddKnoxCert</name>
+                            <background>true</background>
+                            <commandScript>
+                                <script>scripts/ranger_admin.py</script>
+                                <scriptType>PYTHON</scriptType>
+                                <timeout>36000</timeout>
+                                <background>true</background>
+                            </commandScript>
+                        </customCommand>
+                    </customCommands>
                     <configuration-dependencies>
                         <config-type>admin-properties</config-type>
                         <config-type>admin-log4j</config-type>
@@ -155,10 +169,10 @@
                             <name>ranger_${stack_version}-tagsync</name>
                             <condition>should_install_ranger_tagsync</condition>
                         </package>
-<!--                        <package>-->
-<!--                            <name>ambari-infra-solr-client</name>-->
-<!--                            <condition>should_install_infra_solr_client</condition>-->
-<!--                        </package>-->
+                        <!--                        <package>-->
+                        <!--                            <name>ambari-infra-solr-client</name>-->
+                        <!--                            <condition>should_install_infra_solr_client</condition>-->
+                        <!--                        </package>-->
                     </packages>
                 </osSpecific>
                 <osSpecific>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/package/scripts/params.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/package/scripts/params.py b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/package/scripts/params.py
--- a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/package/scripts/params.py	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/package/scripts/params.py	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -19,6 +19,8 @@
 """

 import os
+
+from resource_management import Logger
 from resource_management.libraries.script import Script
 from resource_management.libraries.functions.version import format_stack_version
 from resource_management.libraries.functions.format import format
@@ -551,3 +553,138 @@
 if has_infra_solr:
     infra_solr_host = infra_solr_hosts[0]
 kinit_path_local = get_kinit_path(default("/configurations/kerberos-env/executable_search_paths", None))
+
+########################################################
+# Ttbigdata 修改
+# Ranger Admin 作为 ZooKeeper Client 读取 HS2 的 ZK 注册信息（Hive 策略资源联想 lookupResource）
+# 输出：
+#   zk_jaas_file
+#   zk_client_kerberos_principal
+#   zk_client_kerberos_keytab
+########################################################
+
+zk_jaas_file = None
+zk_client_kerberos_principal = None
+zk_client_kerberos_keytab = None
+
+if security_enabled and stack_supports_ranger_kerberos:
+    # 1) 优先读取 Ranger Admin 自定义 ZK Client 身份
+    raw_zk_principal = default('/configurations/ranger-admin-site/xasecure.audit.jaas.Client.option.principal', '')
+    raw_zk_keytab = default('/configurations/ranger-admin-site/xasecure.audit.jaas.Client.option.keyTab', '')
+    #
+    # raw_zk_principal = default('/configurations/hive-site/hive.metastore.kerberos.principal', '')
+    # raw_zk_keytab = default('/configurations/hive-site/hive.metastore.kerberos.keytab.file', '')
+
+    zk_client_kerberos_principal = raw_zk_principal.replace('_HOST', current_host.lower())
+    zk_client_kerberos_keytab = raw_zk_keytab
+    zk_jaas_file = format('{ranger_home}/conf/ranger_jaas/ranger_zk_jaas.conf')
+
+
+########################################################
+# TTBigdata 修改
+# Ranger Admin 出站 HTTPS Truststore（用于 Knox / Solr / Atlas 等 HTTPS 调用）
+# 供 ranger-admin-env.sh jinja2 模板读取：
+#   ranger_admin_truststore_enabled
+#   ranger_admin_truststore_file
+#   ranger_admin_truststore_password
+#   ranger_admin_truststore_type
+#
+# 数据来源（优先级）：
+#   1) ranger-admin-site.xml: ranger.truststore.enabled/file/password/type
+#   2) fallback：给出合理默认值（避免空 trustAnchors）
+#
+# 额外规则：
+#   - 如果 Ranger Knox 插件开启（ranger-knox-plugin-enabled=yes），则强制开启 truststore
+########################################################
+
+def _bool(v, default_value=False):
+    if v is None:
+        return default_value
+    s = str(v).strip().lower()
+    if s == '':
+        return default_value
+    return s in ('yes', 'true', '1', 'y')
+
+
+# -------------------------------------------------------
+# 0) Knox 插件开关（用于最后强制开启 truststore）
+# -------------------------------------------------------
+enable_ranger_knox_raw = default(
+    '/configurations/ranger-knox-plugin-properties/ranger-knox-plugin-enabled',
+    'No'
+)
+enable_ranger_knox = _bool(enable_ranger_knox_raw, default_value=False)
+Logger.info("TTBigdata: ranger-knox-plugin-enabled={0} -> enable_ranger_knox={1}".format(
+    enable_ranger_knox_raw, enable_ranger_knox
+))
+
+# -------------------------------------------------------
+# 1) enabled：常规读取 ranger.truststore.enabled（TLS 与 Kerberos 无强绑定）
+# -------------------------------------------------------
+raw_truststore_enabled = default('/configurations/ranger-admin-site/ranger.truststore.enabled', None)
+
+if raw_truststore_enabled is None or str(raw_truststore_enabled).strip() == '':
+    # 默认策略：你希望“knox plugin 必生效”，这里默认 True
+    ranger_admin_truststore_enabled = True
+    Logger.info("TTBigdata: ranger.truststore.enabled is empty -> default ranger_admin_truststore_enabled=True")
+else:
+    ranger_admin_truststore_enabled = _bool(raw_truststore_enabled, default_value=True)
+    Logger.info("TTBigdata: ranger.truststore.enabled={0} -> ranger_admin_truststore_enabled={1}".format(
+        raw_truststore_enabled, ranger_admin_truststore_enabled
+    ))
+
+# -------------------------------------------------------
+# 2) file
+# -------------------------------------------------------
+ranger_admin_truststore_file = default(
+    '/configurations/ranger-admin-site/ranger.truststore.file',
+    '/etc/ranger/admin/certs/ranger-admin-truststore.jks'
+)
+Logger.info("TTBigdata: ranger_admin_truststore_file={0}".format(ranger_admin_truststore_file))
+
+# -------------------------------------------------------
+# 3) password（注意不要打印明文）
+# -------------------------------------------------------
+ranger_admin_truststore_password = default(
+    '/configurations/ranger-admin-site/ranger.truststore.password',
+    'changeit'
+)
+Logger.info("TTBigdata: ranger_admin_truststore_password is {0}".format(
+    "SET" if ranger_admin_truststore_password else "EMPTY"
+))
+
+# -------------------------------------------------------
+# 4) type
+# -------------------------------------------------------
+ranger_admin_truststore_type = default(
+    '/configurations/ranger-admin-site/ranger.truststore.type',
+    'JKS'
+)
+ranger_admin_truststore_type = str(
+    ranger_admin_truststore_type).strip().upper() if ranger_admin_truststore_type else 'JKS'
+Logger.info("TTBigdata: ranger_admin_truststore_type={0}".format(ranger_admin_truststore_type))
+
+# -------------------------------------------------------
+# 5) Knox 插件开启时：强制开启 truststore
+# -------------------------------------------------------
+if enable_ranger_knox and not ranger_admin_truststore_enabled:
+    Logger.info("TTBigdata: Knox plugin enabled -> force ranger_admin_truststore_enabled=True (override)")
+if enable_ranger_knox:
+    ranger_admin_truststore_enabled = True
+
+# -------------------------------------------------------
+# 6) 兜底保护：避免注入空值导致 trustAnchors must be non-empty
+# -------------------------------------------------------
+if ranger_admin_truststore_enabled:
+    if not ranger_admin_truststore_file or not ranger_admin_truststore_password:
+        Logger.info("TTBigdata: truststore enabled but file/password empty -> disable to avoid trustAnchors error")
+        ranger_admin_truststore_enabled = False
+
+Logger.info("TTBigdata: final truststore: enabled={0}, file={1}, type={2}".format(
+    ranger_admin_truststore_enabled, ranger_admin_truststore_file, ranger_admin_truststore_type
+))
+
+
+knox_gateway_port = default('/configurations/gateway-site/gateway.port', '6543')
+knox_gateway_hosts = default('/clusterHostInfo/knox_gateway_hosts', [])
+knox_gateway_host = knox_gateway_hosts[0] if len(knox_gateway_hosts) > 0 else None
\ No newline at end of file
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/package/scripts/ranger_admin.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/package/scripts/ranger_admin.py b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/package/scripts/ranger_admin.py
--- a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/package/scripts/ranger_admin.py	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/package/scripts/ranger_admin.py	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -29,12 +29,14 @@
 from resource_management.core.logger import Logger
 from resource_management.core import shell
 from ranger_service import ranger_service
+
 from resource_management.libraries.functions import solr_cloud_util
 from ambari_commons.constants import UPGRADE_TYPE_NON_ROLLING, UPGRADE_TYPE_ROLLING
 import upgrade
 import os, errno
 import ambari_simplejson as json
 import setup_ranger_xml
+import tt_enhance_ranger


 class RangerAdmin(Script):
@@ -50,7 +52,7 @@
             not_if=format('ls {ranger_home}/install-backup.properties'),
             only_if=format('ls {ranger_home}/install.properties'),
             sudo=True
-            )
+        )

         # call config and setup db only in case of stack version < 2.6
         if not params.stack_supports_ranger_setup_db_on_start:
@@ -122,6 +124,7 @@
         if params.stack_supports_infra_client and params.audit_solr_enabled and params.is_solrCloud_enabled:
             # solr_cloud_util.setup_solr_client(params.config, custom_log4j=params.custom_log4j)
             setup_ranger_xml.setup_ranger_audit_solr()
+            setup_ranger_xml.setup_client_jaas()

         setup_ranger_xml.update_password_configs()
         ranger_service('ranger_admin')
@@ -277,6 +280,11 @@
         import status_params
         return [status_params.ranger_admin_pid_file]

+    def addknoxcert(self, env):
+        import params
+        env.set_params(params)
+        tt_enhance_ranger.import_knox_gateway_cert()
+

 if __name__ == "__main__":
     RangerAdmin().execute()
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/package/scripts/setup_ranger_xml.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/package/scripts/setup_ranger_xml.py b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/package/scripts/setup_ranger_xml.py
--- a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/package/scripts/setup_ranger_xml.py	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/package/scripts/setup_ranger_xml.py	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -39,7 +39,6 @@
 from resource_management.core.exceptions import ExecutionFailed


-
 # This file contains functions used for setup/configure of Ranger Admin and Ranger Usersync.
 # The design is to mimic what is done by the setup.sh script bundled by Ranger component currently.

@@ -699,6 +698,18 @@
                       )


+def setup_client_jaas():
+    import params
+
+    if params.security_enabled and params.stack_supports_ranger_kerberos:
+
+        if params.zk_jaas_file is not None:
+            File(format("{zk_jaas_file}"),
+                 content=Template("ranger_zk_jaas_conf.j2"),
+                 owner=params.unix_user
+                 )
+
+
 def setup_ranger_audit_solr():
     import params

@@ -822,7 +833,6 @@
         java64_home=params.java_home)


-
 def secure_znode(znode, jaasFile):
     import params
     solr_cloud_util.secure_znode(config=params.config, zookeeper_quorum=params.zookeeper_quorum,
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/package/scripts/tt_enhance_ranger.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/package/scripts/tt_enhance_ranger.py b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/package/scripts/tt_enhance_ranger.py
new file mode 100644
--- /dev/null	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/package/scripts/tt_enhance_ranger.py	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -0,0 +1,118 @@
+#!/usr/bin/env ambari-python-wrap
+"""
+版权所有 (c) JaneTTR 2025
+项目名称：ambari-env
+
+本文件属于付费部分代码，仅供个人学习和研究使用。
+
+禁止行为：
+1. 未经授权，不得将本文件或其编译后的代码用于任何商业用途；
+2. 禁止重新分发本文件或其修改版本；
+3. 禁止通过反编译、反向工程等手段试图绕过授权验证。
+
+商业授权：
+如需将本文件或其编译后的代码用于商业用途，必须获得版权所有者的书面授权。
+联系方式：
+邮箱：3832514048@qq.com
+
+责任声明：
+本文件按“现状”提供，不附带任何形式的担保，包括但不限于适销性、特定用途适用性或无侵权的担保。
+
+如有任何疑问，请联系版权所有者。
+
+"""
+
+from resource_management.core.logger import Logger
+from resource_management.core.exceptions import ExecutionFailed
+from resource_management.libraries.functions.format import format
+from resource_management.core.resources.system import Execute
+
+
+# ----------------------------------------------------------------------
+# [TTBigdata 定制修改]
+# Ranger Knox Service HTTPS 访问信任链补齐：
+# 当 Knox Admin API 使用自签/内网证书时，Ranger Admin 作为 HTTPS 客户端
+# 访问 knox.url（如 https://dev1:6543/gateway/admin/api/v1/topologies）会因为
+# JVM truststore 未信任该证书，触发 SSL 握手失败（常见表现：
+# - InvalidAlgorithmParameterException: the trustAnchors parameter must be non-empty
+# - PKIX path building failed / unable to find valid certification path）
+#
+# 规则：
+# - 若 enable_ranger_knox 关闭，则跳过
+# - 若 truststore 参数缺失（file/password/alias），则跳过（不阻断）
+# - 若 alias 已存在于 truststore，则跳过（幂等）
+# - 若证书生成/导入失败，记录日志但不抛异常（不阻断 Ranger 启动）
+#
+# 证书来源（优先级）：
+# - 1) params.knox_cert_file （如果你已通过 Ambari 下发证书到本机）
+# - 2) 通过 openssl s_client 从 knox_gateway_host:knox_gateway_port 抓取服务端证书
+# ----------------------------------------------------------------------
+
+def import_knox_gateway_cert():
+    import params
+
+    if not params.enable_ranger_knox:
+        Logger.info("TTBigdata: Ranger Knox plugin disabled -> skip import Knox HTTPS cert")
+        return
+
+    if not params.ranger_admin_truststore_enabled:
+        Logger.info("TTBigdata: ranger_admin_truststore_enabled=false -> skip import Knox cert")
+        return
+
+    # 你需要在 params.py 里准备好 knox_gateway_host/knox_gateway_port
+    # （或者你也可以继续用 knox_url 并在 params.py 里解析成 host/port）
+    Logger.info(format(
+        "TTBigdata: import Knox cert start. knox={knox_gateway_host}:{knox_gateway_port}, "
+        "truststore={ranger_admin_truststore_file}, alias={ranger_truststore_alias}, type={ranger_admin_truststore_type}"
+    ))
+
+    keytool_cmd = format("{java_home}/bin/keytool")
+    knox_tmp_file_crt = format("/tmp/knox-gateway-{ranger_truststore_alias}.crt")
+
+    alias_exists_cmd = format(
+        "{keytool_cmd} -list "
+        "-keystore {ranger_admin_truststore_file} "
+        "-storepass {ranger_admin_truststore_password} "
+        "-storetype {ranger_admin_truststore_type} "
+        "-alias {ranger_truststore_alias} >/dev/null 2>&1"
+    )
+
+    # 1) 从网络抓取服务端证书（只取第一段证书，避免链导致 keytool 失败）
+    gen_cmd = format(
+        "openssl s_client -connect {knox_gateway_host}:{knox_gateway_port} "
+        "-servername {knox_gateway_host} -showcerts </dev/null 2>/dev/null | "
+        "sed -n '/BEGIN CERTIFICATE/,/END CERTIFICATE/p' > {knox_tmp_file_crt}"
+    )
+
+    # 2) 导入 truststore
+    import_cmd = format(
+        "{keytool_cmd} -importcert -noprompt "
+        "-alias {ranger_truststore_alias} "
+        "-file {knox_tmp_file_crt} "
+        "-keystore {ranger_admin_truststore_file} "
+        "-storepass {ranger_admin_truststore_password} "
+        "-storetype {ranger_admin_truststore_type} "
+        ">/dev/null 2>&1"
+    )
+
+    try:
+        Execute(gen_cmd, user=params.unix_user,
+                tries=2, try_sleep=2, logoutput=True,
+                not_if=alias_exists_cmd)
+
+        Execute(format("test -s {knox_tmp_file_crt}"),
+                user=params.unix_user,
+                logoutput=True,
+                not_if=alias_exists_cmd)
+
+        Execute(import_cmd, user=params.unix_user,
+                tries=2, try_sleep=2, logoutput=True,
+                not_if=alias_exists_cmd)
+
+        # verify
+        Execute(alias_exists_cmd, user=params.unix_user, logoutput=True)
+        Logger.info(format("TTBigdata: import Knox cert OK. alias={ranger_truststore_alias}"))
+
+    except ExecutionFailed as e:
+        Logger.info("TTBigdata: import Knox cert failed but ignored. {0}".format(e))
+        return
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/package/templates/ranger_zk_jaas_conf.j2
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/package/templates/ranger_zk_jaas_conf.j2 b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/package/templates/ranger_zk_jaas_conf.j2
new file mode 100644
--- /dev/null	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/package/templates/ranger_zk_jaas_conf.j2	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -0,0 +1,43 @@
+{#
+# 版权所有 (c) JaneTTR 2025
+# 项目名称：ambari-env
+#
+# 本文件属于付费部分代码，仅供个人学习和研究使用。
+#
+# 禁止行为：
+# 1. 未经授权，不得将本文件或其编译后的代码用于任何商业用途；
+# 2. 禁止重新分发本文件或其修改版本；
+# 3. 禁止通过反编译、反向工程等手段试图绕过授权验证。
+#
+# 商业授权：
+# 如需将本文件或其编译后的代码用于商业用途，必须获得版权所有者的书面授权。
+# 联系方式：
+# 邮箱：3832514048@qq.com
+#
+# 责任声明：
+# 本文件按“现状”提供，不附带任何形式的担保，包括但不限于适销性、特定用途适用性或无侵权的担保。
+#
+# 如有任何疑问，请联系版权所有者。
+#}
+
+Client {
+  com.sun.security.auth.module.Krb5LoginModule required
+  useKeyTab=true
+  storeKey=true
+  useTicketCache=false
+  doNotPrompt=true
+  renewTGT=false
+  keyTab="{{zk_client_kerberos_keytab}}"
+  principal="{{zk_client_kerberos_principal}}";
+};
+
+com.sun.security.jgss.krb5.initiate {
+  com.sun.security.auth.module.Krb5LoginModule required
+  renewTGT=false
+  doNotPrompt=true
+  useKeyTab=true
+  storeKey=true
+  useTicketCache=false
+  keyTab="{{zk_client_kerberos_keytab}}"
+  principal="{{zk_client_kerberos_principal}}";
+};
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/properties/ranger-env.sh.j2
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/properties/ranger-env.sh.j2 b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/properties/ranger-env.sh.j2
--- a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/properties/ranger-env.sh.j2	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/RANGER/properties/ranger-env.sh.j2	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -26,8 +26,22 @@
 export RANGER_USER={{unix_user}}
 ranger_admin_max_heap_size={{ranger_admin_max_heap_size}}
 {% if security_enabled %}
-export JAVA_OPTS=" ${JAVA_OPTS} -Dzookeeper.sasl.client.username={{zookeeper_principal_primary}} "
+export JAVA_OPTS=" ${JAVA_OPTS} \
+  -Dzookeeper.sasl.client=true \
+  -Dzookeeper.sasl.clientconfig=Client \
+  -Dzookeeper.sasl.client.username={{zookeeper_principal_primary}} \
+  -Djava.security.auth.login.config=/etc/ranger/admin/conf/ranger_jaas/ranger_zk_jaas.conf \
+  -Djavax.security.auth.useSubjectCredsOnly=false "
+{% endif %}
+
+{# TTBigdata: knox plugin 使用 必生效 或者 默认设置为 true #}
+{% if ranger_admin_truststore_enabled %}
+export JAVA_OPTS=" ${JAVA_OPTS} \
+  -Djavax.net.ssl.trustStore={{ranger_admin_truststore_file}} \
+  -Djavax.net.ssl.trustStorePassword={{ranger_admin_truststore_password}} \
+  -Djavax.net.ssl.trustStoreType={{ranger_admin_truststore_type | default('JKS')}} "
 {% endif %}
+
 {% endif %}

 {% if is_ranger_usersync_host  %}
@@ -45,4 +59,7 @@
 export TAGSYNC_PID_DIR_PATH={{ranger_pid_dir}}
 export UNIX_TAGSYNC_USER={{unix_user}}
 ranger_tagsync_max_heap_size={{ranger_tagsync_max_heap_size}}
-{% endif %}
\ No newline at end of file
+{% endif %}
+
+{# TTBigdata: 优化日志时间为国内时间 #}
+export JAVA_OPTS="$JAVA_OPTS -Duser.timezone=Asia/Shanghai"
\ No newline at end of file
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/SPARK/package/scripts/setup_spark.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/SPARK/package/scripts/setup_spark.py b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/SPARK/package/scripts/setup_spark.py
--- a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/SPARK/package/scripts/setup_spark.py	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/SPARK/package/scripts/setup_spark.py	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -1,4 +1,4 @@
-#!/usr/bin/python
+#!/usr/bin/env ambari-python-wrap
 """
 Licensed to the Apache Software Foundation (ASF) under one
 or more contributor license agreements.  See the NOTICE file
@@ -90,12 +90,27 @@
         generate_logfeeder_input_config('', Template("input.config-spark.json.j2", extra_imports=[default]))

     spark_defaults = dict(params.config['configurations']['spark-defaults'])
-
     if params.security_enabled:
+        # ------------------------------------------------------------------
+        # TTBigData 优化说明：
+        # 1. 在 Kerberos 集群中，Spark History Server 与 Spark Thrift Server
+        #    的认证方式应保持清晰边界，避免 SPNEGO / KERBEROS 混用导致
+        #    GSS initiate failed 等隐蔽问题。
+        # 2. 统一使用 Hive 生态中的 Kerberos principal/keytab，
+        #    可确保 Hue / Beeline / SparkSQL / Ranger 等组件行为一致。
+        # 3. 显式展开 _HOST 为 FQDN，避免 Kerberos 在运行时根据 DNS
+        #    进行主机名规范化而导致 SPN 不匹配。
+        # ------------------------------------------------------------------
         spark_defaults.pop("history.server.spnego.kerberos.principal")
         spark_defaults.pop("history.server.spnego.keytab.file")
-        spark_defaults['spark.history.kerberos.principal'] = spark_defaults['spark.history.kerberos.principal'].replace(
-            '_HOST', socket.getfqdn().lower())
+        spark_defaults['spark.history.kerberos.principal'] = (
+            spark_defaults['spark.history.kerberos.principal']
+            .replace('_HOST', socket.getfqdn().lower())
+        )
+
+        spark_defaults['spark.sql.hive.thriftServer.authentication'] = 'KERBEROS'
+        spark_defaults['spark.sql.hive.thriftServer.principal'] = params.spark_kerberos_principal
+        spark_defaults['spark.sql.hive.thriftServer.keytab'] = params.spark_kerberos_keytab

     if not params.spark_warehouse_dir:
         spark_defaults.pop("spark.sql.warehouse.dir")
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino.py b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino.py
--- a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino.py	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/TRINO/package/scripts/trino.py	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -82,6 +82,13 @@
         mode=mode_identified_for_dir,
     )

+    Directory(
+        '/home/trino',
+        owner=params.trino_user,
+        group=params.trino_group,
+        mode=0o755,
+    )
+
     # On some OS this folder could be not exists, so we will create it before pushing there files
     Directory(params.limits_conf_dir, create_parents=True, owner="root", group="root")

Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/ZOOKEEPER/configuration/zoo.cfg.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/ZOOKEEPER/configuration/zoo.cfg.xml b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/ZOOKEEPER/configuration/zoo.cfg.xml
--- a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/ZOOKEEPER/configuration/zoo.cfg.xml	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/ZOOKEEPER/configuration/zoo.cfg.xml	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -20,98 +20,124 @@
  */
 -->
 <configuration>
-  <property>
-    <name>tickTime</name>
-    <value>3000</value>
-    <display-name>Length of single Tick</display-name>
-    <description>The length of a single tick in milliseconds, which is the basic time unit used by ZooKeeper</description>
-    <value-attributes>
-      <type>int</type>
-      <overridable>false</overridable>
-      <unit>ms</unit>
-    </value-attributes>
-    <on-ambari-upgrade add="true"/>
-  </property>
-  <property>
-    <name>initLimit</name>
-    <value>10</value>
-    <display-name>Ticks to allow for sync at Init</display-name>
-    <description>Ticks to allow for sync at Init.</description>
-    <value-attributes>
-      <type>int</type>
-      <overridable>false</overridable>
-    </value-attributes>
-    <on-ambari-upgrade add="true"/>
-  </property>
-  <property>
-    <name>syncLimit</name>
-    <value>5</value>
-    <display-name>Ticks to allow for sync at Runtime</display-name>
-    <description>Ticks to allow for sync at Runtime.</description>
-    <value-attributes>
-      <type>int</type>
-      <overridable>false</overridable>
-    </value-attributes>
-    <on-ambari-upgrade add="true"/>
-  </property>
-  <property>
-    <name>clientPort</name>
-    <value>2181</value>
-    <display-name>Port for running ZK Server</display-name>
-    <description>Port for running ZK Server.</description>
-    <value-attributes>
-      <type>int</type>
-      <overridable>false</overridable>
-    </value-attributes>
-    <on-ambari-upgrade add="true"/>
-  </property>
-  <property>
-    <name>dataDir</name>
-    <value>/hadoop/zookeeper</value>
-    <display-name>ZooKeeper directory</display-name>
-    <description>Data directory for ZooKeeper.</description>
-    <value-attributes>
-      <type>directory</type>
-    </value-attributes>
-    <on-ambari-upgrade add="true"/>
-  </property>
-  <property>
-    <name>autopurge.snapRetainCount</name>
-    <value>30</value>
-    <description>ZooKeeper purge feature retains the autopurge.snapRetainCount
-      most recent snapshots and the corresponding transaction
-      logs in the dataDir and dataLogDir respectively and deletes the rest. </description>
-    <on-ambari-upgrade add="true"/>
-  </property>
-  <property>
-    <name>autopurge.purgeInterval</name>
-    <value>24</value>
-    <description>The time interval in hours for which the purge task has to be triggered.
-      Set to a positive integer (1 and above) to enable the auto purging.</description>
-    <on-ambari-upgrade add="true"/>
-  </property>
-  <property>
-    <name>4lw.commands.whitelist</name>
-    <value>mntr,conf,ruok</value>
-    <description>A list of comma separated Four Letter Words commands that user wants to use.
-      A valid Four Letter Words command must be put in this list else ZooKeeper server will not enable the command.
-      By default the whitelist only contains "srvr" command which zkServer.sh uses.
-      The rest of four letter word commands are disabled by default.</description>
-    <on-ambari-upgrade add="true"/>
-  </property>
-  <property>
-    <name>admin.enableServer</name>
-    <value>true</value>
-    <description>Set to "false" to disable the AdminServer. By default the AdminServer is enabled.</description>
-    <value-attributes>
-      <type>boolean</type>
-    </value-attributes>
-    <on-ambari-upgrade add="true"/>
-  </property>
-  <property>
-    <name>admin.serverPort</name>
-    <value>9393</value>
-    <description>The port the embedded Jetty server listens on. Defaults to 8080.</description>
-    <on-ambari-upgrade add="true"/>
-  </property>
+    <property>
+        <name>tickTime</name>
+        <value>3000</value>
+        <display-name>Length of single Tick</display-name>
+        <description>The length of a single tick in milliseconds, which is the basic time unit used by ZooKeeper
+        </description>
+        <value-attributes>
+            <type>int</type>
+            <overridable>false</overridable>
+            <unit>ms</unit>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>
+    <property>
+        <name>initLimit</name>
+        <value>10</value>
+        <display-name>Ticks to allow for sync at Init</display-name>
+        <description>Ticks to allow for sync at Init.</description>
+        <value-attributes>
+            <type>int</type>
+            <overridable>false</overridable>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>
+    <property>
+        <name>syncLimit</name>
+        <value>5</value>
+        <display-name>Ticks to allow for sync at Runtime</display-name>
+        <description>Ticks to allow for sync at Runtime.</description>
+        <value-attributes>
+            <type>int</type>
+            <overridable>false</overridable>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>
+    <property>
+        <name>clientPort</name>
+        <value>2181</value>
+        <display-name>Port for running ZK Server</display-name>
+        <description>Port for running ZK Server.</description>
+        <value-attributes>
+            <type>int</type>
+            <overridable>false</overridable>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>
+    <property>
+        <name>dataDir</name>
+        <value>/hadoop/zookeeper</value>
+        <display-name>ZooKeeper directory</display-name>
+        <description>Data directory for ZooKeeper.</description>
+        <value-attributes>
+            <type>directory</type>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>
+    <property>
+        <name>autopurge.snapRetainCount</name>
+        <value>30</value>
+        <description>ZooKeeper purge feature retains the autopurge.snapRetainCount
+            most recent snapshots and the corresponding transaction
+            logs in the dataDir and dataLogDir respectively and deletes the rest.
+        </description>
+        <on-ambari-upgrade add="true"/>
+    </property>
+    <property>
+        <name>autopurge.purgeInterval</name>
+        <value>24</value>
+        <description>The time interval in hours for which the purge task has to be triggered.
+            Set to a positive integer (1 and above) to enable the auto purging.
+        </description>
+        <on-ambari-upgrade add="true"/>
+    </property>
+    <property>
+        <name>4lw.commands.whitelist</name>
+        <value>mntr,conf,ruok</value>
+        <description>A list of comma separated Four Letter Words commands that user wants to use.
+            A valid Four Letter Words command must be put in this list else ZooKeeper server will not enable the
+            command.
+            By default the whitelist only contains "srvr" command which zkServer.sh uses.
+            The rest of four letter word commands are disabled by default.
+        </description>
+        <on-ambari-upgrade add="true"/>
+    </property>
+    <property>
+        <name>admin.enableServer</name>
+        <value>true</value>
+        <description>Set to "false" to disable the AdminServer. By default the AdminServer is enabled.</description>
+        <value-attributes>
+            <type>boolean</type>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>
+    <property>
+        <name>admin.serverPort</name>
+        <value>9393</value>
+        <description>The port the embedded Jetty server listens on. Defaults to 8080.</description>
+        <on-ambari-upgrade add="true"/>
+    </property>
+    <property>
+        <name>zookeeper.server.extended.format.enabled</name>
+        <value>true</value>
+        <display-name>Enable extended server.* format</display-name>
+        <description>
+            【TTBigdata 定制】用于兼容 ZooKeeper 3.5+ 动态配置事件解析。
+            开启后，server.X 将按扩展格式生成，例如：
+            server.1=dev1:2888:3888:participant;2181
+            若关闭，则仍使用传统格式：
+            server.1=dev1:2888:3888
+            在 Ranger/Hive（Curator）等客户端订阅 /zookeeper/config 的场景下，
+            传统格式可能导致 “Invalid config event received” 报错。
+            注意：该开关仅影响 zoo.cfg 渲染；已生成的 /zookeeper/config 仍需通过 reconfig 修复。
+        </description>
+        <value-attributes>
+            <type>boolean</type>
+            <overridable>true</overridable>
+        </value-attributes>
+        <on-ambari-upgrade add="true"/>
+    </property>
+
 </configuration>
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/ZOOKEEPER/package/scripts/params_linux.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/ZOOKEEPER/package/scripts/params_linux.py b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/ZOOKEEPER/package/scripts/params_linux.py
--- a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/ZOOKEEPER/package/scripts/params_linux.py	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/ZOOKEEPER/package/scripts/params_linux.py	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -109,3 +109,9 @@
     log4j_props = config['configurations']['zookeeper-log4j']['content']
 else:
     log4j_props = None
+
+
+
+
+
+
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/ZOOKEEPER/package/templates/zoo.cfg.j2
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/ZOOKEEPER/package/templates/zoo.cfg.j2 b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/ZOOKEEPER/package/templates/zoo.cfg.j2
--- a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/ZOOKEEPER/package/templates/zoo.cfg.j2	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/ZOOKEEPER/package/templates/zoo.cfg.j2	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -1,53 +1,46 @@
-{#
-# Licensed to the Apache Software Foundation (ASF) under one
-# or more contributor license agreements.  See the NOTICE file
-# distributed with this work for additional information
-# regarding copyright ownership.  The ASF licenses this file
-# to you under the Apache License, Version 2.0 (the
-# "License"); you may not use this file except in compliance
-# with the License.  You may obtain a copy of the License at
-#
-#   http://www.apache.org/licenses/LICENSE-2.0
-#
-# Unless required by applicable law or agreed to in writing, software
-# distributed under the License is distributed on an "AS IS" BASIS,
-# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-# See the License for the specific language governing permissions and
-# limitations under the License.
-#}
-
+# 版权所有 (c) JaneTTR 2025
+# 项目名称：ambari-env
 #
+# 本文件属于付费部分代码，仅供个人学习和研究使用。
 #
-# Licensed to the Apache Software Foundation (ASF) under one
-# or more contributor license agreements.  See the NOTICE file
-# distributed with this work for additional information
-# regarding copyright ownership.  The ASF licenses this file
-# to you under the Apache License, Version 2.0 (the
-# "License"); you may not use this file except in compliance
-# with the License.  You may obtain a copy of the License at
+# 禁止行为：
+# 1. 未经授权，不得将本文件或其编译后的代码用于任何商业用途；
+# 2. 禁止重新分发本文件或其修改版本；
+# 3. 禁止通过反编译、反向工程等手段试图绕过授权验证。
 #
-#   http://www.apache.org/licenses/LICENSE-2.0
+# 商业授权：
+# 如需将本文件或其编译后的代码用于商业用途，必须获得版权所有者的书面授权。
+# 联系方式：
+# 邮箱：3832514048@qq.com
 #
-# Unless required by applicable law or agreed to in writing,
-# software distributed under the License is distributed on an
-# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
-# KIND, either express or implied.  See the License for the
-# specific language governing permissions and limitations
-# under the License.
+# 责任声明：
+# 本文件按“现状”提供，不附带任何形式的担保，包括但不限于适销性、特定用途适用性或无侵权的担保。
 #
+# 如有任何疑问，请联系版权所有者。
 #
-#
+# 【TTBigdata 修改】server.* 扩展格式开关：zookeeper.server.extended.format.enabled
+# - true ：server.X=host:2888:3888:participant;clientPort（推荐，兼容 ZooKeeper 3.5+ 动态配置事件解析）
+# - false：server.X=host:2888:3888（传统格式）
+
+
+{# TTBigdata: server.* 扩展格式开关（ZooKeeper 3.5+ 建议开启） #}
+{% set ext_enabled = (config['configurations']['zoo.cfg'].get('zookeeper.server.extended.format.enabled', 'true') | lower) == 'true' %}
+{% set client_port = config['configurations']['zoo.cfg'].get('clientPort', '2181') %}

 {% for key, value in zoo_cfg_properties_map.iteritems() -%}
-  {{key}}={{value}}
+{{key}}={{value}}
 {% endfor %}
+
 {% for host in zookeeper_hosts -%}
-server.{{loop.index}}={{host}}:2888:3888
-{% endfor %}
+server.{{ loop.index }}={{ host }}:2888:3888{% if ext_enabled %}:participant;{{ host }}:{{ client_port }}{% endif %}{{ '\n' }}
+{% endfor -%}
+

 {% if security_enabled -%}
 authProvider.1=org.apache.zookeeper.server.auth.SASLAuthenticationProvider
+requireClientAuthScheme=sasl
 jaasLoginRenew=3600000
 kerberos.removeHostFromPrincipal=true
 kerberos.removeRealmFromPrincipal=true
 {% endif %}
+
Index: ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/stack_advisor.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/stack_advisor.py b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/stack_advisor.py
--- a/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/stack_advisor.py	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-server/src/main/resources/stacks/BIGTOP/3.2.0/services/stack_advisor.py	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -344,7 +344,8 @@

         if "HUE" in servicesList:
             hue_user = None
-            if "hue-env" in services["configurations"] and "hue_user" in services["configurations"]["hue-env"]["properties"]:
+            if "hue-env" in services["configurations"] and "hue_user" in services["configurations"]["hue-env"][
+                "properties"]:
                 hue_user = services["configurations"]["hue-env"]["properties"]["hue_user"]

                 hueHosts = self.getHostsWithComponent("HUE", "HUE_SERVER", services, hosts) or []
@@ -364,7 +365,8 @@

         if "ALLUXIO" in servicesList:
             alluxio_user = None
-            if "alluxio-env" in services["configurations"] and "alluxio_user" in services["configurations"]["alluxio-env"]["properties"]:
+            if "alluxio-env" in services["configurations"] and "alluxio_user" in \
+                    services["configurations"]["alluxio-env"]["properties"]:
                 alluxio_user = services["configurations"]["alluxio-env"]["properties"]["alluxio_user"]
                 alluxioMasterNames = "*"
                 # alluxioMasters = self.getHostsWithComponent("ALLUXIO", "ALLUXIO_MASTER", services, hosts) or []
@@ -386,7 +388,8 @@

         if "HBASE" in servicesList:
             hbase_user = None
-            if "hbase-env" in services["configurations"] and "hbase_user" in services["configurations"]["hbase-env"]["properties"]:
+            if "hbase-env" in services["configurations"] and "hbase_user" in services["configurations"]["hbase-env"][
+                "properties"]:
                 hbase_user = services["configurations"]["hbase-env"]["properties"]["hbase_user"]
                 hbaseMasterNames = "*"
                 # hbaseMasters = self.getHostsWithComponent("HBASE", "HBASE_MASTER", services, hosts) or []
@@ -591,20 +594,43 @@
         return round_to_n(collector_heapsize), round_to_n(hbase_heapsize), total_sinks_count

     def recommendAmsConfigurations(self, configurations, clusterData, services, hosts):
+        from resource_management.libraries.functions.format import format
+
         putAmsEnvProperty = self.putProperty(configurations, "ams-env", services)
         putAmsHbaseSiteProperty = self.putProperty(configurations, "ams-hbase-site", services)
         putAmsSiteProperty = self.putProperty(configurations, "ams-site", services)
         putHbaseEnvProperty = self.putProperty(configurations, "ams-hbase-env", services)
         putGrafanaPropertyAttribute = self.putPropertyAttribute(configurations, "ams-grafana-env")

+        self.logger.info("TTBIGDATA[AMS][DEBUG] ================== AMS collector host detect ==================")
+
         amsCollectorHosts = self.getComponentHostNames(services, "AMBARI_METRICS", "METRICS_COLLECTOR")
-        if 'cluster-env' in services['configurations'] and \
+        self.logger.info(format("TTBIGDATA[AMS][DEBUG] amsCollectorHosts(raw) = {amsCollectorHosts}"))
+
+        if 'cluster-env' in services.get('configurations', {}) and \
                 'metrics_collector_external_hosts' in services['configurations']['cluster-env']:
+            self.logger.info(format(
+                "TTBIGDATA[AMS][DEBUG] metrics_collector_external_hosts = "
+                "{services['configurations']['cluster-env']['metrics_collector_external_hosts']}"
+            ))
             amsCollectorHosts = services['configurations']['cluster-env']['metrics_collector_external_hosts']

+        self.logger.info(format("TTBIGDATA[AMS][DEBUG] amsCollectorHosts(final) = {amsCollectorHosts}"))
+
         metric_collector_host = 'localhost' if len(amsCollectorHosts) == 0 else amsCollectorHosts[0]
+        self.logger.info(format("TTBIGDATA[AMS][DEBUG] metric_collector_host(selected) = {metric_collector_host}"))
+
+        # 这里不要用 Ambari format() 做函数调用，直接用 Python 字符串 format
+        self.logger.info(
+            "TTBIGDATA[AMS][DEBUG] metric_collector_host(type) = {0}".format(type(metric_collector_host))
+        )

-        putAmsSiteProperty("timeline.metrics.service.webapp.address", str(metric_collector_host) + ":6188")
+        #putAmsSiteProperty("timeline.metrics.service.webapp.address", format("{metric_collector_host}:6188"))
+        self.logger.info(format(
+            "TTBIGDATA[AMS][DEBUG] write ams-site timeline.metrics.service.webapp.address = {metric_collector_host}:6188"
+        ))
+
+        self.logger.info("TTBIGDATA[AMS][DEBUG] ===============================================================")

         log_dir = "/var/log/ambari-metrics-collector"
         if "ams-env" in services["configurations"]:
Index: ambari-web/app/styles/application.less
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/ambari-web/app/styles/application.less b/ambari-web/app/styles/application.less
--- a/ambari-web/app/styles/application.less	(revision b1640116f5f26d57b1e0e1039cc14d48113fca70)
+++ b/ambari-web/app/styles/application.less	(revision ca8fac20cd983bc02bf8cda9acbf95eaabbe3dd1)
@@ -41,10 +41,21 @@
   padding-left: 10px;
 }

-.glyphicon-2x{font-size: 2em;}
-.glyphicon-3x{font-size: 3em;}
-.glyphicon-4x{font-size: 4em;}
-.glyphicon-5x{font-size: 5em;}
+.glyphicon-2x {
+  font-size: 2em;
+}
+
+.glyphicon-3x {
+  font-size: 3em;
+}
+
+.glyphicon-4x {
+  font-size: 4em;
+}
+
+.glyphicon-5x {
+  font-size: 5em;
+}

 /************************************************************************
 * Health status(service/host/host component health)icons class names
@@ -52,15 +63,19 @@
 .glyphicon-warning-sign, .icon-warning-sign {
   color: @health-status-red;
 }
+
 .glyphicon-ok-sign, .icon-ok-sign {
   color: @health-status-green;
 }
+
 .glyphicon-question-sign, .icon-question-sign {
   color: @health-status-yellow;
 }
+
 .glyphicon-minus-sign, .icon-minus-sign {
   color: @health-status-orange;
 }
+
 .icon-medkit {
   color: @maintenance-black;
 }
@@ -72,7 +87,7 @@

 @-moz-document url-prefix() {
   input[type="file"] {
-    line-height: 25px!important;
+    line-height: 25px !important;
   }
 }

@@ -98,6 +113,7 @@
   color: #666;
   margin-top: -1 * @footer-height - 1;
   height: @footer-height - 60px;
+
   .footer-links {
     font-size: @smaller-font-size;
   }
@@ -109,34 +125,40 @@
       opacity: 1;
     }
   }
+
   &.disabled {
     .pencil-box {
       display: none;
     }
   }
-  &.well{
+
+  &.well {
     padding: 10px;
     position: relative;
     margin-bottom: 25px;
     cursor: pointer;
-    &.edit-mode{
+
+    &.edit-mode {
       cursor: default;
     }
-    &.disabled{
+
+    &.disabled {
       background: white;
     }
   }
+
   &.edit-mode {
     &:hover {
       .pencil-box {
         opacity: 0;
       }
     }
+
     .items-box {
       ul.items-list {
         li.item {
-          &.add-item-input .ember-text-field{
-            display: inline-block!important;
+          &.add-item-input .ember-text-field {
+            display: inline-block !important;
             text-overflow: ellipsis;
             white-space: nowrap;
             position: relative;
@@ -151,6 +173,7 @@
             -o-transition: none;
             transition: none;
           }
+
           .close {
             display: inline-block;
           }
@@ -158,7 +181,8 @@
       }
     }
   }
-  .actions-panel{
+
+  .actions-panel {
     position: absolute;
     right: 5px;
     bottom: -42px;
@@ -187,19 +211,23 @@
       line-height: 1.5;
       border-radius: 3px;
     }
+
     .glyphicon-remove {
       color: #000;
     }
+
     .glyphicon-ok {
       color: white;
     }
   }
+
   .items-box {
-    ul.items-list{
+    ul.items-list {
       list-style-type: none;
       margin: 0;
       padding: 0;
-      li.item{
+
+      li.item {
         display: inline-block;
         padding: 4px 8px;
         margin: 0 5px 5px 2px;
@@ -208,24 +236,30 @@
         max-width: 100%;
         white-space: nowrap;
         position: relative;
-        &.add-item{
+
+        &.add-item {
           color: #ddd;
         }
-        &.deletable{
+
+        &.deletable {
           padding-right: 25px;
         }
-        &.global{
+
+        &.global {
           background-color: #f5f5f5;
         }
+
         li {
           a {
             text-decoration: none;
           }
         }
+
         a {
           color: #555;
         }
-        .close{
+
+        .close {
           margin: -2px 0 0 5px;
           width: 13px;
           outline: none;
@@ -235,7 +269,8 @@
       }
     }
   }
-  .pencil-box{
+
+  .pencil-box {
     position: absolute;
     right: 5px;
     top: 5px;
@@ -256,15 +291,18 @@
   min-width: 65px;
   max-height: 150px;
   overflow: auto;
+
   ul {
     list-style-type: none;
     margin: 0;
     padding: 0;
+
     li {
       padding: 3px 5px;
       display: block;
       cursor: pointer;
-      &.selected, .typeahead-box ul li:hover{
+
+      &.selected, .typeahead-box ul li:hover {
         background: #eee;
       }
     }
@@ -275,6 +313,7 @@
   position: absolute;
   opacity: 0.9;
   background-color: #fefefe;
+
   .spinner {
     display: none;
   }
@@ -285,11 +324,14 @@
   height: 120px;
   overflow: auto;
   padding: 5px;
+
   ul {
     margin-bottom: 0;
   }
+
   table {
     width: 100%;
+
     td {
       width: 50%;
       padding: 0;
@@ -302,6 +344,7 @@
   min-width: 60px;
   font-size: 14px;
   cursor: auto;
+
   a {
     cursor: pointer;
   }
@@ -357,12 +400,12 @@
 ::-webkit-scrollbar-thumb {
   border-radius: 8px;
   -webkit-border-radius: 8px;
-  background: rgba(233,233,233,0.5);
-  -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.2);
+  background: rgba(233, 233, 233, 0.5);
+  -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.2);
 }

 ::-webkit-scrollbar-thumb:window-inactive {
-  background: rgba(233,233,233,0.3);
+  background: rgba(233, 233, 233, 0.3);
 }

 .side-nav-menu::-webkit-scrollbar {
@@ -374,7 +417,7 @@
 }

 .badge-important {
-  background-color: #b94a48!important;
+  background-color: #b94a48 !important;
 }

 .badge-warning {
@@ -384,6 +427,7 @@
 table.diff {
   white-space: normal;
   width: 100%;
+
   .replace, .insert, .empty {
     float: none;
     width: 50%;
@@ -403,6 +447,7 @@
 .row.row-no-pad {
   padding-left: 15px;
   padding-right: 15px;
+
   .col-md-1, .col-md-2, .col-md-3, .col-md-4, .col-md-5, .col-md-6, .col-md-7, .col-md-8, .col-md-9, .col-md-10, .col-md-11, .col-md-12,
   .col-lg-1, .col-lg-2, .col-lg-3, .col-lg-4, .col-lg-5, .col-lg-6, .col-lg-7, .col-lg-8, .col-lg-9, .col-lg-10, .col-lg-11, .col-lg-12 {
     padding-left: 1px;
@@ -417,9 +462,11 @@

 .ru-badge {
   text-align: center;
+
   a:hover {
     text-decoration: none;
   }
+
   .upgrade-in-progress {
     .infoPulse();
   }
@@ -430,6 +477,7 @@

   .upgrade-aborted {
     .dangerPulse();
+
     .glyphicon-remove {
       color: #fff;
     }
@@ -456,17 +504,21 @@
 .health-status-HEALTHY, .health-status-LIVE, .health-status-STARTING, .health-status-started, .health-status-starting {
   color: @health-status-green;
 }
+
 .health-status-color-red, .health-status-installed, .health-status-stopping, .health-status-DEAD-RED, .health-status-STOPPING {
   color: @health-status-red !important;
 }
+
 .health-status-unknown, .health-status-DEAD-YELLOW {
   color: @health-status-yellow !important;
 }
+
 .health-status-DEAD-ORANGE {
   color: @health-status-orange;
 }
+
 .health-status-color-blue {
-  color:@health-status-blue;
+  color: @health-status-blue;
 }

 .nav.top-nav-menu,
@@ -475,6 +527,7 @@
     display: inline-block;
     width: 100%;
   }
+
   .glyphicon-caption {
     display: inline-block;
     width: 20%;
@@ -492,6 +545,7 @@

 .nav-list.nav-services {
   margin-bottom: 5px;
+
   .glyphicon-caption {
     .alerts-count {
       position: relative;
@@ -522,6 +576,7 @@
 .login-header {
   width: 100%;
   margin-bottom: 10px;
+
   ul.nav.side-nav-header {
     width: 100%;
   }
@@ -574,14 +629,14 @@
 }

 .glyphicon-exclamation-sign {
-  color:#B94A48;
+  color: #B94A48;
 }

 .glyphicon-play.enabled {
   color: @green;
 }

-.glyphicon-stop.enabled{
+.glyphicon-stop.enabled {
   color: red;
 }

@@ -633,6 +688,7 @@
   width: @spinner-default-width;
   height: @spinner-default-height;
   margin: 0 auto;
+
   i {
     color: #555;
     font-size: 2.5em;
@@ -642,6 +698,7 @@
     width: @spinner-small-width;
     height: @spinner-small-height;
     background-size: cover;
+
     i {
       font-size: 1em;
     }
@@ -680,15 +737,19 @@
   .pending, .queued {
     color: #999;
   }
+
   .in_progress {
     color: #367FE6;
   }
+
   .completed {
     color: #0EA31C;
   }
+
   .failed {
     color: #DF5F5F;
   }
+
   .aborted, .timedout {
     color: #FF9C09;
   }
@@ -698,6 +759,7 @@

   .request-schedule-abort {
     margin-top: 7px;
+
     .btn {
       margin-top: -5px;
     }
@@ -733,6 +795,7 @@
     overflow: auto;
     width: 100%;
   }
+
   .task-detail-log-clipboard {
     width: 100%;
     resize: none;
@@ -761,6 +824,7 @@
     .task-detail-ico-wrap {
       font-size: 14px;
       float: right;
+
       a {
         cursor: pointer;
         float: left;
@@ -790,7 +854,7 @@

 /*start services summary*/
 .services {
-  .alert{
+  .alert {
     padding: 5px;
   }

@@ -804,9 +868,11 @@
     float: none;
     display: inline;
   }
+
   .like_pointer {
     cursor: pointer;
   }
+
   .service {
     position: relative;
     margin-top: 10px;
@@ -818,20 +884,25 @@
       line-height: 21px;
       margin-left: 0;
       width: 145px;
+
       a {
         margin-left: 5px
       }
     }
+
     .summary {
       line-height: 21px;
     }
+
     .clearfix {
       padding-bottom: 8px;
     }
+
     .service-body {
       display: none;
       position: relative;
     }
+
     table.table {
       margin-top: 14px;
       color: #666;
@@ -840,6 +911,7 @@
         padding-right: 10px;
         text-align: right !important;
       }
+
       th, td {
         padding: 4px;
       }
@@ -850,21 +922,24 @@
 .services, .summary-info {
   .tab-marker-position(@color) {
     color: @color;
-    background-position:  0 7px;
+    background-position: 0 7px;
     background-repeat: no-repeat;
     list-style: none;
     height: 13px;
     width: 13px;
-    margin: 0 3px 0 0 ;
+    margin: 0 3px 0 0;
     display: inline !important;
     float: none !important;
   }
+
   .STARTING, .STARTED {
     .tab-marker-position (@health-status-green);
   }
+
   .STOPPING, .INSTALLED {
     .tab-marker-position (@health-status-red);
   }
+
   .UNKNOWN {
     .tab-marker-position (@health-status-yellow);
   }
@@ -873,6 +948,7 @@
     color: @health-status-red;
     display: inline;
   }
+
   .service-summary-component-green-live {
     color: #228b22;
     display: inline;
@@ -893,25 +969,31 @@
     margin-left: 2px;
     min-width: 180px;
   }
+
   .summary-label {
     font-size: 12px;
     text-transform: uppercase;
     margin-top: 5px;
     margin-bottom: 5px;
   }
+
   .summary-value {
     color: #333333;
+
     span {
       display: inline-block;
+
       &.endpoint-value {
         padding-left: 30px;
         word-break: break-word;
       }
-      .clip-board{
+
+      .clip-board {
         margin-left: 5px;
       }
     }
   }
+
   .master-group-title {
     .ellipsis-overflow-nowrap;
   }
@@ -927,6 +1009,7 @@
   padding: 7px 0;
   text-align: center;
   color: #333;
+
   &:hover {
     background-color: #eee;
     color: #333;
@@ -947,18 +1030,23 @@
   .shown {
     display: inline-block;
   }
+
   .time-label {
     text-align: center;
   }
+
   .actions-container {
     text-align: center;
+
     .graph-details-time-range {
       display: inline-block;
+
       .dropdown-menu {
         text-align: left;
       }
     }
   }
+
   .screensaver {
     width: 100%;
     margin-left: 0;
@@ -991,31 +1079,37 @@
     margin-left: 0;
     overflow: visible;
     width: 650px;
+
     .chart {
       left: 60px;
       overflow: visible;
       position: relative;
       text-align: center;
     }
+
     .chart-y-axis {
       position: absolute;
       top: -15px;
       bottom: 0;
       width: 60px;
     }
+
     .chart-legend {
       top: 245px;
     }
+
     .x_tick {
       .title {
         margin-top: 35px !important;
       }
     }
+
     .alert {
       display: inline-block;
       padding-right: 14px;
     }
   }
+
   position: relative;
   margin: 20px 15px 0 15px;

@@ -1023,6 +1117,7 @@
     position: relative;
     z-index: 1;
   }
+
   .chart-y-axis {
     position: absolute;
     top: 0;
@@ -1031,6 +1126,7 @@
     z-index: 2;
     margin-top: 15px;
   }
+
   .chart-x-axis {
     position: absolute;
     top: 180px;
@@ -1038,14 +1134,17 @@
     width: 30%;
     z-index: 2;
   }
+
   .x_tick {
     margin-top: 5px;
+
     .title {
       padding: 0 2px;
       opacity: 1 !important;
       top: 148px;
     }
   }
+
   svg {
     g {
       g:nth-child(1) {
@@ -1053,28 +1152,35 @@
       }
     }
   }
+
   text {
     font-weight: 700;
     opacity: 1 !important;
   }
+
   .chart-legend {
     font-family: 'Courier New';
     position: absolute;
     top: 180px;
     z-index: 3;
+
     .label {
       font-size: 12px;
     }
   }
+
   .rickshaw_legend {
     background-color: #999 !important;
+
     li:hover {
       background-color: #999 !important;
     }
   }
+
   .rickshaw_legend:empty {
     padding: 0;
   }
+
   .rickshaw_graph {
     .x_tick {
       .title {
@@ -1083,6 +1189,7 @@
       }
     }
   }
+
   .chart-overlay {
     position: absolute;
     top: 0;
@@ -1090,22 +1197,27 @@
     width: 100%;
     z-index: 5;
   }
+
   .chart-title {
     text-align: center;
     font-size: small;
+
     &.has-data {
       padding-right: 15px;
     }
   }
+
   .corner-icon {
     position: absolute;
     right: 0;
     bottom: -1px;
     text-decoration: none;
+
     i {
       color: #555;
     }
   }
+
   .export-graph-list-top {
     position: absolute;
     bottom: -5px;
@@ -1113,6 +1225,7 @@
     width: 100%;
     height: 10px;
   }
+
   .export-graph-list {
     top: auto;
     right: -1px;
@@ -1141,8 +1254,10 @@
       display: inline;
       float: none;
     }
+
     li {
       line-height: 24px;
+
       a {
         padding: 3px 4px;
         white-space: nowrap;
@@ -1154,10 +1269,12 @@
         padding-left: 37px;
       }
     }
+
     .glyphicon-blackboard {
       color: #555;
       padding-left: 1px;
     }
+
     .active {
       .glyphicon-blackboard {
         color: #f0f0f0;
@@ -1167,7 +1284,7 @@
   }

   .icon-medkit {
-    padding-left:6px;
+    padding-left: 6px;
   }

   .services-menu-actions {
@@ -1179,15 +1296,17 @@
   padding-left: 50px;
 }

-a.services-menu-blocks{
-  overflow:auto;
-  .icon-health-block{
-    float:left;
+a.services-menu-blocks {
+  overflow: auto;
+
+  .icon-health-block {
+    float: left;
   }
-  .service-name-block{
-    float:left;
-    white-space:normal;
-    word-break:break-word;
+
+  .service-name-block {
+    float: left;
+    white-space: normal;
+    word-break: break-word;
   }

   .glyphicon.glyphicon-refresh, .icon-medkit, .label {
@@ -1206,6 +1325,7 @@
   .menu-item-name.master-down:not(.client-only-service) {
     color: @health-status-red;
   }
+
   .menu-item-name.UNKNOWN {
     color: @health-status-yellow;
   }
@@ -1215,10 +1335,12 @@
   margin-top: -60px;
   position: relative;
   left: 280px;
+
   .nav-pills.move {
     float: right;
-    width:135px;
-    &>li {
+    width: 135px;
+
+    & > li {
       position: absolute;
     }
   }
@@ -1226,6 +1348,7 @@
   .dropdown-menu {
     min-width: 170px;
   }
+
   .alert {
     padding: 0 2px;
     margin: 0 2px;
@@ -1234,6 +1357,7 @@

 .service-block {
   margin-top: 20px;
+
   .summary-links-block {
     display: flex;
     display: -webkit-flex;
@@ -1241,20 +1365,25 @@
     display: -ms-flex;
     display: -o-flex;
   }
-  .panel, .panel-heading{
+
+  .panel, .panel-heading {
     border: none;
   }
+
   .panel-title {
     font-size: 20px;
   }
+
   .service-alerts {
     margin-top: 10px;
   }
+
   .quick-links-block {
     .panel-body a {
       display: block;
       margin-bottom: 5px;
     }
+
     h6 {
       word-break: break-all;
     }
@@ -1268,13 +1397,16 @@
   margin-left: 10px;
   min-height: 30px;
   float: right;
+
   .btn-group {
     vertical-align: inherit;
   }
+
   ul.dropdown-menu {
     li {
       text-align: left;
     }
+
     a {
       cursor: pointer;
     }
@@ -1292,28 +1424,34 @@

 .metrics-collapsed-graphs {
   margin-bottom: 10px;
+
   .panel {
     .panel-heading {
       font-size: 15px;
       color: #777;
       font-weight: bold;
+
       .panel-toggle {
         .glyphicon {
           margin-right: 10px;
+
           &:before {
             content: "\e252";
           }
         }
+
         &.collapsed {
           .glyphicon:before {
             content: "\e250";
           }
         }
       }
+
       .btn {
         margin: 3px;
       }
     }
+
     .panel-body.in {
       overflow: visible;
     }
@@ -1353,16 +1491,20 @@
 #admin-auto-start {
   background-color: #fff;
   padding: 30px;
+
   .description {
     color: @gray-text;
   }
+
   .table {
     th {
       font-weight: normal;
     }
+
     th:first-child {
       color: #666;
     }
+
     th:first-child,
     td:first-child,
     th:first-child + th,
@@ -1371,26 +1513,32 @@
       min-width: 200px;
       width: 20%;
     }
+
     th:first-child + th + th,
     td:first-child + td + td {
       width: 15%;
       text-align: center;
     }
+
     .skip-border {
       border: none;
     }
+
     .all-checkbox {
       display: inline-block;
       top: 2px;
+
       label {
         font-size: inherit;
       }
     }
   }
+
   .general-auto-start {
     display: inline-block;
     margin-left: 15px;
   }
+
   .form-horizontal .radio,
   .form-horizontal .checkbox,
   .form-horizontal .radio-inline,
@@ -1403,13 +1551,16 @@
   hr {
     margin: 5px 0;
   }
+
   select {
     width: 100%;
   }
+
   .setting-wrapper {
     margin-bottom: 20px;
   }
 }
+
 /*End Admin*/

 /*Start About*/
@@ -1419,6 +1570,7 @@
     font-size: 2em;
   }
 }
+
 /*End About*/

 /*Dashboard*/
@@ -1446,6 +1598,7 @@
     padding: 5px 5px 5px 10px;
     color: #006F9F;
   }
+
   .indicatorR {
     background-color: #E2001A;
   }
@@ -1488,6 +1641,7 @@
     margin-top: 20px;
     margin-bottom: 20px;
     font-size: 12px;
+
     .tile {
       box-sizing: content-box;
       width: 30px;
@@ -1617,14 +1771,16 @@
   width: ~"calc(100% - 20px)";
 }

-.not-active-link{
+.not-active-link {
   color: #999;
-  a{
+
+  a {
     text-decoration: none;
     pointer-events: none;
     color: #999;
     cursor: default;
   }
+
   .black {
     color: black;
   }
@@ -1635,7 +1791,7 @@
 }

 .lowercase {
-  text-transform:lowercase;
+  text-transform: lowercase;
 }

 .ellipsis:after {
@@ -1656,12 +1812,15 @@
   .sorting_asc {
     background: url(data:image/png;base64,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) no-repeat right 50%;
   }
+
   .sorting_desc {
     background: url(data:image/png;base64,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) no-repeat right 50%;
   }
+
   .sorting {
     background: url(data:image/png;base64,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) no-repeat right 50%;
   }
+
   a.ui-icon-circle-close {
     float: right;
     opacity: 0.2;
@@ -1669,36 +1828,44 @@
     position: relative;
     margin-top: 8px;
     z-index: 10;
+
     &:hover {
       opacity: 0.7;
     }
   }
+
   .notActive {
     a.ui-icon-circle-close {
       visibility: hidden;
     }
   }
+
   .label-row {
     font-size: 0.9em;
+
     th {
       padding: 4px;
       padding-left: 10px;
     }
+
     .active-sort {
       color: #555;
       text-decoration: none;
       border-radius: 0;
     }
   }
+
   .filter-row {
     th {
       padding: 8px;
     }
+
     .active-filter {
       color: #555;
       text-decoration: none;
       background-color: #e5e5e5;
     }
+
     .filter-btn {
       color: #999;
       font-size: 12px;
@@ -1706,6 +1873,7 @@
       padding-left: 6px;
       text-align: left;
       width: 100px;
+
       .glyphicon-filter {
         color: #999;
       }
@@ -1724,9 +1892,9 @@

   .panel {
     background: none repeat scroll 0 0 #FFFFFF;
-  /*border: 1px solid;*/
+    /*border: 1px solid;*/
     font-size: 12px;
-  /*padding: 5px 0;*/
+    /*padding: 5px 0;*/
     position: absolute;
     z-index: 1000;

@@ -1740,11 +1908,13 @@
       .panel-body {
         ul.items {
           list-style: none;
+
           li {
             a:hover {
               cursor: pointer;
             }
           }
+
           li.disabled {
             a {
               color: #999999;
@@ -1770,6 +1940,7 @@
     right: -15px;
     bottom: -23px;
   }
+
   .period-marker {
     position: absolute;
     left: -15px;
@@ -1809,6 +1980,7 @@

 .content-area {
   position: relative;
+
   .textTrigger {
     cursor: pointer;
     position: absolute;
@@ -1838,12 +2010,15 @@
   border-color: #D2D9DD;
   color: #4E575B;
   text-shadow: none;
+
   .link {
     padding: 0 15px;
   }
+
   .link-left-pad {
-    padding-left:15px;
+    padding-left: 15px;
   }
+
   .config-groups-dropdown-menu {
     overflow: auto;
     max-height: 416px;
@@ -1859,6 +2034,7 @@
     opacity: 1;
     color: #fff;
   }
+
   .action:hover {
     opacity: 0.8;
     text-decoration: none;
@@ -1894,9 +2070,11 @@
     .label.alerts-count {
       margin-right: 0;
     }
+
     .glyphicon-blackboard {
       padding-left: 5px;
     }
+
     .health-status-LIVE, .health-status-STARTING,
     .health-status-DEAD-RED, .health-status-STOPPING,
     .health-status-DEAD-YELLOW {
@@ -1921,27 +2099,28 @@
   }
 }

-.filter-combobox{
-  > input{
+.filter-combobox {
+  > input {
     width: 170px;
     border-radius: 4px 0 0 4px;
     padding-right: 20px;
   }

-  > .btn-group{
+  > .btn-group {
     display: inline-block;
     margin-left: -1px;

-    > .dropdown-toggle{
+    > .dropdown-toggle {
       border-top-left-radius: 0;
       border-bottom-left-radius: 0
     }

-    .dropdown-menu{
+    .dropdown-menu {
       left: auto;
-      right:0;
+      right: 0;
     }
   }
+
   i.disabled {
     color: @gray-text;
   }
@@ -1954,12 +2133,14 @@
 #config-group-select-create-dialog {
   .select-create-config-group-div {
     margin: 0 0 20px 20px;
+
     .dropdown-menu {
       max-height: 160px;
       max-width: 300px;
       overflow-y: auto;
     }
   }
+
   .radio, .checkbox {
     margin-bottom: 5px;
   }
@@ -1975,11 +2156,14 @@
   td {
     vertical-align: top;
   }
+
   td.title {
     padding-top: 4px;
   }
+
   .textarea-full-width {
     padding-right: 10px;
+
     textarea {
       width: 100%;
       margin: 0;
@@ -2007,7 +2191,9 @@
   margin-top: @space-l * 1.5;
 }

-.mbm { margin-bottom: @space-m; }
+.mbm {
+  margin-bottom: @space-m;
+}

 .mls {
   margin-left: @space-s;
@@ -2031,10 +2217,12 @@
   left: -20px;
   width: 16px;
   margin-top: 7px;
+
   #filterCleaner {
     opacity: .5;

   }
+
   #filterCleaner:hover {
     opacity: .9;
   }
@@ -2050,19 +2238,23 @@
       width: 30%;
       text-align: right;
     }
+
     td:nth-of-type(2) {
       input {
         margin-left: 10px;
         margin-bottom: 1px;
       }
     }
+
     td:last-of-type {
       width: 60%;
       text-align: left;
+
       span {
         padding-left: 15px;
       }
     }
+
     tr:last-of-type {
       td {
         input {
@@ -2082,6 +2274,7 @@
   .prompt-input {
     width: 80px;
   }
+
   .large-prompt-input {
     width: 70%;
   }
@@ -2092,9 +2285,11 @@
     tr {
       cursor: pointer;
     }
+
     td.icon {
       vertical-align: middle;
       width: 40px;
+
       .view-icon-image {
         img {
           height: 32px;
@@ -2102,14 +2297,15 @@
       }
     }
   }
+
   .no-views-text {
     padding-left: 20px;
   }
 }

 .views_sizes {
-  width:100%;
-  min-height:100%;
+  width: 100%;
+  min-height: 100%;
   border: 0;
 }

@@ -2119,55 +2315,69 @@

 #flume-summary {
   max-height: 490px;
+
   .table {
     margin: 0;
     table-layout: fixed;
   }
+
   #flume-agents-table {
     border-collapse: separate;
+
     > tbody > tr > td {
       &:last-of-type {
         padding: 0;
+
         &.empty-label {
           padding: 8px;
           text-align: center;
         }
       }
     }
+
     th:first-child {
       width: 40%;
+
       + th {
         width: 30%;
+
         ~ th {
           width: 10%;
         }
       }
     }
+
     td {
       &.agent-host-name {
         overflow: hidden;
         border-bottom: 1px solid #eee;
         cursor: pointer;
       }
+
       &.agent-status {
         width: 50%;
       }
+
       &.flume-agent-sources-count, &.flume-agent-channels-count {
         width: 16.667%;
       }
+
       &.flume-agent-sink-count {
         width: 16.666%;
       }
+
       .flume-agents-actions {
         .btn-group {
           position: static;
         }
+
         a {
           text-decoration: none;
         }
       }
     }
   }
+
   .scrollable-container {
     position: static;
     max-height: 450px;
@@ -2178,63 +2388,85 @@
 @warning-background: #fcf8e3;
 @error-background: #f2dede;

-.table td.no-borders { border-top: none; }
-.table td.error { background-color: @error-background; }
-.table td.warning { background-color: @warning-background; }
+.table td.no-borders {
+  border-top: none;
+}
+
+.table td.error {
+  background-color: @error-background;
+}
+
+.table td.warning {
+  background-color: @warning-background;
+}

 .config-validation-warnings {
   table {
     table-layout: fixed;
+
     td, th {
       &.issue-type-cell {
         width: 8%;
       }
+
       &.service-name-cell {
         width: 15%;
       }
+
       &.property-name-cell {
         width: 20%;
         overflow: hidden;
         overflow-wrap: break-word;
       }
+
       &.property-value-cell {
         width: 25%;
         overflow: hidden;
         overflow-wrap: break-word;
       }
+
       &.property-description-cell {
         width: 32%;
       }
     }
-    tbody{
+
+    tbody {
       tr {
         &.warning {
           background: @warning-background;
         }
+
         &.error {
           background: @error-background;
         }
-        border:1px solid #c09853;
+
+        border: 1px solid #c09853;
+
         td {
           .property-message {
             font-weight: bold;
           }
+
           .property-description {
             font-size: 0.9em;
             white-space: pre-line;
           }
+
           .big-checkbox {
             text-align: center;
+
             label {
               &:before {
                 width: 16px;
                 height: 16px;
               }
+
               &:after {
                 font-size: 11px;
-                top:2px;
+                top: 2px;
                 left: 3px;
               }
+
               top: 0;
             }
           }
@@ -2257,48 +2489,61 @@
 #config-dependencies {
   max-height: 500px;
   overflow-y: visible;
+
   td, th {
     &.check-box-col {
       min-width: 5px;
       width: 5px;
+
       .checkbox {
         display: inline-block;
       }
     }
   }
+
   td {
     min-width: 120px;
     word-break: break-all;
+
     &.config-dependency-name {
       min-width: @config-dependency-t-name-width;
     }
+
     &.config-dependency-service {
       min-width: @config-dependency-t-service-width;
       max-width: @config-dependency-t-service-width;
     }
+
     &.config-dependency-group {
       max-width: @config-dependency-t-group-width;
     }
+
     &.config-dependency-filename {
       max-width: @config-dependency-t-filename-width;
     }
+
     &.config-dependency-value,
     &.config-dependency-recommended-value {
       width: @config-dependency-t-value-width;
       min-width: @config-dependency-t-value-width;
     }
+
     .diff {
       td {
         width: 50%;
+
         &.delete {
           background-color: @diff-background-delete !important;
         }
+
         &.insert {
           background-color: @diff-background-insert !important;
         }
+
         &.equal, &.not-defined:last-of-type, &.is-removed:first-of-type {
           background-color: @diff-background-equal;
         }
+
         &.not-defined:first-of-type, &.is-removed:last-of-type {
           background-color: @diff-background-empty;
           font-style: italic;
@@ -2307,8 +2552,10 @@
       }
     }
   }
+
   .config-dependencies-headings-wrapper {
     width: 100%;
+
     .config-dependencies-heading {
       float: left;
       width: 50%;
@@ -2319,6 +2566,7 @@
 .path-link {
   white-space: nowrap;
   cursor: pointer;
+
   &.not-active-link:hover {
     color: #999;
     text-decoration: none;
@@ -2332,6 +2580,7 @@

 .progress-counter {
   position: relative;
+
   .counters-label {
     color: @dark-gray;
     font-weight: bold;
@@ -2343,12 +2592,15 @@
 .tab-content.service-config-tab-content {
   clear: both;
   overflow: visible;
+
   .enhanced-config-tab-content {
     overflow: visible;
+
     .section-layout-container {
       width: 104%; // fallback option
       width: ~"calc(100% + 40px)";
       margin-top: -20px;
+
       .config-section-table {
         width: 100%;
         border-spacing: 20px;
@@ -2364,20 +2616,24 @@
           border: 1px solid #e4e4e4;
           vertical-align: top;
           background-color: #fff;
+
           h4 {
             margin: 0;
             font-size: 22px;
             font-weight: 400;
           }
+
           h5 {
             font-size: 18px;
             font-weight: 400;
           }
+
           div.with-border {
             border: 1px solid #aaa;
             padding: 10px;
             margin-bottom: 20px;
           }
+
           .config-subsection-table {
             width: 100%;
             height: 90%; // fallback option
@@ -2389,6 +2645,7 @@
                 height: 100% !important;
               }
             }
+
             .config-subsection {
               padding: 0;
               vertical-align: top;
@@ -2400,17 +2657,21 @@
                 padding-right: 0;
                 height: 88%;
               }
+
               &.no-horizontal-splitter {
                 border-bottom: none; // no horizontal splitter for subsection on the last row
               }
+
               &.top-horizontal-splitter {
                 border-top: 1px solid #e4e4e4; // horizontal splitter
                 padding-top: 15px;
                 padding-bottom: 15px;
               }
+
               .directories {
                 min-width: 0 !important;
               }
+
               .subsection-display-name {
                 padding-top: 5px;
               }
@@ -2445,25 +2706,31 @@
       .glyphicon-warning-sign {
         color: @health-status-yellow;
       }
+
       pre {
         word-break: keep-all;
       }
+
       .configs-table {
         table-layout: fixed;
         font-size: 0.9em;
         margin-bottom: 0;
+
         td {
           word-wrap: break-word;
+
           &.no-value {
             font-style: italic;
           }
         }
+
         td:first-child,
         td:first-child + td,
         th:first-child,
         th:first-child + th {
           width: 12.5%;
         }
+
         td:first-child + td + td,
         td:first-child + td + td + td,
         td:first-child + td + td + td + td,
@@ -2473,18 +2740,23 @@
           width: 25%;
         }
       }
+
       .configurations-changes-header {
         display: inline-block;
       }
+
       .open-in-new-window {
         margin-top: 10px;
       }
+
       .description {
         color: #999999;
       }
+
       .checks-list {
         padding-left: 25px;
         margin-top: 20px;
+
         li {
           margin-top: 15px;
         }
@@ -2505,6 +2777,7 @@
   input.disabled {
     background-color: #eee;
   }
+
   input[type="file"] {
     margin-bottom: 10px;
   }
@@ -2513,11 +2786,14 @@
 .delete-service-progress {
   .modal-body {
     text-align: center;
+
     .delete-service-progress-body {
       display: inline-block;
+
       .spinner, .progress-message {
         float: left;
       }
+
       .progress-message {
         line-height: @spinner-default-height;
       }
@@ -2564,6 +2840,7 @@
     padding: 10px;
     width: 100%;
     text-align: left;
+
     .selected-item {
       width: calc(~"100% - 20px");
       .ellipsis-overflow;
@@ -2589,6 +2866,7 @@
   display: none;
   position: absolute;
   z-index: 10;
+
   &.overlay-visible {
     display: block;
   }
@@ -2615,12 +2893,15 @@

 .summary-block {
   flex: 1;
+
   .metrics-summary {
     margin-top: 40px;
+
     &.not-separate-section {
       margin-top: 0;
     }
   }
+
   .component-summary, .metrics-summary {
     .col-md-2 {
       float: left;
@@ -2628,12 +2909,15 @@
       top: 7px;
       font-size: 16px;
     }
+
     .col-md-10 {
       float: right;
     }
+
     .main-info {
       font-size: 16px;
     }
+
     .info-desc {
       font-size: 12px;
       color: #999999;
@@ -2645,9 +2929,11 @@
 .quick-links-block {
   width: 18%;
   margin: 0 0 20px 20px;
+
   .col-lg-12 {
     float: none !important;
   }
+
   .panel-body {
     padding-top: 0px;
     color: #999999;
@@ -2679,6 +2965,7 @@

 .bulk-host-display {
   margin-bottom: 10px;
+
   pre {
     max-height: 120px;
     font-family: 'Roboto', sans-serif;
@@ -2689,19 +2976,23 @@

 .bulk-host-skipped {
   margin-bottom: 10px;
+
   .skipped-hosts {
     .icon {
       color: #337AB7;
     }
+
     a {
       color: @gray-text;
       text-decoration: none;
     }
+
     p {
       line-height: 1;
       margin-bottom: 5px;
     }
   }
+
   .skipped-hosts-text {
     p {
       font-size: 11px;
@@ -2732,21 +3023,26 @@
   .caption {
     height: 25px;
   }
+
   .spinner {
     margin: 55px auto;
   }
+
   .chart-container {
     .spinner {
       margin: 15px auto 35px;
     }
   }
+
   .span2p4 {
     float: left;
   }
+
   .thumbnails > div {
     margin: 10px;
     height: 160px;
   }
+
   .thumbnails li {
     height: @dashboard-widget-height;
     width: 100%;
@@ -2763,19 +3059,23 @@
     font-size: 14px;
     padding: 10px 15px 0 0;
     float: right;
+
     ul {
       top: inherit;
       display: none;
       border-radius: 2px;
     }
+
     li {
       padding: 2.5px 0 2.5px 5px;
       height: auto;
       box-shadow: none;
     }
+
     li:hover {
       background-color: #f5f5f5;
     }
+
     .glyphicon-remove-sign {
       color: #000;
       text-shadow: #fff 0 0 15px;
@@ -2783,17 +3083,21 @@
       left: -10px;
       top: -10px;
     }
+
     .glyphicon-edit, .glyphicon-save {
       color: #555;
     }
   }
+
   .export-graph-list {
     top: 30px;
+
     li {
       margin: 0;
       height: auto;
     }
   }
+
   .img-thumbnail .hidden-info-general {
     background-color: #ffffff;
     opacity: 0.9;
@@ -2805,24 +3109,31 @@
     position: relative;
     z-index: 7;
   }
+
   .hidden-info-two-line {
     padding-top: 60px;
   }
+
   .hidden-info-three-line {
     padding-top: 50px;
   }
+
   .hidden-info-five-line {
     padding-top: 40px;
+
     tr > td {
       line-height: 18px;
     }
   }
+
   .hidden-info-six-line {
     padding-top: 37px;
+
     tr > td {
       line-height: 16px;
     }
   }
+
   .img-thumbnail .caption {
     padding: 10px 15px 20px 15px;
     color: #666666;
@@ -2831,26 +3142,31 @@
     position: relative;
     float: left;
   }
+
   .img-thumbnail .widget-content {
     text-align: center;
     font-size: 30px;
     padding-top: 40px; //svg
     position: relative;
+
     .disabled-hdfs-link {
       pointer-events: none;
       color: grey;
       cursor: default;
     }
+
     .screensaver { // graph onload wait
       width: 90%;
       height: 105px;
       border: 1px solid silver;
       color: #fff;
+
       i {
         font-size: inherit;
       }
     }
   }
+
   .img-thumbnail .widget-content-isNA { // for pie chart n\a
     text-align: center;
     font-size: 30px;
@@ -2858,46 +3174,58 @@
     padding-top: 70px;
     position: relative;
   }
+
   .img-thumbnail {
     background-color: #fff;
     z-index: 3;
   }
+
   .has-hidden-info {
     ul {
       margin: 0;
     }
   }
+
   .has-hidden-info .img-thumbnail:hover {
     cursor: move;
+
     .corner-icon {
       display: block;
       text-decoration: none;
       z-index: 9;
     }
+
     .hidden-info-general {
       display: block;
     }
+
     .caption {
       z-index: 9;
     }
+
     .slots-caption {
       margin-left: -13px;
       z-index: 7;
     }
+
     .content-mx(@top) {
       top: @top;
       opacity: 0.3;
       z-index: 5;
     }
+
     .widget-content, .widget-content-isNA {
       .content-mx(-114px);
     }
+
     .uptime-content {
       top: -116px;
     }
+
     .uptime-content-isNA {
       top: -95px;
     }
+
     .slots-content-isNA {
       top: -82px;
     }
@@ -2905,36 +3233,46 @@

   .cluster-metrics {
     position: relative;
+
     .chart-container {
       margin: 0 10px;
+
       .chart-y-axis {
         margin-top: 10px;
       }
+
       .chart svg {
         margin-right: 20px;
       }
+
       .rickshaw_legend {
         padding-top: 3px;
       }
+
       .chart-legend {
         top: 120px;
         left: 15px;
         text-align: left;
         z-index: 3;
+
         ul > li {
           max-height: 10px;
         }
       }
     }
+
     & > ul {
       margin: 0;
     }
+
     .alert {
       padding: 0;
       font-size: 12px;
     }
+
     .img-thumbnail:hover {
       cursor: move;
+
       .corner-icon {
         display: block;
         text-decoration: none;
@@ -2948,15 +3286,18 @@
       height: 24px;
       box-shadow: none;
     }
+
     .link-button {
       margin-top: 5px;
       padding-left: 15px;
       font-size: 12px;
+
       .disabled-hdfs-quick-link {
         pointer-events: none;
         color: #808080;
         cursor: default;
       }
+
       button.btn {
         font-size: 12px;
         padding: 5px 10px;
@@ -2968,24 +3309,29 @@
       font-size: 11px;
       color: #555;
       padding: 40px 0 0 15px;
+
       table {
         vertical-position: center;
         text-align: left;
         font-size: 12px;
       }
+
       td {
         padding-top: 2px;
       }
     }
   }
+
   .links .img-thumbnail:hover {
     cursor: move;
+
     .corner-icon {
       display: block;
       text-decoration: none;
       z-index: 9;
     }
   }
+
   .img-thumbnail .widget-content .svg {
     position: relative;
   }
@@ -2994,32 +3340,39 @@
     color: @color;
     padding-top: 70px;
   }
+
   .is-red {
     .widget-content {
       .widget-cn(@health-status-red);
     }
   }
+
   .is-orange {
     .widget-content {
       .widget-cn(@health-status-orange);
     }
   }
+
   .is-green {
     .widget-content {
       .widget-cn(#666666);
     }
   }
+
   .is-na {
     position: relative;
+
     .widget-content {
       .widget-cn(#999999);
       text-shadow: none;
     }
   }
+
   .corner-icon:hover {
     .ellipsis-menu::after {
       color: #666666;
     }
+
     ul {
       display: block;
     }
@@ -3038,63 +3391,78 @@
   }

   .restart-header-info {
-    margin-bottom: 30px; margin-left: 10px;
+    margin-bottom: 30px;
+    margin-left: 10px;
   }
+
   .restart-options {
     margin-left: 25px;
     margin-bottom: 15px;
     display: flex;
   }
+
   .option-rolling-block, .option-express-block {
     label {
       font-size: 16px;
       left: -20px;
     }
+
     .fa {
       font-size: 35px;
       color: #999;
       padding-bottom: 5px;
     }
   }
+
   .fa-caret-right {
     color: #1491C1;
   }
+
   .restart-advanced-configs {
     font-size: 14px;
     float: left;
     clear: both;
     margin-left: 40px;
     margin-bottom: 10px;
+
     a {
       color: inherit;
       text-decoration: none;
       cursor: default;
     }
   }
+
   .rolling-restart-advanced {
     display: inline-block;
     margin-top: 10px;
     margin-left: 60px;
+
     .rolling-restart-by {
       display: flex;
       margin-bottom: 20px;
+
       input[type="radio"] {
         padding-left: 15px;
       }
+
       .checkbox.radio {
         display: inline-block;
       }
+
       .radio.big-radio {
         padding-right: 20px;
       }
     }
+
     .input-option {
       padding-bottom: 10px;
       margin: 0;
     }
+
     .num-retries {
       padding-left: 10px;
     }
+
     .separator {
       width: 40em;
     }
@@ -3103,4 +3471,61 @@

 .break-keep {
   word-break: keep-all;
-}
\ No newline at end of file
+}
+
+
+/* =====================================================================
+ * TTBigdata 优化：Side Nav 菜单滚动与滚动条交互优化
+ * - 解决服务过多时左侧菜单无法完整显示的问题
+ * - 默认隐藏滚动条，鼠标悬停时显示（更干净的 UI）
+ * ===================================================================== */
+
+#side-nav.navigation-bar-fit-height .navigation-bar-container {
+  position: relative;
+  height: 100vh;
+  overflow: hidden;   // 避免外层双滚动
+}
+
+#side-nav.navigation-bar-fit-height ul.side-nav-menu {
+  position: absolute;
+  top: 55px;          // header 高度
+  bottom: 45px;       // footer(折叠按钮)预留高度，不够就调到 55/60
+  left: 0;
+  right: 0;
+
+  overflow-y: auto;
+  overflow-x: hidden;
+
+  // TTBigdata：强制恢复为 block 布局，避免 flex 导致菜单项被“拉开”
+  display: block !important;
+}
+
+#side-nav.navigation-bar-fit-height ul.side-nav-menu > li {
+  display: block;
+  width: 100%;
+}
+
+/* TTBigdata：滚动条默认“不可见”，hover 时显示（WebKit 系） */
+#side-nav.navigation-bar-fit-height ul.side-nav-menu::-webkit-scrollbar {
+  width: 8px !important;     // 保留占位，避免布局抖动
+  display: block !important; // 覆盖主题可能存在的 display:none
+}
+
+#side-nav.navigation-bar-fit-height ul.side-nav-menu::-webkit-scrollbar-thumb {
+  background-color: transparent !important;
+  border-radius: 8px;
+}
+
+#side-nav.navigation-bar-fit-height ul.side-nav-menu:hover::-webkit-scrollbar-thumb {
+  background-color: rgba(255, 255, 255, 0.28) !important;
+}
+
+/* TTBigdata：Firefox 兼容（hover 时改变颜色，无法完全控制显示/隐藏） */
+#side-nav.navigation-bar-fit-height ul.side-nav-menu {
+  scrollbar-width: thin;
+  scrollbar-color: transparent transparent;
+}
+
+#side-nav.navigation-bar-fit-height ul.side-nav-menu:hover {
+  scrollbar-color: rgba(255,255,255,0.28) transparent;
+}
